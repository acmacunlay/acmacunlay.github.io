
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Achilles C. Macunlay">
      
      
        <meta name="author" content="Achilles C. Macunlay">
      
      
        <link rel="canonical" href="https://achilles.macunlay.com/blog/524ea484-523b-4e98-ab37-bbbdb48af016/">
      
      
        <link rel="prev" href="../bbcb98c8-dc68-4cb4-a660-8cf4d7c224ae/">
      
      
      
      <link rel="icon" href="../../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.7">
    
    
      
        <title>Managing Amazon S3 Buckets and Objects using Boto3 - Achilles Macunlay</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.4b4a2bd9.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.356b1318.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:300,300i,400,400i,700,700i%7CUbuntu+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Ubuntu";--md-code-font:"Ubuntu Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#managing-amazon-s3-buckets-and-objects-using-boto3" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Achilles Macunlay" class="md-header__button md-logo" aria-label="Achilles Macunlay" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Achilles Macunlay
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Managing Amazon S3 Buckets and Objects using Boto3
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../tags/" class="md-tabs__link">
        
  
    
  
  Tags

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  Articles

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Achilles Macunlay" class="md-nav__button md-logo" aria-label="Achilles Macunlay" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    Achilles Macunlay
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../tags/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tags
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Articles
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Articles
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Articles
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Categories
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Categories
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../category/aws/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../category/python/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Python
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../category/software-development/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Software Development
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
                
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#project-structure" class="md-nav__link">
    Project Structure
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dependencies" class="md-nav__link">
    Dependencies
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation-and-usage" class="md-nav__link">
    Implementation and Usage
  </a>
  
    <nav class="md-nav" aria-label="Implementation and Usage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#client-and-exceptions" class="md-nav__link">
    Client and Exceptions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-a-bucket" class="md-nav__link">
    Creating a Bucket
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-a-buckets-metadata" class="md-nav__link">
    Getting a Bucket's Metadata
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#list-all-available-buckets" class="md-nav__link">
    List All Available Buckets
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deleting-a-bucket" class="md-nav__link">
    Deleting a Bucket
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fileobject-crud-operations-using-presigned-urls" class="md-nav__link">
    File/Object CRUD Operations Using Presigned URLs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-fileobject-metadata" class="md-nav__link">
    Getting File/Object Metadata
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listing-multiple-objects-in-a-bucket" class="md-nav__link">
    Listing Multiple Objects in a Bucket
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uploading-a-fileobject" class="md-nav__link">
    Uploading a File/Object
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#downloading-a-fileobject" class="md-nav__link">
    Downloading a File/Object
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#copying-a-fileobject" class="md-nav__link">
    Copying a File/Object
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deleting-filesobjects" class="md-nav__link">
    Deleting Files/Objects
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#moving-a-fileobject" class="md-nav__link">
    Moving a File/Object
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#final-code" class="md-nav__link">
    Final Code
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-cases-and-benefits" class="md-nav__link">
    Use Cases and Benefits
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    Conclusion
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
  <div class="md-content md-content--post" data-md-component="content">
    <div class="md-sidebar md-sidebar--post" data-md-component="sidebar" data-md-type="navigation">
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner md-post">
          <nav class="md-nav md-nav--primary">
            <div class="md-post__back">
              <div class="md-nav__title md-nav__container">
                <a href="../" class="md-nav__link">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
                  <span class="md-ellipsis">
                    Back to index
                  </span>
                </a>
              </div>
            </div>
            
              <div class="md-post__authors md-typeset">
                
                  <div class="md-profile md-post__profile">
                    <span class="md-author md-author--long">
                      <img src="https://github.com/acmacunlay.png" alt="Achilles Macunlay">
                    </span>
                    <span class="md-profile__description">
                      <strong>Achilles Macunlay</strong><br>
                      Author
                    </span>
                  </div>
                
              </div>
            
            <ul class="md-post__meta md-nav__list">
              <li class="md-nav__item md-nav__item--section">
                <div class="md-post__title">
                  <span class="md-ellipsis">
                    Metadata
                  </span>
                </div>
                <nav class="md-nav">
                  <ul class="md-nav__list">
                    <li class="md-nav__item">
                      <div class="md-nav__link">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5v-5Z"/></svg>
                        <time datetime="2023-10-29 00:00:00" class="md-ellipsis">Sunday, October 29, 2023</time>
                      </div>
                    </li>
                    
                    
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 3v15h3V3H9m3 2 4 13 3-1-4-13-3 1M5 5v13h3V5H5M3 19v2h18v-2H3Z"/></svg>
                          <span class="md-ellipsis">
                            in
                            
                              <a href="../category/aws/">AWS</a>, 
                              <a href="../category/python/">Python</a>, 
                              <a href="../category/software-development/">Software Development</a></span>
                        </div>
                      </li>
                    
                    
                      
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m0-18a10 10 0 0 1 10 10 10 10 0 0 1-10 10C6.47 22 2 17.5 2 12A10 10 0 0 1 12 2m.5 5v5.25l4.5 2.67-.75 1.23L11 13V7h1.5Z"/></svg>
                          <span class="md-ellipsis">
                            
                              30 min read
                            
                          </span>
                        </div>
                      </li>
                    
                  </ul>
                </nav>
              </li>
            </ul>
          </nav>
          
        </div>
      </div>
    </div>
    <article class="md-content__inner md-typeset">
      
        
  
  

<nav class="md-tags" >
  
    
    
    
      <a href="../../tags/#aws" class="md-tag">AWS</a>
    
  
    
    
    
      <a href="../../tags/#python" class="md-tag">Python</a>
    
  
    
    
    
      <a href="../../tags/#software-development" class="md-tag">Software Development</a>
    
  
</nav>



<h1 id="managing-amazon-s3-buckets-and-objects-using-boto3">Managing Amazon S3 Buckets and Objects using Boto3</h1>
<hr />
<p>Amazon S3 (Simple Storage Service) is a pivotal component in cloud computing and data management. This article provides a practical guide on effectively utilizing Boto3, the Amazon Web Services (AWS) SDK for Python, to efficiently manage S3 buckets. Whether you're new to AWS or looking to streamline your bucket management, this straightforward tutorial will help you harness the power of Boto3 for seamless S3 bucket operations.</p>
<!-- more -->

<details class="note">
<summary>Changelog</summary>
<ul>
<li>2023-10-29<ul>
<li>initially published</li>
</ul>
</li>
</ul>
</details>
<hr />
<h2 id="prerequisites">Prerequisites</h2>
<p>Before proceeding with the next sections, you must ensure that you have:</p>
<ol>
<li>An active <a href="https://portal.aws.amazon.com/billing/signup#/start/email">AWS Account</a></li>
<li>A working installation of <a href="https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html">AWS CLI v2</a></li>
<li>Configured AWS credentials (<a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-authentication-user.html#cli-authentication-user-configure-wizard">see instructions</a>)</li>
</ol>
<hr />
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>In a hurry? You can skip to the <a href="#final-code">Final Code</a> to get all working implementations of all operations to be discussed in <a href="#implementation-and-usage">Implementation and Usage</a>.</p>
</div>
<hr />
<h2 id="project-structure">Project Structure</h2>
<p>The project folder we will be working on will have a structure as shown below:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>aws_s3/__init__.py<span class="w"> </span><span class="c1"># (1)!</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>aws_s3/api.py<span class="w"> </span><span class="c1"># (2)!</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>app.py<span class="w"> </span><span class="c1"># (3)!</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>requirements.txt<span class="w"> </span><span class="c1"># (4)!</span>
</span></code></pre></div>
<ol>
<li>All functions that is publicly accessible from <code>aws_s3/api.py</code> will be imported here.</li>
<li>All the implementation logic for managing S3 buckets and objects will be written here.</li>
<li>All usage samples will be written here.</li>
<li>This <code>.txt</code> file will contain all dependencies needed for the AWS SDK client to work.</li>
</ol>
<hr />
<h2 id="dependencies">Dependencies</h2>
<p>The following external dependencies will be used throughout the article:</p>
<div class="language-text highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">requirements.txt</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span>
<span class="normal"><a href="#__codelineno-1-2">2</a></span>
<span class="normal"><a href="#__codelineno-1-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1"></a>boto3==1.28.63
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2"></a>mypy-boto3-s3==1.28.55
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3"></a>rich
</span></code></pre></div></td></tr></table></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>I'll be using the <code>rich</code> library for printing the outputs in the console for better output formatting. You can check out this project <a href="https://rich.readthedocs.io/en/stable/introduction.html">here</a>.</p>
</div>
<hr />
<h2 id="implementation-and-usage">Implementation and Usage</h2>
<h3 id="client-and-exceptions">Client and Exceptions</h3>
<p>Creating a Boto3 client for Amazon S3 and handling client exceptions in Python is relatively straightforward. Boto3 provides a convenient way to interact with AWS services, including S3. Creating an S3 client and handling exceptions can be done as shown below:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:3"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><input id="__tabbed_1_3" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">aws_s3/api.py</label><label for="__tabbed_1_2">aws_s3/__init__.py</label><label for="__tabbed_1_3">app.py</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The snippet below is annotated to explain blocks of code inline.</p>
</div>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-2-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-2-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-2-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-2-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-2-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-2-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-2-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-2-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-2-10">10</a></span>
<span class="normal"><a href="#__codelineno-2-11">11</a></span>
<span class="normal"><a href="#__codelineno-2-12">12</a></span>
<span class="normal"><a href="#__codelineno-2-13">13</a></span>
<span class="normal"><a href="#__codelineno-2-14">14</a></span>
<span class="normal"><a href="#__codelineno-2-15">15</a></span>
<span class="normal"><a href="#__codelineno-2-16">16</a></span>
<span class="normal"><a href="#__codelineno-2-17">17</a></span>
<span class="normal"><a href="#__codelineno-2-18">18</a></span>
<span class="normal"><a href="#__codelineno-2-19">19</a></span>
<span class="normal"><a href="#__codelineno-2-20">20</a></span>
<span class="normal"><a href="#__codelineno-2-21">21</a></span>
<span class="normal"><a href="#__codelineno-2-22">22</a></span>
<span class="normal"><a href="#__codelineno-2-23">23</a></span>
<span class="normal"><a href="#__codelineno-2-24">24</a></span>
<span class="normal"><a href="#__codelineno-2-25">25</a></span>
<span class="normal"><a href="#__codelineno-2-26">26</a></span>
<span class="normal"><a href="#__codelineno-2-27">27</a></span>
<span class="normal"><a href="#__codelineno-2-28">28</a></span>
<span class="normal"><a href="#__codelineno-2-29">29</a></span>
<span class="normal"><a href="#__codelineno-2-30">30</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2"></a>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="kn">import</span> <span class="nn">functools</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Type</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5"></a>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="kn">import</span> <span class="nn">boto3</span> <span class="k">as</span> <span class="nn">aws_sdk</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="kn">from</span> <span class="nn">mypy_boto3_s3</span> <span class="kn">import</span> <span class="n">S3Client</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="kn">from</span> <span class="nn">mypy_boto3_s3.client</span> <span class="kn">import</span> <span class="n">BotocoreClientError</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9"></a>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10"></a>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># (1)!</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12"></a><span class="k">def</span> <span class="nf">__get_client</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">S3Client</span><span class="p">:</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13"></a>    <span class="n">session</span> <span class="o">=</span> <span class="n">aws_sdk</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14"></a>    <span class="k">return</span> <span class="n">session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">&quot;s3&quot;</span><span class="p">)</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15"></a>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16"></a>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17"></a><span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># (2)!</span>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18"></a><span class="k">def</span> <span class="nf">__get_exceptions</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">BotocoreClientError</span><span class="p">],</span> <span class="o">...</span><span class="p">]:</span>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19"></a>    <span class="n">client</span> <span class="o">=</span> <span class="n">__get_client</span><span class="p">()</span>
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20"></a>    <span class="k">return</span> <span class="p">(</span>
</span><span id="__span-2-21"><a id="__codelineno-2-21" name="__codelineno-2-21"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">BucketAlreadyExists</span><span class="p">,</span>
</span><span id="__span-2-22"><a id="__codelineno-2-22" name="__codelineno-2-22"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">BucketAlreadyOwnedByYou</span><span class="p">,</span>
</span><span id="__span-2-23"><a id="__codelineno-2-23" name="__codelineno-2-23"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ClientError</span><span class="p">,</span>
</span><span id="__span-2-24"><a id="__codelineno-2-24" name="__codelineno-2-24"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">InvalidObjectState</span><span class="p">,</span>
</span><span id="__span-2-25"><a id="__codelineno-2-25" name="__codelineno-2-25"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NoSuchBucket</span><span class="p">,</span>
</span><span id="__span-2-26"><a id="__codelineno-2-26" name="__codelineno-2-26"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NoSuchKey</span><span class="p">,</span>
</span><span id="__span-2-27"><a id="__codelineno-2-27" name="__codelineno-2-27"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NoSuchUpload</span><span class="p">,</span>
</span><span id="__span-2-28"><a id="__codelineno-2-28" name="__codelineno-2-28"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ObjectAlreadyInActiveTierError</span><span class="p">,</span>
</span><span id="__span-2-29"><a id="__codelineno-2-29" name="__codelineno-2-29"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ObjectNotInActiveTierError</span><span class="p">,</span>
</span><span id="__span-2-30"><a id="__codelineno-2-30" name="__codelineno-2-30"></a>    <span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<ol>
<li>Caching the results of this function will improve performace by creating the instance of the client only once.</li>
<li>Same with caching the instantiated client, this will improve performance during exception handling since all error handling will be referring to the already created tuple of exceptions.</li>
</ol>
</div>
<div class="tabbed-block">
<div class="admonition quote">
<p>This is not applicable since the client and exceptions will not be available in the public scope.</p>
</div>
</div>
<div class="tabbed-block">
<div class="admonition quote">
<p>This is not applicable since the client and exceptions will not be available in the public scope.</p>
</div>
</div>
</div>
</div>
<hr />
<h3 id="creating-a-bucket">Creating a Bucket</h3>
<p>Creating an Amazon S3 bucket is a straightforward process. First, specify a unique bucket name that adheres to naming rules and provide optional configuration details like the AWS region in which the bucket should be created. After defining the parameters, use the <code>create_bucket</code> method on the S3 client to create the bucket. It's essential to handle exceptions gracefully, as bucket names must be globally unique, and there can be issues with permissions or existing buckets. Once executed, you'll have successfully created an S3 bucket, ready to store your objects and data securely in the cloud. A sample implementation and usage is shown below:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:3"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><input id="__tabbed_2_3" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">aws_s3/api.py</label><label for="__tabbed_2_2">aws_s3/__init__.py</label><label for="__tabbed_2_3">app.py</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-3-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-3-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-3-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-3-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-3-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-3-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-3-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-3-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-3-10">10</a></span>
<span class="normal"><a href="#__codelineno-3-11">11</a></span>
<span class="normal"><a href="#__codelineno-3-12">12</a></span>
<span class="normal"><a href="#__codelineno-3-13">13</a></span>
<span class="normal"><a href="#__codelineno-3-14">14</a></span>
<span class="normal"><a href="#__codelineno-3-15">15</a></span>
<span class="normal"><a href="#__codelineno-3-16">16</a></span>
<span class="normal"><a href="#__codelineno-3-17">17</a></span>
<span class="normal"><a href="#__codelineno-3-18">18</a></span>
<span class="normal"><a href="#__codelineno-3-19">19</a></span>
<span class="normal"><a href="#__codelineno-3-20">20</a></span>
<span class="normal"><a href="#__codelineno-3-21">21</a></span>
<span class="normal"><a href="#__codelineno-3-22">22</a></span>
<span class="normal"><a href="#__codelineno-3-23">23</a></span>
<span class="normal"><a href="#__codelineno-3-24">24</a></span>
<span class="normal"><a href="#__codelineno-3-25">25</a></span>
<span class="normal"><a href="#__codelineno-3-26">26</a></span>
<span class="normal"><a href="#__codelineno-3-27">27</a></span>
<span class="normal"><a href="#__codelineno-3-28">28</a></span>
<span class="normal"><a href="#__codelineno-3-29">29</a></span>
<span class="normal"><a href="#__codelineno-3-30">30</a></span>
<span class="normal"><a href="#__codelineno-3-31">31</a></span>
<span class="normal"><a href="#__codelineno-3-32">32</a></span>
<span class="normal"><a href="#__codelineno-3-33">33</a></span>
<span class="normal"><a href="#__codelineno-3-34">34</a></span>
<span class="normal"><a href="#__codelineno-3-35">35</a></span>
<span class="normal"><a href="#__codelineno-3-36">36</a></span>
<span class="normal"><a href="#__codelineno-3-37">37</a></span>
<span class="normal"><a href="#__codelineno-3-38">38</a></span>
<span class="normal"><a href="#__codelineno-3-39">39</a></span>
<span class="normal"><a href="#__codelineno-3-40">40</a></span>
<span class="normal"><a href="#__codelineno-3-41">41</a></span>
<span class="normal"><a href="#__codelineno-3-42">42</a></span>
<span class="normal"><a href="#__codelineno-3-43">43</a></span>
<span class="normal"><a href="#__codelineno-3-44">44</a></span>
<span class="normal"><a href="#__codelineno-3-45">45</a></span>
<span class="normal"><a href="#__codelineno-3-46">46</a></span>
<span class="normal"><a href="#__codelineno-3-47">47</a></span>
<span class="normal"><a href="#__codelineno-3-48">48</a></span>
<span class="normal"><a href="#__codelineno-3-49">49</a></span>
<span class="normal"><a href="#__codelineno-3-50">50</a></span>
<span class="normal"><a href="#__codelineno-3-51">51</a></span>
<span class="normal"><a href="#__codelineno-3-52">52</a></span>
<span class="normal"><a href="#__codelineno-3-53">53</a></span>
<span class="normal"><a href="#__codelineno-3-54">54</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2"></a>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="kn">import</span> <span class="nn">functools</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Union</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5"></a>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="kn">import</span> <span class="nn">boto3</span> <span class="k">as</span> <span class="nn">aws_sdk</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="kn">from</span> <span class="nn">mypy_boto3_s3</span> <span class="kn">import</span> <span class="n">S3Client</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="kn">from</span> <span class="nn">mypy_boto3_s3.client</span> <span class="kn">import</span> <span class="n">BotocoreClientError</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9"></a><span class="kn">from</span> <span class="nn">mypy_boto3_s3.type_defs</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10"></a>    <span class="n">CreateBucketConfigurationTypeDef</span><span class="p">,</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11"></a>    <span class="n">CreateBucketOutputTypeDef</span><span class="p">,</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12"></a><span class="p">)</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13"></a>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14"></a>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15"></a><span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16"></a><span class="k">def</span> <span class="nf">__get_client</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">S3Client</span><span class="p">:</span>
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17"></a>    <span class="n">session</span> <span class="o">=</span> <span class="n">aws_sdk</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18"></a>    <span class="k">return</span> <span class="n">session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">&quot;s3&quot;</span><span class="p">)</span>
</span><span id="__span-3-19"><a id="__codelineno-3-19" name="__codelineno-3-19"></a>
</span><span id="__span-3-20"><a id="__codelineno-3-20" name="__codelineno-3-20"></a>
</span><span id="__span-3-21"><a id="__codelineno-3-21" name="__codelineno-3-21"></a><span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-3-22"><a id="__codelineno-3-22" name="__codelineno-3-22"></a><span class="k">def</span> <span class="nf">__get_exceptions</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">BotocoreClientError</span><span class="p">],</span> <span class="o">...</span><span class="p">]:</span>
</span><span id="__span-3-23"><a id="__codelineno-3-23" name="__codelineno-3-23"></a>    <span class="n">client</span> <span class="o">=</span> <span class="n">__get_client</span><span class="p">()</span>
</span><span id="__span-3-24"><a id="__codelineno-3-24" name="__codelineno-3-24"></a>    <span class="k">return</span> <span class="p">(</span>
</span><span id="__span-3-25"><a id="__codelineno-3-25" name="__codelineno-3-25"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">BucketAlreadyExists</span><span class="p">,</span>
</span><span id="__span-3-26"><a id="__codelineno-3-26" name="__codelineno-3-26"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">BucketAlreadyOwnedByYou</span><span class="p">,</span>
</span><span id="__span-3-27"><a id="__codelineno-3-27" name="__codelineno-3-27"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ClientError</span><span class="p">,</span>
</span><span id="__span-3-28"><a id="__codelineno-3-28" name="__codelineno-3-28"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">InvalidObjectState</span><span class="p">,</span>
</span><span id="__span-3-29"><a id="__codelineno-3-29" name="__codelineno-3-29"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NoSuchBucket</span><span class="p">,</span>
</span><span id="__span-3-30"><a id="__codelineno-3-30" name="__codelineno-3-30"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NoSuchKey</span><span class="p">,</span>
</span><span id="__span-3-31"><a id="__codelineno-3-31" name="__codelineno-3-31"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NoSuchUpload</span><span class="p">,</span>
</span><span id="__span-3-32"><a id="__codelineno-3-32" name="__codelineno-3-32"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ObjectAlreadyInActiveTierError</span><span class="p">,</span>
</span><span id="__span-3-33"><a id="__codelineno-3-33" name="__codelineno-3-33"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ObjectNotInActiveTierError</span><span class="p">,</span>
</span><span id="__span-3-34"><a id="__codelineno-3-34" name="__codelineno-3-34"></a>    <span class="p">)</span>
</span><span id="__span-3-35"><a id="__codelineno-3-35" name="__codelineno-3-35"></a>
</span><span id="__span-3-36"><a id="__codelineno-3-36" name="__codelineno-3-36"></a>
</span><span id="__span-3-37"><a id="__codelineno-3-37" name="__codelineno-3-37"></a><span class="k">def</span> <span class="nf">create_bucket</span><span class="p">(</span>
</span><span id="__span-3-38"><a id="__codelineno-3-38" name="__codelineno-3-38"></a>    <span class="n">bucket</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">region</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-3-39"><a id="__codelineno-3-39" name="__codelineno-3-39"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">CreateBucketOutputTypeDef</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="__span-3-40"><a id="__codelineno-3-40" name="__codelineno-3-40"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-3-41"><a id="__codelineno-3-41" name="__codelineno-3-41"></a><span class="sd">    Create an AWS S3 bucket with name `bucket` in region `region`. If `region` is not</span>
</span><span id="__span-3-42"><a id="__codelineno-3-42" name="__codelineno-3-42"></a><span class="sd">    defined, then `region` will be set to `us-east-1`.</span>
</span><span id="__span-3-43"><a id="__codelineno-3-43" name="__codelineno-3-43"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-3-44"><a id="__codelineno-3-44" name="__codelineno-3-44"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-3-45"><a id="__codelineno-3-45" name="__codelineno-3-45"></a>        <span class="n">client</span> <span class="o">=</span> <span class="n">__get_client</span><span class="p">()</span>
</span><span id="__span-3-46"><a id="__codelineno-3-46" name="__codelineno-3-46"></a>        <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">create_bucket</span><span class="p">(</span>
</span><span id="__span-3-47"><a id="__codelineno-3-47" name="__codelineno-3-47"></a>            <span class="n">Bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">,</span>
</span><span id="__span-3-48"><a id="__codelineno-3-48" name="__codelineno-3-48"></a>            <span class="n">CreateBucketConfiguration</span><span class="o">=</span><span class="n">CreateBucketConfigurationTypeDef</span><span class="p">(</span>
</span><span id="__span-3-49"><a id="__codelineno-3-49" name="__codelineno-3-49"></a>                <span class="n">LocationConstraint</span><span class="o">=</span><span class="n">region</span> <span class="ow">or</span> <span class="s2">&quot;us-east-1&quot;</span>
</span><span id="__span-3-50"><a id="__codelineno-3-50" name="__codelineno-3-50"></a>            <span class="p">),</span>
</span><span id="__span-3-51"><a id="__codelineno-3-51" name="__codelineno-3-51"></a>        <span class="p">)</span>
</span><span id="__span-3-52"><a id="__codelineno-3-52" name="__codelineno-3-52"></a>
</span><span id="__span-3-53"><a id="__codelineno-3-53" name="__codelineno-3-53"></a>    <span class="k">except</span> <span class="n">__get_exceptions</span><span class="p">()</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-3-54"><a id="__codelineno-3-54" name="__codelineno-3-54"></a>        <span class="k">return</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="kn">from</span> <span class="nn">.api</span> <span class="kn">import</span> <span class="n">create_bucket</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="kn">from</span> <span class="nn">rich.pretty</span> <span class="kn">import</span> <span class="n">pprint</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2"></a>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="kn">import</span> <span class="nn">aws_s3</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4"></a>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="n">bucket</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;my-bucket-00000001&quot;</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="n">region</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ap-southeast-1&quot;</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7"></a>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="n">result</span> <span class="o">=</span> <span class="n">aws_s3</span><span class="o">.</span><span class="n">create_bucket</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9"></a>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10"></a><span class="n">pprint</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">indent_guides</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>Output:</p>
<div class="language-json highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-6-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-6-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-6-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-6-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-6-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-6-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-6-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-6-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-6-10">10</a></span>
<span class="normal"><a href="#__codelineno-6-11">11</a></span>
<span class="normal"><a href="#__codelineno-6-12">12</a></span>
<span class="normal"><a href="#__codelineno-6-13">13</a></span>
<span class="normal"><a href="#__codelineno-6-14">14</a></span>
<span class="normal"><a href="#__codelineno-6-15">15</a></span>
<span class="normal"><a href="#__codelineno-6-16">16</a></span>
<span class="normal"><a href="#__codelineno-6-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="p">{</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="w">    </span><span class="nt">&quot;ResponseMetadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="w">        </span><span class="nt">&quot;RequestId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;****************&quot;</span><span class="p">,</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="w">        </span><span class="nt">&quot;HostId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;****************&quot;</span><span class="p">,</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="w">        </span><span class="nt">&quot;HTTPStatusCode&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="w">        </span><span class="nt">&quot;HTTPHeaders&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="w">            </span><span class="nt">&quot;x-amz-id-2&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;****************&quot;</span><span class="p">,</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="w">            </span><span class="nt">&quot;x-amz-request-id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;****************&quot;</span><span class="p">,</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="w">            </span><span class="nt">&quot;date&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sun, 29 Oct 2023 08:32:25 GMT&quot;</span><span class="p">,</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10"></a><span class="w">            </span><span class="nt">&quot;location&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;http://my-bucket-00000001.s3.amazonaws.com/&quot;</span><span class="p">,</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11"></a><span class="w">            </span><span class="nt">&quot;server&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AmazonS3&quot;</span><span class="p">,</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12"></a><span class="w">            </span><span class="nt">&quot;content-length&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="p">,</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14"></a><span class="w">        </span><span class="nt">&quot;RetryAttempts&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16"></a><span class="w">    </span><span class="nt">&quot;Location&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;http://my-bucket-00000001.s3.amazonaws.com/&quot;</span><span class="p">,</span>
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<hr />
<h3 id="getting-a-buckets-metadata">Getting a Bucket's Metadata</h3>
<p>To obtain the header information, you can use the <code>head_bucket</code> method of the S3 client, passing the bucket name as a parameter. This operation provides essential metadata about the bucket, including information on the bucket's location, creation date, and other configuration details. By following these steps, you can easily access and inspect header data for your S3 bucket, which is helpful for monitoring and managing your storage resources in the AWS cloud. A sample implementation and usage is shown below:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:3"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><input id="__tabbed_3_3" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">aws_s3/api.py</label><label for="__tabbed_3_2">aws_s3/__init__.py</label><label for="__tabbed_3_3">app.py</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-7-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-7-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-7-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-7-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-7-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-7-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-7-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-7-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-7-10">10</a></span>
<span class="normal"><a href="#__codelineno-7-11">11</a></span>
<span class="normal"><a href="#__codelineno-7-12">12</a></span>
<span class="normal"><a href="#__codelineno-7-13">13</a></span>
<span class="normal"><a href="#__codelineno-7-14">14</a></span>
<span class="normal"><a href="#__codelineno-7-15">15</a></span>
<span class="normal"><a href="#__codelineno-7-16">16</a></span>
<span class="normal"><a href="#__codelineno-7-17">17</a></span>
<span class="normal"><a href="#__codelineno-7-18">18</a></span>
<span class="normal"><a href="#__codelineno-7-19">19</a></span>
<span class="normal"><a href="#__codelineno-7-20">20</a></span>
<span class="normal"><a href="#__codelineno-7-21">21</a></span>
<span class="normal"><a href="#__codelineno-7-22">22</a></span>
<span class="normal"><a href="#__codelineno-7-23">23</a></span>
<span class="normal"><a href="#__codelineno-7-24">24</a></span>
<span class="normal"><a href="#__codelineno-7-25">25</a></span>
<span class="normal"><a href="#__codelineno-7-26">26</a></span>
<span class="normal"><a href="#__codelineno-7-27">27</a></span>
<span class="normal"><a href="#__codelineno-7-28">28</a></span>
<span class="normal"><a href="#__codelineno-7-29">29</a></span>
<span class="normal"><a href="#__codelineno-7-30">30</a></span>
<span class="normal"><a href="#__codelineno-7-31">31</a></span>
<span class="normal"><a href="#__codelineno-7-32">32</a></span>
<span class="normal"><a href="#__codelineno-7-33">33</a></span>
<span class="normal"><a href="#__codelineno-7-34">34</a></span>
<span class="normal"><a href="#__codelineno-7-35">35</a></span>
<span class="normal"><a href="#__codelineno-7-36">36</a></span>
<span class="normal"><a href="#__codelineno-7-37">37</a></span>
<span class="normal"><a href="#__codelineno-7-38">38</a></span>
<span class="normal"><a href="#__codelineno-7-39">39</a></span>
<span class="normal"><a href="#__codelineno-7-40">40</a></span>
<span class="normal"><a href="#__codelineno-7-41">41</a></span>
<span class="normal"><a href="#__codelineno-7-42">42</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2"></a>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="kn">import</span> <span class="nn">functools</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Union</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5"></a>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="kn">import</span> <span class="nn">boto3</span> <span class="k">as</span> <span class="nn">aws_sdk</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="kn">from</span> <span class="nn">mypy_boto3_s3</span> <span class="kn">import</span> <span class="n">S3Client</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8"></a><span class="kn">from</span> <span class="nn">mypy_boto3_s3.client</span> <span class="kn">import</span> <span class="n">BotocoreClientError</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9"></a><span class="kn">from</span> <span class="nn">mypy_boto3_s3.type_defs</span> <span class="kn">import</span> <span class="n">EmptyResponseMetadataTypeDef</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10"></a>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11"></a>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12"></a><span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13"></a><span class="k">def</span> <span class="nf">__get_client</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">S3Client</span><span class="p">:</span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14"></a>    <span class="n">session</span> <span class="o">=</span> <span class="n">aws_sdk</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15"></a>    <span class="k">return</span> <span class="n">session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">&quot;s3&quot;</span><span class="p">)</span>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16"></a>
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17"></a>
</span><span id="__span-7-18"><a id="__codelineno-7-18" name="__codelineno-7-18"></a><span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-7-19"><a id="__codelineno-7-19" name="__codelineno-7-19"></a><span class="k">def</span> <span class="nf">__get_exceptions</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">BotocoreClientError</span><span class="p">],</span> <span class="o">...</span><span class="p">]:</span>
</span><span id="__span-7-20"><a id="__codelineno-7-20" name="__codelineno-7-20"></a>    <span class="n">client</span> <span class="o">=</span> <span class="n">__get_client</span><span class="p">()</span>
</span><span id="__span-7-21"><a id="__codelineno-7-21" name="__codelineno-7-21"></a>    <span class="k">return</span> <span class="p">(</span>
</span><span id="__span-7-22"><a id="__codelineno-7-22" name="__codelineno-7-22"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">BucketAlreadyExists</span><span class="p">,</span>
</span><span id="__span-7-23"><a id="__codelineno-7-23" name="__codelineno-7-23"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">BucketAlreadyOwnedByYou</span><span class="p">,</span>
</span><span id="__span-7-24"><a id="__codelineno-7-24" name="__codelineno-7-24"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ClientError</span><span class="p">,</span>
</span><span id="__span-7-25"><a id="__codelineno-7-25" name="__codelineno-7-25"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">InvalidObjectState</span><span class="p">,</span>
</span><span id="__span-7-26"><a id="__codelineno-7-26" name="__codelineno-7-26"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NoSuchBucket</span><span class="p">,</span>
</span><span id="__span-7-27"><a id="__codelineno-7-27" name="__codelineno-7-27"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NoSuchKey</span><span class="p">,</span>
</span><span id="__span-7-28"><a id="__codelineno-7-28" name="__codelineno-7-28"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NoSuchUpload</span><span class="p">,</span>
</span><span id="__span-7-29"><a id="__codelineno-7-29" name="__codelineno-7-29"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ObjectAlreadyInActiveTierError</span><span class="p">,</span>
</span><span id="__span-7-30"><a id="__codelineno-7-30" name="__codelineno-7-30"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ObjectNotInActiveTierError</span><span class="p">,</span>
</span><span id="__span-7-31"><a id="__codelineno-7-31" name="__codelineno-7-31"></a>    <span class="p">)</span>
</span><span id="__span-7-32"><a id="__codelineno-7-32" name="__codelineno-7-32"></a>
</span><span id="__span-7-33"><a id="__codelineno-7-33" name="__codelineno-7-33"></a>
</span><span id="__span-7-34"><a id="__codelineno-7-34" name="__codelineno-7-34"></a><span class="k">def</span> <span class="nf">get_bucket_metadata</span><span class="p">(</span>
</span><span id="__span-7-35"><a id="__codelineno-7-35" name="__codelineno-7-35"></a>    <span class="n">bucket</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-7-36"><a id="__codelineno-7-36" name="__codelineno-7-36"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">EmptyResponseMetadataTypeDef</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="__span-7-37"><a id="__codelineno-7-37" name="__codelineno-7-37"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-7-38"><a id="__codelineno-7-38" name="__codelineno-7-38"></a>        <span class="n">client</span> <span class="o">=</span> <span class="n">__get_client</span><span class="p">()</span>
</span><span id="__span-7-39"><a id="__codelineno-7-39" name="__codelineno-7-39"></a>        <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">head_bucket</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">)</span>
</span><span id="__span-7-40"><a id="__codelineno-7-40" name="__codelineno-7-40"></a>
</span><span id="__span-7-41"><a id="__codelineno-7-41" name="__codelineno-7-41"></a>    <span class="k">except</span> <span class="n">__get_exceptions</span><span class="p">()</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-7-42"><a id="__codelineno-7-42" name="__codelineno-7-42"></a>        <span class="k">return</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="kn">from</span> <span class="nn">.api</span> <span class="kn">import</span> <span class="n">get_bucket_metadata</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span>
<span class="normal"><a href="#__codelineno-9-2">2</a></span>
<span class="normal"><a href="#__codelineno-9-3">3</a></span>
<span class="normal"><a href="#__codelineno-9-4">4</a></span>
<span class="normal"><a href="#__codelineno-9-5">5</a></span>
<span class="normal"><a href="#__codelineno-9-6">6</a></span>
<span class="normal"><a href="#__codelineno-9-7">7</a></span>
<span class="normal"><a href="#__codelineno-9-8">8</a></span>
<span class="normal"><a href="#__codelineno-9-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="kn">from</span> <span class="nn">rich.pretty</span> <span class="kn">import</span> <span class="n">pprint</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2"></a>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="kn">import</span> <span class="nn">aws_s3</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4"></a>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="n">bucket</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;my-bucket-00000001&quot;</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6"></a>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7"></a><span class="n">result</span> <span class="o">=</span> <span class="n">aws_s3</span><span class="o">.</span><span class="n">get_bucket_metadata</span><span class="p">(</span><span class="n">bucket</span><span class="p">)</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8"></a>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9"></a><span class="n">pprint</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">indent_guides</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>Output:</p>
<div class="language-json highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-10-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-10-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-10-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-10-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-10-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-10-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-10-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-10-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-10-10">10</a></span>
<span class="normal"><a href="#__codelineno-10-11">11</a></span>
<span class="normal"><a href="#__codelineno-10-12">12</a></span>
<span class="normal"><a href="#__codelineno-10-13">13</a></span>
<span class="normal"><a href="#__codelineno-10-14">14</a></span>
<span class="normal"><a href="#__codelineno-10-15">15</a></span>
<span class="normal"><a href="#__codelineno-10-16">16</a></span>
<span class="normal"><a href="#__codelineno-10-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="p">{</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="w">    </span><span class="nt">&quot;ResponseMetadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="w">        </span><span class="nt">&quot;RequestId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;****************&quot;</span><span class="p">,</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="w">        </span><span class="nt">&quot;HostId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;****************&quot;</span><span class="p">,</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="w">        </span><span class="nt">&quot;HTTPStatusCode&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6"></a><span class="w">        </span><span class="nt">&quot;HTTPHeaders&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="w">            </span><span class="nt">&quot;x-amz-id-2&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;****************&quot;</span><span class="p">,</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8"></a><span class="w">            </span><span class="nt">&quot;x-amz-request-id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;****************&quot;</span><span class="p">,</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9"></a><span class="w">            </span><span class="nt">&quot;date&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sun, 29 Oct 2023 08:35:53 GMT&quot;</span><span class="p">,</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10"></a><span class="w">            </span><span class="nt">&quot;x-amz-bucket-region&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ap-southeast-1&quot;</span><span class="p">,</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11"></a><span class="w">            </span><span class="nt">&quot;x-amz-access-point-alias&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;false&quot;</span><span class="p">,</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12"></a><span class="w">            </span><span class="nt">&quot;content-type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;application/xml&quot;</span><span class="p">,</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13"></a><span class="w">            </span><span class="nt">&quot;server&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AmazonS3&quot;</span><span class="p">,</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15"></a><span class="w">        </span><span class="nt">&quot;RetryAttempts&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<hr />
<h3 id="list-all-available-buckets">List All Available Buckets</h3>
<p>To list all available S3 buckets in your account, you can use the <code>list_buckets</code> method provided by the S3 client to fetch a list of all the buckets associated with your AWS account. The response will include details such as each bucket's name, creation date, and other metadata. This information can be invaluable for managing and monitoring your S3 resources, and it allows you to easily view and access your existing buckets, making it a fundamental step for AWS users to gain visibility into their S3 infrastructure. A sample implementation and usage is shown below:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:3"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><input id="__tabbed_4_2" name="__tabbed_4" type="radio" /><input id="__tabbed_4_3" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">aws_s3/api.py</label><label for="__tabbed_4_2">aws_s3/__init__.py</label><label for="__tabbed_4_3">app.py</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-11-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-11-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-11-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-11-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-11-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-11-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-11-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-11-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-11-10">10</a></span>
<span class="normal"><a href="#__codelineno-11-11">11</a></span>
<span class="normal"><a href="#__codelineno-11-12">12</a></span>
<span class="normal"><a href="#__codelineno-11-13">13</a></span>
<span class="normal"><a href="#__codelineno-11-14">14</a></span>
<span class="normal"><a href="#__codelineno-11-15">15</a></span>
<span class="normal"><a href="#__codelineno-11-16">16</a></span>
<span class="normal"><a href="#__codelineno-11-17">17</a></span>
<span class="normal"><a href="#__codelineno-11-18">18</a></span>
<span class="normal"><a href="#__codelineno-11-19">19</a></span>
<span class="normal"><a href="#__codelineno-11-20">20</a></span>
<span class="normal"><a href="#__codelineno-11-21">21</a></span>
<span class="normal"><a href="#__codelineno-11-22">22</a></span>
<span class="normal"><a href="#__codelineno-11-23">23</a></span>
<span class="normal"><a href="#__codelineno-11-24">24</a></span>
<span class="normal"><a href="#__codelineno-11-25">25</a></span>
<span class="normal"><a href="#__codelineno-11-26">26</a></span>
<span class="normal"><a href="#__codelineno-11-27">27</a></span>
<span class="normal"><a href="#__codelineno-11-28">28</a></span>
<span class="normal"><a href="#__codelineno-11-29">29</a></span>
<span class="normal"><a href="#__codelineno-11-30">30</a></span>
<span class="normal"><a href="#__codelineno-11-31">31</a></span>
<span class="normal"><a href="#__codelineno-11-32">32</a></span>
<span class="normal"><a href="#__codelineno-11-33">33</a></span>
<span class="normal"><a href="#__codelineno-11-34">34</a></span>
<span class="normal"><a href="#__codelineno-11-35">35</a></span>
<span class="normal"><a href="#__codelineno-11-36">36</a></span>
<span class="normal"><a href="#__codelineno-11-37">37</a></span>
<span class="normal"><a href="#__codelineno-11-38">38</a></span>
<span class="normal"><a href="#__codelineno-11-39">39</a></span>
<span class="normal"><a href="#__codelineno-11-40">40</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2"></a>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="kn">import</span> <span class="nn">functools</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Union</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5"></a>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6"></a><span class="kn">import</span> <span class="nn">boto3</span> <span class="k">as</span> <span class="nn">aws_sdk</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7"></a><span class="kn">from</span> <span class="nn">mypy_boto3_s3</span> <span class="kn">import</span> <span class="n">S3Client</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8"></a><span class="kn">from</span> <span class="nn">mypy_boto3_s3.client</span> <span class="kn">import</span> <span class="n">BotocoreClientError</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9"></a><span class="kn">from</span> <span class="nn">mypy_boto3_s3.type_defs</span> <span class="kn">import</span> <span class="n">ListBucketsOutputTypeDef</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10"></a>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11"></a>
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12"></a><span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13"></a><span class="k">def</span> <span class="nf">__get_client</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">S3Client</span><span class="p">:</span>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14"></a>    <span class="n">session</span> <span class="o">=</span> <span class="n">aws_sdk</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15"></a>    <span class="k">return</span> <span class="n">session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">&quot;s3&quot;</span><span class="p">)</span>
</span><span id="__span-11-16"><a id="__codelineno-11-16" name="__codelineno-11-16"></a>
</span><span id="__span-11-17"><a id="__codelineno-11-17" name="__codelineno-11-17"></a>
</span><span id="__span-11-18"><a id="__codelineno-11-18" name="__codelineno-11-18"></a><span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-11-19"><a id="__codelineno-11-19" name="__codelineno-11-19"></a><span class="k">def</span> <span class="nf">__get_exceptions</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">BotocoreClientError</span><span class="p">],</span> <span class="o">...</span><span class="p">]:</span>
</span><span id="__span-11-20"><a id="__codelineno-11-20" name="__codelineno-11-20"></a>    <span class="n">client</span> <span class="o">=</span> <span class="n">__get_client</span><span class="p">()</span>
</span><span id="__span-11-21"><a id="__codelineno-11-21" name="__codelineno-11-21"></a>    <span class="k">return</span> <span class="p">(</span>
</span><span id="__span-11-22"><a id="__codelineno-11-22" name="__codelineno-11-22"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">BucketAlreadyExists</span><span class="p">,</span>
</span><span id="__span-11-23"><a id="__codelineno-11-23" name="__codelineno-11-23"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">BucketAlreadyOwnedByYou</span><span class="p">,</span>
</span><span id="__span-11-24"><a id="__codelineno-11-24" name="__codelineno-11-24"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ClientError</span><span class="p">,</span>
</span><span id="__span-11-25"><a id="__codelineno-11-25" name="__codelineno-11-25"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">InvalidObjectState</span><span class="p">,</span>
</span><span id="__span-11-26"><a id="__codelineno-11-26" name="__codelineno-11-26"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NoSuchBucket</span><span class="p">,</span>
</span><span id="__span-11-27"><a id="__codelineno-11-27" name="__codelineno-11-27"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NoSuchKey</span><span class="p">,</span>
</span><span id="__span-11-28"><a id="__codelineno-11-28" name="__codelineno-11-28"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NoSuchUpload</span><span class="p">,</span>
</span><span id="__span-11-29"><a id="__codelineno-11-29" name="__codelineno-11-29"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ObjectAlreadyInActiveTierError</span><span class="p">,</span>
</span><span id="__span-11-30"><a id="__codelineno-11-30" name="__codelineno-11-30"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ObjectNotInActiveTierError</span><span class="p">,</span>
</span><span id="__span-11-31"><a id="__codelineno-11-31" name="__codelineno-11-31"></a>    <span class="p">)</span>
</span><span id="__span-11-32"><a id="__codelineno-11-32" name="__codelineno-11-32"></a>
</span><span id="__span-11-33"><a id="__codelineno-11-33" name="__codelineno-11-33"></a>
</span><span id="__span-11-34"><a id="__codelineno-11-34" name="__codelineno-11-34"></a><span class="k">def</span> <span class="nf">list_buckets</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">ListBucketsOutputTypeDef</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="__span-11-35"><a id="__codelineno-11-35" name="__codelineno-11-35"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-11-36"><a id="__codelineno-11-36" name="__codelineno-11-36"></a>        <span class="n">client</span> <span class="o">=</span> <span class="n">__get_client</span><span class="p">()</span>
</span><span id="__span-11-37"><a id="__codelineno-11-37" name="__codelineno-11-37"></a>        <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">list_buckets</span><span class="p">()</span>
</span><span id="__span-11-38"><a id="__codelineno-11-38" name="__codelineno-11-38"></a>
</span><span id="__span-11-39"><a id="__codelineno-11-39" name="__codelineno-11-39"></a>    <span class="k">except</span> <span class="n">__get_exceptions</span><span class="p">()</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-11-40"><a id="__codelineno-11-40" name="__codelineno-11-40"></a>        <span class="k">return</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="kn">from</span> <span class="nn">.api</span> <span class="kn">import</span> <span class="n">list_buckets</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1">1</a></span>
<span class="normal"><a href="#__codelineno-13-2">2</a></span>
<span class="normal"><a href="#__codelineno-13-3">3</a></span>
<span class="normal"><a href="#__codelineno-13-4">4</a></span>
<span class="normal"><a href="#__codelineno-13-5">5</a></span>
<span class="normal"><a href="#__codelineno-13-6">6</a></span>
<span class="normal"><a href="#__codelineno-13-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="kn">from</span> <span class="nn">rich.pretty</span> <span class="kn">import</span> <span class="n">pprint</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2"></a>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="kn">import</span> <span class="nn">aws_s3</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4"></a>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="n">result</span> <span class="o">=</span> <span class="n">aws_s3</span><span class="o">.</span><span class="n">list_buckets</span><span class="p">()</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6"></a>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7"></a><span class="n">pprint</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">indent_guides</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>Output:</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-14-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-14-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-14-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-14-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-14-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-14-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-14-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-14-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-14-10">10</a></span>
<span class="normal"><a href="#__codelineno-14-11">11</a></span>
<span class="normal"><a href="#__codelineno-14-12">12</a></span>
<span class="normal"><a href="#__codelineno-14-13">13</a></span>
<span class="normal"><a href="#__codelineno-14-14">14</a></span>
<span class="normal"><a href="#__codelineno-14-15">15</a></span>
<span class="normal"><a href="#__codelineno-14-16">16</a></span>
<span class="normal"><a href="#__codelineno-14-17">17</a></span>
<span class="normal"><a href="#__codelineno-14-18">18</a></span>
<span class="normal"><a href="#__codelineno-14-19">19</a></span>
<span class="normal"><a href="#__codelineno-14-20">20</a></span>
<span class="normal"><a href="#__codelineno-14-21">21</a></span>
<span class="normal"><a href="#__codelineno-14-22">22</a></span>
<span class="normal"><a href="#__codelineno-14-23">23</a></span>
<span class="normal"><a href="#__codelineno-14-24">24</a></span>
<span class="normal"><a href="#__codelineno-14-25">25</a></span>
<span class="normal"><a href="#__codelineno-14-26">26</a></span>
<span class="normal"><a href="#__codelineno-14-27">27</a></span>
<span class="normal"><a href="#__codelineno-14-28">28</a></span>
<span class="normal"><a href="#__codelineno-14-29">29</a></span>
<span class="normal"><a href="#__codelineno-14-30">30</a></span>
<span class="normal"><a href="#__codelineno-14-31">31</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="p">{</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2"></a>    <span class="s2">&quot;ResponseMetadata&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3"></a>        <span class="s2">&quot;RequestId&quot;</span><span class="p">:</span> <span class="s2">&quot;****************&quot;</span><span class="p">,</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4"></a>        <span class="s2">&quot;HostId&quot;</span><span class="p">:</span> <span class="s2">&quot;****************&quot;</span><span class="p">,</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5"></a>        <span class="s2">&quot;HTTPStatusCode&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6"></a>        <span class="s2">&quot;HTTPHeaders&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7"></a>            <span class="s2">&quot;x-amz-id-2&quot;</span><span class="p">:</span> <span class="s2">&quot;****************&quot;</span><span class="p">,</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8"></a>            <span class="s2">&quot;x-amz-request-id&quot;</span><span class="p">:</span> <span class="s2">&quot;****************&quot;</span><span class="p">,</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9"></a>            <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;Sun, 29 Oct 2023 08:40:29 GMT&quot;</span><span class="p">,</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10"></a>            <span class="s2">&quot;content-type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/xml&quot;</span><span class="p">,</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11"></a>            <span class="s2">&quot;transfer-encoding&quot;</span><span class="p">:</span> <span class="s2">&quot;chunked&quot;</span><span class="p">,</span>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12"></a>            <span class="s2">&quot;server&quot;</span><span class="p">:</span> <span class="s2">&quot;AmazonS3&quot;</span><span class="p">,</span>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13"></a>        <span class="p">},</span>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14"></a>        <span class="s2">&quot;RetryAttempts&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15"></a>    <span class="p">},</span>
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16"></a>    <span class="s2">&quot;Buckets&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17"></a>        <span class="p">{</span>
</span><span id="__span-14-18"><a id="__codelineno-14-18" name="__codelineno-14-18"></a>            <span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;****************&quot;</span><span class="p">,</span>
</span><span id="__span-14-19"><a id="__codelineno-14-19" name="__codelineno-14-19"></a>            <span class="s2">&quot;CreationDate&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="n">tzinfo</span><span class="o">=</span><span class="n">tzutc</span><span class="p">()),</span>
</span><span id="__span-14-20"><a id="__codelineno-14-20" name="__codelineno-14-20"></a>        <span class="p">},</span>
</span><span id="__span-14-21"><a id="__codelineno-14-21" name="__codelineno-14-21"></a>        <span class="p">{</span>
</span><span id="__span-14-22"><a id="__codelineno-14-22" name="__codelineno-14-22"></a>            <span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;****************&quot;</span><span class="p">,</span>
</span><span id="__span-14-23"><a id="__codelineno-14-23" name="__codelineno-14-23"></a>            <span class="s2">&quot;CreationDate&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">39</span><span class="p">,</span> <span class="n">tzinfo</span><span class="o">=</span><span class="n">tzutc</span><span class="p">()),</span>
</span><span id="__span-14-24"><a id="__codelineno-14-24" name="__codelineno-14-24"></a>        <span class="p">},</span>
</span><span id="__span-14-25"><a id="__codelineno-14-25" name="__codelineno-14-25"></a>        <span class="p">{</span>
</span><span id="__span-14-26"><a id="__codelineno-14-26" name="__codelineno-14-26"></a>            <span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;my-bucket-00000001&quot;</span><span class="p">,</span>
</span><span id="__span-14-27"><a id="__codelineno-14-27" name="__codelineno-14-27"></a>            <span class="s2">&quot;CreationDate&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="n">tzinfo</span><span class="o">=</span><span class="n">tzutc</span><span class="p">()),</span>
</span><span id="__span-14-28"><a id="__codelineno-14-28" name="__codelineno-14-28"></a>        <span class="p">},</span>
</span><span id="__span-14-29"><a id="__codelineno-14-29" name="__codelineno-14-29"></a>    <span class="p">],</span>
</span><span id="__span-14-30"><a id="__codelineno-14-30" name="__codelineno-14-30"></a>    <span class="s2">&quot;Owner&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;DisplayName&quot;</span><span class="p">:</span> <span class="s2">&quot;****************&quot;</span><span class="p">,</span> <span class="s2">&quot;ID&quot;</span><span class="p">:</span> <span class="s2">&quot;****************&quot;</span><span class="p">},</span>
</span><span id="__span-14-31"><a id="__codelineno-14-31" name="__codelineno-14-31"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<hr />
<h3 id="deleting-a-bucket">Deleting a Bucket</h3>
<p>To delete an s3 bucket, make use of the <code>delete_bucket</code> method provided by the S3 client, passing the name of the target bucket as a parameter. It's crucial to note that the bucket must be empty before you can delete it; otherwise, you'll encounter an error. A sample implementation and usage is shown below:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="5:3"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio" /><input id="__tabbed_5_2" name="__tabbed_5" type="radio" /><input id="__tabbed_5_3" name="__tabbed_5" type="radio" /><div class="tabbed-labels"><label for="__tabbed_5_1">aws_s3/api.py</label><label for="__tabbed_5_2">aws_s3/__init__.py</label><label for="__tabbed_5_3">app.py</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-15-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-15-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-15-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-15-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-15-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-15-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-15-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-15-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-15-10">10</a></span>
<span class="normal"><a href="#__codelineno-15-11">11</a></span>
<span class="normal"><a href="#__codelineno-15-12">12</a></span>
<span class="normal"><a href="#__codelineno-15-13">13</a></span>
<span class="normal"><a href="#__codelineno-15-14">14</a></span>
<span class="normal"><a href="#__codelineno-15-15">15</a></span>
<span class="normal"><a href="#__codelineno-15-16">16</a></span>
<span class="normal"><a href="#__codelineno-15-17">17</a></span>
<span class="normal"><a href="#__codelineno-15-18">18</a></span>
<span class="normal"><a href="#__codelineno-15-19">19</a></span>
<span class="normal"><a href="#__codelineno-15-20">20</a></span>
<span class="normal"><a href="#__codelineno-15-21">21</a></span>
<span class="normal"><a href="#__codelineno-15-22">22</a></span>
<span class="normal"><a href="#__codelineno-15-23">23</a></span>
<span class="normal"><a href="#__codelineno-15-24">24</a></span>
<span class="normal"><a href="#__codelineno-15-25">25</a></span>
<span class="normal"><a href="#__codelineno-15-26">26</a></span>
<span class="normal"><a href="#__codelineno-15-27">27</a></span>
<span class="normal"><a href="#__codelineno-15-28">28</a></span>
<span class="normal"><a href="#__codelineno-15-29">29</a></span>
<span class="normal"><a href="#__codelineno-15-30">30</a></span>
<span class="normal"><a href="#__codelineno-15-31">31</a></span>
<span class="normal"><a href="#__codelineno-15-32">32</a></span>
<span class="normal"><a href="#__codelineno-15-33">33</a></span>
<span class="normal"><a href="#__codelineno-15-34">34</a></span>
<span class="normal"><a href="#__codelineno-15-35">35</a></span>
<span class="normal"><a href="#__codelineno-15-36">36</a></span>
<span class="normal"><a href="#__codelineno-15-37">37</a></span>
<span class="normal"><a href="#__codelineno-15-38">38</a></span>
<span class="normal"><a href="#__codelineno-15-39">39</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2"></a>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="kn">import</span> <span class="nn">functools</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Type</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5"></a>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6"></a><span class="kn">import</span> <span class="nn">boto3</span> <span class="k">as</span> <span class="nn">aws_sdk</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="kn">from</span> <span class="nn">mypy_boto3_s3</span> <span class="kn">import</span> <span class="n">S3Client</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8"></a><span class="kn">from</span> <span class="nn">mypy_boto3_s3.client</span> <span class="kn">import</span> <span class="n">BotocoreClientError</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9"></a>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10"></a>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11"></a><span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12"></a><span class="k">def</span> <span class="nf">__get_client</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">S3Client</span><span class="p">:</span>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13"></a>    <span class="n">session</span> <span class="o">=</span> <span class="n">aws_sdk</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14"></a>    <span class="k">return</span> <span class="n">session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">&quot;s3&quot;</span><span class="p">)</span>
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15"></a>
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16"></a>
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17"></a><span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-15-18"><a id="__codelineno-15-18" name="__codelineno-15-18"></a><span class="k">def</span> <span class="nf">__get_exceptions</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">BotocoreClientError</span><span class="p">],</span> <span class="o">...</span><span class="p">]:</span>
</span><span id="__span-15-19"><a id="__codelineno-15-19" name="__codelineno-15-19"></a>    <span class="n">client</span> <span class="o">=</span> <span class="n">__get_client</span><span class="p">()</span>
</span><span id="__span-15-20"><a id="__codelineno-15-20" name="__codelineno-15-20"></a>    <span class="k">return</span> <span class="p">(</span>
</span><span id="__span-15-21"><a id="__codelineno-15-21" name="__codelineno-15-21"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">BucketAlreadyExists</span><span class="p">,</span>
</span><span id="__span-15-22"><a id="__codelineno-15-22" name="__codelineno-15-22"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">BucketAlreadyOwnedByYou</span><span class="p">,</span>
</span><span id="__span-15-23"><a id="__codelineno-15-23" name="__codelineno-15-23"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ClientError</span><span class="p">,</span>
</span><span id="__span-15-24"><a id="__codelineno-15-24" name="__codelineno-15-24"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">InvalidObjectState</span><span class="p">,</span>
</span><span id="__span-15-25"><a id="__codelineno-15-25" name="__codelineno-15-25"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NoSuchBucket</span><span class="p">,</span>
</span><span id="__span-15-26"><a id="__codelineno-15-26" name="__codelineno-15-26"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NoSuchKey</span><span class="p">,</span>
</span><span id="__span-15-27"><a id="__codelineno-15-27" name="__codelineno-15-27"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NoSuchUpload</span><span class="p">,</span>
</span><span id="__span-15-28"><a id="__codelineno-15-28" name="__codelineno-15-28"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ObjectAlreadyInActiveTierError</span><span class="p">,</span>
</span><span id="__span-15-29"><a id="__codelineno-15-29" name="__codelineno-15-29"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ObjectNotInActiveTierError</span><span class="p">,</span>
</span><span id="__span-15-30"><a id="__codelineno-15-30" name="__codelineno-15-30"></a>    <span class="p">)</span>
</span><span id="__span-15-31"><a id="__codelineno-15-31" name="__codelineno-15-31"></a>
</span><span id="__span-15-32"><a id="__codelineno-15-32" name="__codelineno-15-32"></a>
</span><span id="__span-15-33"><a id="__codelineno-15-33" name="__codelineno-15-33"></a><span class="k">def</span> <span class="nf">delete_bucket</span><span class="p">(</span><span class="n">bucket</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="__span-15-34"><a id="__codelineno-15-34" name="__codelineno-15-34"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-15-35"><a id="__codelineno-15-35" name="__codelineno-15-35"></a>        <span class="n">client</span> <span class="o">=</span> <span class="n">__get_client</span><span class="p">()</span>
</span><span id="__span-15-36"><a id="__codelineno-15-36" name="__codelineno-15-36"></a>        <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">delete_bucket</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">)</span>
</span><span id="__span-15-37"><a id="__codelineno-15-37" name="__codelineno-15-37"></a>
</span><span id="__span-15-38"><a id="__codelineno-15-38" name="__codelineno-15-38"></a>    <span class="k">except</span> <span class="n">__get_exceptions</span><span class="p">()</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-15-39"><a id="__codelineno-15-39" name="__codelineno-15-39"></a>        <span class="k">return</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="kn">from</span> <span class="nn">.api</span> <span class="kn">import</span> <span class="n">delete_bucket</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1">1</a></span>
<span class="normal"><a href="#__codelineno-17-2">2</a></span>
<span class="normal"><a href="#__codelineno-17-3">3</a></span>
<span class="normal"><a href="#__codelineno-17-4">4</a></span>
<span class="normal"><a href="#__codelineno-17-5">5</a></span>
<span class="normal"><a href="#__codelineno-17-6">6</a></span>
<span class="normal"><a href="#__codelineno-17-7">7</a></span>
<span class="normal"><a href="#__codelineno-17-8">8</a></span>
<span class="normal"><a href="#__codelineno-17-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="kn">from</span> <span class="nn">rich.pretty</span> <span class="kn">import</span> <span class="n">pprint</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2"></a>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="kn">import</span> <span class="nn">aws_s3</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4"></a>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="n">bucket</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;my-bucket-00000001&quot;</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6"></a>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7"></a><span class="n">result</span> <span class="o">=</span> <span class="n">aws_s3</span><span class="o">.</span><span class="n">delete_bucket</span><span class="p">(</span><span class="n">bucket</span><span class="p">)</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8"></a>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9"></a><span class="n">pprint</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">indent_guides</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>Output:</p>
<div class="language-json highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-18-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-18-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-18-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-18-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-18-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-18-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-18-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-18-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-18-10">10</a></span>
<span class="normal"><a href="#__codelineno-18-11">11</a></span>
<span class="normal"><a href="#__codelineno-18-12">12</a></span>
<span class="normal"><a href="#__codelineno-18-13">13</a></span>
<span class="normal"><a href="#__codelineno-18-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="p">{</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="w">    </span><span class="nt">&quot;ResponseMetadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="w">        </span><span class="nt">&quot;RequestId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;****************&quot;</span><span class="p">,</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="w">        </span><span class="nt">&quot;HostId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;****************&quot;</span><span class="p">,</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="w">        </span><span class="nt">&quot;HTTPStatusCode&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">204</span><span class="p">,</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6"></a><span class="w">        </span><span class="nt">&quot;HTTPHeaders&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7"></a><span class="w">            </span><span class="nt">&quot;x-amz-id-2&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;****************&quot;</span><span class="p">,</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8"></a><span class="w">            </span><span class="nt">&quot;x-amz-request-id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;****************&quot;</span><span class="p">,</span>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9"></a><span class="w">            </span><span class="nt">&quot;date&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sun, 29 Oct 2023 08:44:33 GMT&quot;</span><span class="p">,</span>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10"></a><span class="w">            </span><span class="nt">&quot;server&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AmazonS3&quot;</span><span class="p">,</span>
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12"></a><span class="w">        </span><span class="nt">&quot;RetryAttempts&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
</span><span id="__span-18-13"><a id="__codelineno-18-13" name="__codelineno-18-13"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-18-14"><a id="__codelineno-18-14" name="__codelineno-18-14"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<hr />
<h3 id="fileobject-crud-operations-using-presigned-urls">File/Object CRUD Operations Using Presigned URLs</h3>
<p>Creating presigned URLs for S3 objects using Boto3 is essential when you need to grant temporary, controlled access to your objects. To generate a presigned URL, specify the S3 bucket name and the object's key (the filename or identifier). Using the <code>generate_presigned_url</code> method on the S3 client, you can set the expiration time for the URL and any additional HTTP request parameters, such as downloading or uploading options. Once generated, the presigned URL provides secure, time-limited access to the specified object, which can be useful for sharing files, enabling temporary public access, or granting controlled access to specific users or applications without exposing your S3 objects publicly. For most cases, managing s3 objects using presigned URLs is the simplest and most secure way to do so. A sample implementation and usage is shown below:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The usage samples assume that you have an empty <code>.json</code> file in the project's root directory named <code>sample.json</code> with the content:</p>
<div class="language-json highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">sample.json</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1">1</a></span>
<span class="normal"><a href="#__codelineno-19-2">2</a></span>
<span class="normal"><a href="#__codelineno-19-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="p">{</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="w">    </span><span class="nt">&quot;sample&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;message&quot;</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-set tabbed-alternate" data-tabs="6:6"><input checked="checked" id="__tabbed_6_1" name="__tabbed_6" type="radio" /><input id="__tabbed_6_2" name="__tabbed_6" type="radio" /><input id="__tabbed_6_3" name="__tabbed_6" type="radio" /><input id="__tabbed_6_4" name="__tabbed_6" type="radio" /><input id="__tabbed_6_5" name="__tabbed_6" type="radio" /><input id="__tabbed_6_6" name="__tabbed_6" type="radio" /><div class="tabbed-labels"><label for="__tabbed_6_1">aws_s3/api.py</label><label for="__tabbed_6_2">aws_s3/__init__.py</label><label for="__tabbed_6_3">app.py (<code>PUT</code>)</label><label for="__tabbed_6_4">app.py (<code>HEAD</code>)</label><label for="__tabbed_6_5">app.py (<code>GET</code>)</label><label for="__tabbed_6_6">app.py (<code>DELETE</code>)</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-20-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-20-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-20-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-20-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-20-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-20-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-20-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-20-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-20-10">10</a></span>
<span class="normal"><a href="#__codelineno-20-11">11</a></span>
<span class="normal"><a href="#__codelineno-20-12">12</a></span>
<span class="normal"><a href="#__codelineno-20-13">13</a></span>
<span class="normal"><a href="#__codelineno-20-14">14</a></span>
<span class="normal"><a href="#__codelineno-20-15">15</a></span>
<span class="normal"><a href="#__codelineno-20-16">16</a></span>
<span class="normal"><a href="#__codelineno-20-17">17</a></span>
<span class="normal"><a href="#__codelineno-20-18">18</a></span>
<span class="normal"><a href="#__codelineno-20-19">19</a></span>
<span class="normal"><a href="#__codelineno-20-20">20</a></span>
<span class="normal"><a href="#__codelineno-20-21">21</a></span>
<span class="normal"><a href="#__codelineno-20-22">22</a></span>
<span class="normal"><a href="#__codelineno-20-23">23</a></span>
<span class="normal"><a href="#__codelineno-20-24">24</a></span>
<span class="normal"><a href="#__codelineno-20-25">25</a></span>
<span class="normal"><a href="#__codelineno-20-26">26</a></span>
<span class="normal"><a href="#__codelineno-20-27">27</a></span>
<span class="normal"><a href="#__codelineno-20-28">28</a></span>
<span class="normal"><a href="#__codelineno-20-29">29</a></span>
<span class="normal"><a href="#__codelineno-20-30">30</a></span>
<span class="normal"><a href="#__codelineno-20-31">31</a></span>
<span class="normal"><a href="#__codelineno-20-32">32</a></span>
<span class="normal"><a href="#__codelineno-20-33">33</a></span>
<span class="normal"><a href="#__codelineno-20-34">34</a></span>
<span class="normal"><a href="#__codelineno-20-35">35</a></span>
<span class="normal"><a href="#__codelineno-20-36">36</a></span>
<span class="normal"><a href="#__codelineno-20-37">37</a></span>
<span class="normal"><a href="#__codelineno-20-38">38</a></span>
<span class="normal"><a href="#__codelineno-20-39">39</a></span>
<span class="normal"><a href="#__codelineno-20-40">40</a></span>
<span class="normal"><a href="#__codelineno-20-41">41</a></span>
<span class="normal"><a href="#__codelineno-20-42">42</a></span>
<span class="normal"><a href="#__codelineno-20-43">43</a></span>
<span class="normal"><a href="#__codelineno-20-44">44</a></span>
<span class="normal"><a href="#__codelineno-20-45">45</a></span>
<span class="normal"><a href="#__codelineno-20-46">46</a></span>
<span class="normal"><a href="#__codelineno-20-47">47</a></span>
<span class="normal"><a href="#__codelineno-20-48">48</a></span>
<span class="normal"><a href="#__codelineno-20-49">49</a></span>
<span class="normal"><a href="#__codelineno-20-50">50</a></span>
<span class="normal"><a href="#__codelineno-20-51">51</a></span>
<span class="normal"><a href="#__codelineno-20-52">52</a></span>
<span class="normal"><a href="#__codelineno-20-53">53</a></span>
<span class="normal"><a href="#__codelineno-20-54">54</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2"></a>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="kn">import</span> <span class="nn">functools</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4"></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Union</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5"></a>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6"></a><span class="kn">import</span> <span class="nn">boto3</span> <span class="k">as</span> <span class="nn">aws_sdk</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7"></a><span class="kn">from</span> <span class="nn">mypy_boto3_s3</span> <span class="kn">import</span> <span class="n">S3Client</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8"></a><span class="kn">from</span> <span class="nn">mypy_boto3_s3.client</span> <span class="kn">import</span> <span class="n">BotocoreClientError</span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9"></a>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10"></a>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11"></a><span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12"></a><span class="k">def</span> <span class="nf">__get_client</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">S3Client</span><span class="p">:</span>
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13"></a>    <span class="n">session</span> <span class="o">=</span> <span class="n">aws_sdk</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14"></a>    <span class="k">return</span> <span class="n">session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">&quot;s3&quot;</span><span class="p">)</span>
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15"></a>
</span><span id="__span-20-16"><a id="__codelineno-20-16" name="__codelineno-20-16"></a>
</span><span id="__span-20-17"><a id="__codelineno-20-17" name="__codelineno-20-17"></a><span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-20-18"><a id="__codelineno-20-18" name="__codelineno-20-18"></a><span class="k">def</span> <span class="nf">__get_exceptions</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">BotocoreClientError</span><span class="p">],</span> <span class="o">...</span><span class="p">]:</span>
</span><span id="__span-20-19"><a id="__codelineno-20-19" name="__codelineno-20-19"></a>    <span class="n">client</span> <span class="o">=</span> <span class="n">__get_client</span><span class="p">()</span>
</span><span id="__span-20-20"><a id="__codelineno-20-20" name="__codelineno-20-20"></a>    <span class="k">return</span> <span class="p">(</span>
</span><span id="__span-20-21"><a id="__codelineno-20-21" name="__codelineno-20-21"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">BucketAlreadyExists</span><span class="p">,</span>
</span><span id="__span-20-22"><a id="__codelineno-20-22" name="__codelineno-20-22"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">BucketAlreadyOwnedByYou</span><span class="p">,</span>
</span><span id="__span-20-23"><a id="__codelineno-20-23" name="__codelineno-20-23"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ClientError</span><span class="p">,</span>
</span><span id="__span-20-24"><a id="__codelineno-20-24" name="__codelineno-20-24"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">InvalidObjectState</span><span class="p">,</span>
</span><span id="__span-20-25"><a id="__codelineno-20-25" name="__codelineno-20-25"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NoSuchBucket</span><span class="p">,</span>
</span><span id="__span-20-26"><a id="__codelineno-20-26" name="__codelineno-20-26"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NoSuchKey</span><span class="p">,</span>
</span><span id="__span-20-27"><a id="__codelineno-20-27" name="__codelineno-20-27"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NoSuchUpload</span><span class="p">,</span>
</span><span id="__span-20-28"><a id="__codelineno-20-28" name="__codelineno-20-28"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ObjectAlreadyInActiveTierError</span><span class="p">,</span>
</span><span id="__span-20-29"><a id="__codelineno-20-29" name="__codelineno-20-29"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ObjectNotInActiveTierError</span><span class="p">,</span>
</span><span id="__span-20-30"><a id="__codelineno-20-30" name="__codelineno-20-30"></a>    <span class="p">)</span>
</span><span id="__span-20-31"><a id="__codelineno-20-31" name="__codelineno-20-31"></a>
</span><span id="__span-20-32"><a id="__codelineno-20-32" name="__codelineno-20-32"></a>
</span><span id="__span-20-33"><a id="__codelineno-20-33" name="__codelineno-20-33"></a><span class="n">HTTPVerb</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;PUT&quot;</span><span class="p">,</span> <span class="s2">&quot;DELETE&quot;</span><span class="p">,</span> <span class="s2">&quot;HEAD&quot;</span><span class="p">]</span>
</span><span id="__span-20-34"><a id="__codelineno-20-34" name="__codelineno-20-34"></a>
</span><span id="__span-20-35"><a id="__codelineno-20-35" name="__codelineno-20-35"></a>
</span><span id="__span-20-36"><a id="__codelineno-20-36" name="__codelineno-20-36"></a><span class="k">def</span> <span class="nf">generate_presigned_url</span><span class="p">(</span>
</span><span id="__span-20-37"><a id="__codelineno-20-37" name="__codelineno-20-37"></a>    <span class="n">method</span><span class="p">:</span> <span class="n">HTTPVerb</span><span class="p">,</span> <span class="n">bucket</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">ttl</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3600</span>
</span><span id="__span-20-38"><a id="__codelineno-20-38" name="__codelineno-20-38"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="__span-20-39"><a id="__codelineno-20-39" name="__codelineno-20-39"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-20-40"><a id="__codelineno-20-40" name="__codelineno-20-40"></a>        <span class="n">client</span> <span class="o">=</span> <span class="n">__get_client</span><span class="p">()</span>
</span><span id="__span-20-41"><a id="__codelineno-20-41" name="__codelineno-20-41"></a>        <span class="n">CLIENT_METHOD_DISPATCH</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">HTTPVerb</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-20-42"><a id="__codelineno-20-42" name="__codelineno-20-42"></a>            <span class="s2">&quot;GET&quot;</span><span class="p">:</span> <span class="n">client</span><span class="o">.</span><span class="n">get_object</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
</span><span id="__span-20-43"><a id="__codelineno-20-43" name="__codelineno-20-43"></a>            <span class="s2">&quot;PUT&quot;</span><span class="p">:</span> <span class="n">client</span><span class="o">.</span><span class="n">put_object</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
</span><span id="__span-20-44"><a id="__codelineno-20-44" name="__codelineno-20-44"></a>            <span class="s2">&quot;DELETE&quot;</span><span class="p">:</span> <span class="n">client</span><span class="o">.</span><span class="n">delete_object</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
</span><span id="__span-20-45"><a id="__codelineno-20-45" name="__codelineno-20-45"></a>            <span class="s2">&quot;HEAD&quot;</span><span class="p">:</span> <span class="n">client</span><span class="o">.</span><span class="n">head_object</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
</span><span id="__span-20-46"><a id="__codelineno-20-46" name="__codelineno-20-46"></a>        <span class="p">}</span>
</span><span id="__span-20-47"><a id="__codelineno-20-47" name="__codelineno-20-47"></a>        <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">generate_presigned_url</span><span class="p">(</span>
</span><span id="__span-20-48"><a id="__codelineno-20-48" name="__codelineno-20-48"></a>            <span class="n">ClientMethod</span><span class="o">=</span><span class="n">CLIENT_METHOD_DISPATCH</span><span class="p">[</span><span class="n">method</span><span class="p">],</span>
</span><span id="__span-20-49"><a id="__codelineno-20-49" name="__codelineno-20-49"></a>            <span class="n">Params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Bucket&quot;</span><span class="p">:</span> <span class="n">bucket</span><span class="p">,</span> <span class="s2">&quot;Key&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">},</span>
</span><span id="__span-20-50"><a id="__codelineno-20-50" name="__codelineno-20-50"></a>            <span class="n">ExpiresIn</span><span class="o">=</span><span class="n">ttl</span><span class="p">,</span>
</span><span id="__span-20-51"><a id="__codelineno-20-51" name="__codelineno-20-51"></a>        <span class="p">)</span>
</span><span id="__span-20-52"><a id="__codelineno-20-52" name="__codelineno-20-52"></a>
</span><span id="__span-20-53"><a id="__codelineno-20-53" name="__codelineno-20-53"></a>    <span class="k">except</span> <span class="n">__get_exceptions</span><span class="p">()</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-20-54"><a id="__codelineno-20-54" name="__codelineno-20-54"></a>        <span class="k">return</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="kn">from</span> <span class="nn">.api</span> <span class="kn">import</span> <span class="n">generate_presigned_url</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-22-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-22-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-22-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-22-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-22-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-22-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-22-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-22-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-22-10">10</a></span>
<span class="normal"><a href="#__codelineno-22-11">11</a></span>
<span class="normal"><a href="#__codelineno-22-12">12</a></span>
<span class="normal"><a href="#__codelineno-22-13">13</a></span>
<span class="normal"><a href="#__codelineno-22-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="kn">import</span> <span class="nn">requests</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="kn">from</span> <span class="nn">rich</span> <span class="kn">import</span> <span class="nb">print</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3"></a>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4"></a><span class="kn">import</span> <span class="nn">aws_s3</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5"></a>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6"></a><span class="n">bucket</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;my-bucket-00000001&quot;</span>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7"></a><span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;sample.json&quot;</span>
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8"></a><span class="n">key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;uploaded-sample.json&quot;</span>
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9"></a>
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10"></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">buffer</span><span class="p">:</span>
</span><span id="__span-22-11"><a id="__codelineno-22-11" name="__codelineno-22-11"></a>    <span class="n">url</span> <span class="o">=</span> <span class="n">aws_s3</span><span class="o">.</span><span class="n">generate_presigned_url</span><span class="p">(</span><span class="s2">&quot;PUT&quot;</span><span class="p">,</span> <span class="n">bucket</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</span><span id="__span-22-12"><a id="__codelineno-22-12" name="__codelineno-22-12"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Generated URL: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>
</span><span id="__span-22-13"><a id="__codelineno-22-13" name="__codelineno-22-13"></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">buffer</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span><span id="__span-22-14"><a id="__codelineno-22-14" name="__codelineno-22-14"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-23-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-23-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-23-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-23-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-23-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-23-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-23-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-23-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-23-10">10</a></span>
<span class="normal"><a href="#__codelineno-23-11">11</a></span>
<span class="normal"><a href="#__codelineno-23-12">12</a></span>
<span class="normal"><a href="#__codelineno-23-13">13</a></span>
<span class="normal"><a href="#__codelineno-23-14">14</a></span>
<span class="normal"><a href="#__codelineno-23-15">15</a></span>
<span class="normal"><a href="#__codelineno-23-16">16</a></span>
<span class="normal"><a href="#__codelineno-23-17">17</a></span>
<span class="normal"><a href="#__codelineno-23-18">18</a></span>
<span class="normal"><a href="#__codelineno-23-19">19</a></span>
<span class="normal"><a href="#__codelineno-23-20">20</a></span>
<span class="normal"><a href="#__codelineno-23-21">21</a></span>
<span class="normal"><a href="#__codelineno-23-22">22</a></span>
<span class="normal"><a href="#__codelineno-23-23">23</a></span>
<span class="normal"><a href="#__codelineno-23-24">24</a></span>
<span class="normal"><a href="#__codelineno-23-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="kn">import</span> <span class="nn">requests</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2"></a><span class="kn">from</span> <span class="nn">rich</span> <span class="kn">import</span> <span class="nb">print</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="kn">from</span> <span class="nn">rich.pretty</span> <span class="kn">import</span> <span class="n">pprint</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4"></a>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5"></a><span class="kn">import</span> <span class="nn">aws_s3</span>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6"></a>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7"></a><span class="n">bucket</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;my-bucket-00000001&quot;</span>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8"></a><span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;sample.json&quot;</span>
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9"></a><span class="n">key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;uploaded-sample.json&quot;</span>
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10"></a>
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11"></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">buffer</span><span class="p">:</span>
</span><span id="__span-23-12"><a id="__codelineno-23-12" name="__codelineno-23-12"></a>    <span class="n">url</span> <span class="o">=</span> <span class="n">aws_s3</span><span class="o">.</span><span class="n">generate_presigned_url</span><span class="p">(</span><span class="s2">&quot;HEAD&quot;</span><span class="p">,</span> <span class="n">bucket</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</span><span id="__span-23-13"><a id="__codelineno-23-13" name="__codelineno-23-13"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Generated URL: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>
</span><span id="__span-23-14"><a id="__codelineno-23-14" name="__codelineno-23-14"></a>
</span><span id="__span-23-15"><a id="__codelineno-23-15" name="__codelineno-23-15"></a>    <span class="c1"># This request will get the object&#39;s/file&#39;s URL</span>
</span><span id="__span-23-16"><a id="__codelineno-23-16" name="__codelineno-23-16"></a>    <span class="n">response1</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span id="__span-23-17"><a id="__codelineno-23-17" name="__codelineno-23-17"></a>    <span class="n">pprint</span><span class="p">(</span><span class="n">response1</span><span class="p">)</span>
</span><span id="__span-23-18"><a id="__codelineno-23-18" name="__codelineno-23-18"></a>    <span class="n">pprint</span><span class="p">(</span><span class="n">response1</span><span class="o">.</span><span class="n">headers</span><span class="p">)</span>
</span><span id="__span-23-19"><a id="__codelineno-23-19" name="__codelineno-23-19"></a>    <span class="n">object_url</span> <span class="o">=</span> <span class="n">response1</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">&quot;Location&quot;</span><span class="p">]</span>
</span><span id="__span-23-20"><a id="__codelineno-23-20" name="__codelineno-23-20"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Object URL: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">object_url</span><span class="p">))</span>
</span><span id="__span-23-21"><a id="__codelineno-23-21" name="__codelineno-23-21"></a>
</span><span id="__span-23-22"><a id="__codelineno-23-22" name="__codelineno-23-22"></a>    <span class="c1"># This request will get the object&#39;s/file&#39;s actual metadata</span>
</span><span id="__span-23-23"><a id="__codelineno-23-23" name="__codelineno-23-23"></a>    <span class="n">response2</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">object_url</span><span class="p">)</span>
</span><span id="__span-23-24"><a id="__codelineno-23-24" name="__codelineno-23-24"></a>    <span class="n">pprint</span><span class="p">(</span><span class="n">response2</span><span class="p">)</span>
</span><span id="__span-23-25"><a id="__codelineno-23-25" name="__codelineno-23-25"></a>    <span class="n">pprint</span><span class="p">(</span><span class="n">response2</span><span class="o">.</span><span class="n">headers</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-24-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-24-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-24-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-24-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-24-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-24-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-24-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-24-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-24-10">10</a></span>
<span class="normal"><a href="#__codelineno-24-11">11</a></span>
<span class="normal"><a href="#__codelineno-24-12">12</a></span>
<span class="normal"><a href="#__codelineno-24-13">13</a></span>
<span class="normal"><a href="#__codelineno-24-14">14</a></span>
<span class="normal"><a href="#__codelineno-24-15">15</a></span>
<span class="normal"><a href="#__codelineno-24-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="kn">import</span> <span class="nn">requests</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2"></a><span class="kn">from</span> <span class="nn">rich</span> <span class="kn">import</span> <span class="nb">print</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3"></a>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4"></a><span class="kn">import</span> <span class="nn">aws_s3</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5"></a>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6"></a><span class="n">bucket</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;my-bucket-00000001&quot;</span>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7"></a><span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;sample.json&quot;</span>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8"></a><span class="n">key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;uploaded-sample.json&quot;</span>
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9"></a>
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10"></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">buffer</span><span class="p">:</span>
</span><span id="__span-24-11"><a id="__codelineno-24-11" name="__codelineno-24-11"></a>    <span class="n">url</span> <span class="o">=</span> <span class="n">aws_s3</span><span class="o">.</span><span class="n">generate_presigned_url</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">bucket</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</span><span id="__span-24-12"><a id="__codelineno-24-12" name="__codelineno-24-12"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Generated URL: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>
</span><span id="__span-24-13"><a id="__codelineno-24-13" name="__codelineno-24-13"></a>
</span><span id="__span-24-14"><a id="__codelineno-24-14" name="__codelineno-24-14"></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span id="__span-24-15"><a id="__codelineno-24-15" name="__codelineno-24-15"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span><span id="__span-24-16"><a id="__codelineno-24-16" name="__codelineno-24-16"></a>    <span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-25-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-25-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-25-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-25-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-25-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-25-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-25-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-25-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-25-10">10</a></span>
<span class="normal"><a href="#__codelineno-25-11">11</a></span>
<span class="normal"><a href="#__codelineno-25-12">12</a></span>
<span class="normal"><a href="#__codelineno-25-13">13</a></span>
<span class="normal"><a href="#__codelineno-25-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="kn">import</span> <span class="nn">requests</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2"></a><span class="kn">from</span> <span class="nn">rich</span> <span class="kn">import</span> <span class="nb">print</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3"></a>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4"></a><span class="kn">import</span> <span class="nn">aws_s3</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5"></a>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6"></a><span class="n">bucket</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;my-bucket-00000001&quot;</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7"></a><span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;sample.json&quot;</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8"></a><span class="n">key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;uploaded-sample.json&quot;</span>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9"></a>
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10"></a><span class="n">url</span> <span class="o">=</span> <span class="n">aws_s3</span><span class="o">.</span><span class="n">generate_presigned_url</span><span class="p">(</span><span class="s2">&quot;DELETE&quot;</span><span class="p">,</span> <span class="n">bucket</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Generated URL: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12"></a>
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13"></a><span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span id="__span-25-14"><a id="__codelineno-25-14" name="__codelineno-25-14"></a><span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<hr />
<h3 id="getting-fileobject-metadata">Getting File/Object Metadata</h3>
<p>To get an S3 object's/file's metadata, use the <code>head_object</code> method provided by the S3 client, specifying the bucket name and object key. This operation retrieves metadata about the object, including details like content type, content length, last modified date, and more. This approach is useful for quickly inspecting object attributes and making decisions based on object properties, all without incurring the download cost or transferring the entire file, making it an efficient way to manage and work with your S3 objects. A sample implementation and usage is shown below:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="7:3"><input checked="checked" id="__tabbed_7_1" name="__tabbed_7" type="radio" /><input id="__tabbed_7_2" name="__tabbed_7" type="radio" /><input id="__tabbed_7_3" name="__tabbed_7" type="radio" /><div class="tabbed-labels"><label for="__tabbed_7_1">aws_s3/api.py</label><label for="__tabbed_7_2">aws_s3/__init__.py</label><label for="__tabbed_7_3">app.py</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-26-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-26-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-26-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-26-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-26-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-26-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-26-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-26-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-26-10">10</a></span>
<span class="normal"><a href="#__codelineno-26-11">11</a></span>
<span class="normal"><a href="#__codelineno-26-12">12</a></span>
<span class="normal"><a href="#__codelineno-26-13">13</a></span>
<span class="normal"><a href="#__codelineno-26-14">14</a></span>
<span class="normal"><a href="#__codelineno-26-15">15</a></span>
<span class="normal"><a href="#__codelineno-26-16">16</a></span>
<span class="normal"><a href="#__codelineno-26-17">17</a></span>
<span class="normal"><a href="#__codelineno-26-18">18</a></span>
<span class="normal"><a href="#__codelineno-26-19">19</a></span>
<span class="normal"><a href="#__codelineno-26-20">20</a></span>
<span class="normal"><a href="#__codelineno-26-21">21</a></span>
<span class="normal"><a href="#__codelineno-26-22">22</a></span>
<span class="normal"><a href="#__codelineno-26-23">23</a></span>
<span class="normal"><a href="#__codelineno-26-24">24</a></span>
<span class="normal"><a href="#__codelineno-26-25">25</a></span>
<span class="normal"><a href="#__codelineno-26-26">26</a></span>
<span class="normal"><a href="#__codelineno-26-27">27</a></span>
<span class="normal"><a href="#__codelineno-26-28">28</a></span>
<span class="normal"><a href="#__codelineno-26-29">29</a></span>
<span class="normal"><a href="#__codelineno-26-30">30</a></span>
<span class="normal"><a href="#__codelineno-26-31">31</a></span>
<span class="normal"><a href="#__codelineno-26-32">32</a></span>
<span class="normal"><a href="#__codelineno-26-33">33</a></span>
<span class="normal"><a href="#__codelineno-26-34">34</a></span>
<span class="normal"><a href="#__codelineno-26-35">35</a></span>
<span class="normal"><a href="#__codelineno-26-36">36</a></span>
<span class="normal"><a href="#__codelineno-26-37">37</a></span>
<span class="normal"><a href="#__codelineno-26-38">38</a></span>
<span class="normal"><a href="#__codelineno-26-39">39</a></span>
<span class="normal"><a href="#__codelineno-26-40">40</a></span>
<span class="normal"><a href="#__codelineno-26-41">41</a></span>
<span class="normal"><a href="#__codelineno-26-42">42</a></span>
<span class="normal"><a href="#__codelineno-26-43">43</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2"></a>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3"></a><span class="kn">import</span> <span class="nn">functools</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4"></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Union</span>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5"></a>
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6"></a><span class="kn">import</span> <span class="nn">boto3</span> <span class="k">as</span> <span class="nn">aws_sdk</span>
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7"></a><span class="kn">from</span> <span class="nn">mypy_boto3_s3</span> <span class="kn">import</span> <span class="n">S3Client</span>
</span><span id="__span-26-8"><a id="__codelineno-26-8" name="__codelineno-26-8"></a><span class="kn">from</span> <span class="nn">mypy_boto3_s3.client</span> <span class="kn">import</span> <span class="n">BotocoreClientError</span>
</span><span id="__span-26-9"><a id="__codelineno-26-9" name="__codelineno-26-9"></a><span class="kn">from</span> <span class="nn">mypy_boto3_s3.type_defs</span> <span class="kn">import</span> <span class="n">HeadObjectOutputTypeDef</span>
</span><span id="__span-26-10"><a id="__codelineno-26-10" name="__codelineno-26-10"></a>
</span><span id="__span-26-11"><a id="__codelineno-26-11" name="__codelineno-26-11"></a>
</span><span id="__span-26-12"><a id="__codelineno-26-12" name="__codelineno-26-12"></a><span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-26-13"><a id="__codelineno-26-13" name="__codelineno-26-13"></a><span class="k">def</span> <span class="nf">__get_client</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">S3Client</span><span class="p">:</span>
</span><span id="__span-26-14"><a id="__codelineno-26-14" name="__codelineno-26-14"></a>    <span class="n">session</span> <span class="o">=</span> <span class="n">aws_sdk</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
</span><span id="__span-26-15"><a id="__codelineno-26-15" name="__codelineno-26-15"></a>    <span class="k">return</span> <span class="n">session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">&quot;s3&quot;</span><span class="p">)</span>
</span><span id="__span-26-16"><a id="__codelineno-26-16" name="__codelineno-26-16"></a>
</span><span id="__span-26-17"><a id="__codelineno-26-17" name="__codelineno-26-17"></a>
</span><span id="__span-26-18"><a id="__codelineno-26-18" name="__codelineno-26-18"></a><span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-26-19"><a id="__codelineno-26-19" name="__codelineno-26-19"></a><span class="k">def</span> <span class="nf">__get_exceptions</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">BotocoreClientError</span><span class="p">],</span> <span class="o">...</span><span class="p">]:</span>
</span><span id="__span-26-20"><a id="__codelineno-26-20" name="__codelineno-26-20"></a>    <span class="n">client</span> <span class="o">=</span> <span class="n">__get_client</span><span class="p">()</span>
</span><span id="__span-26-21"><a id="__codelineno-26-21" name="__codelineno-26-21"></a>    <span class="k">return</span> <span class="p">(</span>
</span><span id="__span-26-22"><a id="__codelineno-26-22" name="__codelineno-26-22"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">BucketAlreadyExists</span><span class="p">,</span>
</span><span id="__span-26-23"><a id="__codelineno-26-23" name="__codelineno-26-23"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">BucketAlreadyOwnedByYou</span><span class="p">,</span>
</span><span id="__span-26-24"><a id="__codelineno-26-24" name="__codelineno-26-24"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ClientError</span><span class="p">,</span>
</span><span id="__span-26-25"><a id="__codelineno-26-25" name="__codelineno-26-25"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">InvalidObjectState</span><span class="p">,</span>
</span><span id="__span-26-26"><a id="__codelineno-26-26" name="__codelineno-26-26"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NoSuchBucket</span><span class="p">,</span>
</span><span id="__span-26-27"><a id="__codelineno-26-27" name="__codelineno-26-27"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NoSuchKey</span><span class="p">,</span>
</span><span id="__span-26-28"><a id="__codelineno-26-28" name="__codelineno-26-28"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NoSuchUpload</span><span class="p">,</span>
</span><span id="__span-26-29"><a id="__codelineno-26-29" name="__codelineno-26-29"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ObjectAlreadyInActiveTierError</span><span class="p">,</span>
</span><span id="__span-26-30"><a id="__codelineno-26-30" name="__codelineno-26-30"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ObjectNotInActiveTierError</span><span class="p">,</span>
</span><span id="__span-26-31"><a id="__codelineno-26-31" name="__codelineno-26-31"></a>    <span class="p">)</span>
</span><span id="__span-26-32"><a id="__codelineno-26-32" name="__codelineno-26-32"></a>
</span><span id="__span-26-33"><a id="__codelineno-26-33" name="__codelineno-26-33"></a>
</span><span id="__span-26-34"><a id="__codelineno-26-34" name="__codelineno-26-34"></a><span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">16</span><span class="p">)</span>
</span><span id="__span-26-35"><a id="__codelineno-26-35" name="__codelineno-26-35"></a><span class="k">def</span> <span class="nf">get_object_metadata</span><span class="p">(</span>
</span><span id="__span-26-36"><a id="__codelineno-26-36" name="__codelineno-26-36"></a>    <span class="n">bucket</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="__span-26-37"><a id="__codelineno-26-37" name="__codelineno-26-37"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">HeadObjectOutputTypeDef</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="__span-26-38"><a id="__codelineno-26-38" name="__codelineno-26-38"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-26-39"><a id="__codelineno-26-39" name="__codelineno-26-39"></a>        <span class="n">client</span> <span class="o">=</span> <span class="n">__get_client</span><span class="p">()</span>
</span><span id="__span-26-40"><a id="__codelineno-26-40" name="__codelineno-26-40"></a>        <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">head_object</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">,</span> <span class="n">Key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
</span><span id="__span-26-41"><a id="__codelineno-26-41" name="__codelineno-26-41"></a>
</span><span id="__span-26-42"><a id="__codelineno-26-42" name="__codelineno-26-42"></a>    <span class="k">except</span> <span class="n">__get_exceptions</span><span class="p">()</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-26-43"><a id="__codelineno-26-43" name="__codelineno-26-43"></a>        <span class="k">return</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="kn">from</span> <span class="nn">.api</span> <span class="kn">import</span> <span class="n">get_object_metadata</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-28-1">1</a></span>
<span class="normal"><a href="#__codelineno-28-2">2</a></span>
<span class="normal"><a href="#__codelineno-28-3">3</a></span>
<span class="normal"><a href="#__codelineno-28-4">4</a></span>
<span class="normal"><a href="#__codelineno-28-5">5</a></span>
<span class="normal"><a href="#__codelineno-28-6">6</a></span>
<span class="normal"><a href="#__codelineno-28-7">7</a></span>
<span class="normal"><a href="#__codelineno-28-8">8</a></span>
<span class="normal"><a href="#__codelineno-28-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="kn">from</span> <span class="nn">rich.pretty</span> <span class="kn">import</span> <span class="n">pprint</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2"></a>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3"></a><span class="kn">import</span> <span class="nn">aws_s3</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4"></a>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5"></a><span class="n">bucket</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;my-bucket-00000001&quot;</span>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6"></a><span class="n">key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;uploaded-sample.json&quot;</span>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7"></a>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8"></a><span class="n">result</span> <span class="o">=</span> <span class="n">aws_s3</span><span class="o">.</span><span class="n">get_object_metadata</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9"></a><span class="n">pprint</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>Output:</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-29-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-29-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-29-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-29-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-29-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-29-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-29-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-29-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-29-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-29-10">10</a></span>
<span class="normal"><a href="#__codelineno-29-11">11</a></span>
<span class="normal"><a href="#__codelineno-29-12">12</a></span>
<span class="normal"><a href="#__codelineno-29-13">13</a></span>
<span class="normal"><a href="#__codelineno-29-14">14</a></span>
<span class="normal"><a href="#__codelineno-29-15">15</a></span>
<span class="normal"><a href="#__codelineno-29-16">16</a></span>
<span class="normal"><a href="#__codelineno-29-17">17</a></span>
<span class="normal"><a href="#__codelineno-29-18">18</a></span>
<span class="normal"><a href="#__codelineno-29-19">19</a></span>
<span class="normal"><a href="#__codelineno-29-20">20</a></span>
<span class="normal"><a href="#__codelineno-29-21">21</a></span>
<span class="normal"><a href="#__codelineno-29-22">22</a></span>
<span class="normal"><a href="#__codelineno-29-23">23</a></span>
<span class="normal"><a href="#__codelineno-29-24">24</a></span>
<span class="normal"><a href="#__codelineno-29-25">25</a></span>
<span class="normal"><a href="#__codelineno-29-26">26</a></span>
<span class="normal"><a href="#__codelineno-29-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="p">{</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2"></a>    <span class="s2">&quot;ResponseMetadata&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3"></a>        <span class="s2">&quot;RequestId&quot;</span><span class="p">:</span> <span class="s2">&quot;****************&quot;</span><span class="p">,</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4"></a>        <span class="s2">&quot;HostId&quot;</span><span class="p">:</span> <span class="s2">&quot;****************&quot;</span><span class="p">,</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5"></a>        <span class="s2">&quot;HTTPStatusCode&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6"></a>        <span class="s2">&quot;HTTPHeaders&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7"></a>            <span class="s2">&quot;x-amz-id-2&quot;</span><span class="p">:</span> <span class="s2">&quot;****************&quot;</span><span class="p">,</span>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8"></a>            <span class="s2">&quot;x-amz-request-id&quot;</span><span class="p">:</span> <span class="s2">&quot;****************&quot;</span><span class="p">,</span>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9"></a>            <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;Sun, 29 Oct 2023 14:54:18 GMT&quot;</span><span class="p">,</span>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10"></a>            <span class="s2">&quot;last-modified&quot;</span><span class="p">:</span> <span class="s2">&quot;Sun, 29 Oct 2023 13:47:57 GMT&quot;</span><span class="p">,</span>
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11"></a>            <span class="s2">&quot;etag&quot;</span><span class="p">:</span> <span class="s1">&#39;&quot;5bd9fe559a5630150c700f98bf10fe79&quot;&#39;</span><span class="p">,</span>
</span><span id="__span-29-12"><a id="__codelineno-29-12" name="__codelineno-29-12"></a>            <span class="s2">&quot;x-amz-server-side-encryption&quot;</span><span class="p">:</span> <span class="s2">&quot;AES256&quot;</span><span class="p">,</span>
</span><span id="__span-29-13"><a id="__codelineno-29-13" name="__codelineno-29-13"></a>            <span class="s2">&quot;accept-ranges&quot;</span><span class="p">:</span> <span class="s2">&quot;bytes&quot;</span><span class="p">,</span>
</span><span id="__span-29-14"><a id="__codelineno-29-14" name="__codelineno-29-14"></a>            <span class="s2">&quot;content-type&quot;</span><span class="p">:</span> <span class="s2">&quot;binary/octet-stream&quot;</span><span class="p">,</span>
</span><span id="__span-29-15"><a id="__codelineno-29-15" name="__codelineno-29-15"></a>            <span class="s2">&quot;server&quot;</span><span class="p">:</span> <span class="s2">&quot;AmazonS3&quot;</span><span class="p">,</span>
</span><span id="__span-29-16"><a id="__codelineno-29-16" name="__codelineno-29-16"></a>            <span class="s2">&quot;content-length&quot;</span><span class="p">:</span> <span class="s2">&quot;28&quot;</span><span class="p">,</span>
</span><span id="__span-29-17"><a id="__codelineno-29-17" name="__codelineno-29-17"></a>        <span class="p">},</span>
</span><span id="__span-29-18"><a id="__codelineno-29-18" name="__codelineno-29-18"></a>        <span class="s2">&quot;RetryAttempts&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-29-19"><a id="__codelineno-29-19" name="__codelineno-29-19"></a>    <span class="p">},</span>
</span><span id="__span-29-20"><a id="__codelineno-29-20" name="__codelineno-29-20"></a>    <span class="s2">&quot;AcceptRanges&quot;</span><span class="p">:</span> <span class="s2">&quot;bytes&quot;</span><span class="p">,</span>
</span><span id="__span-29-21"><a id="__codelineno-29-21" name="__codelineno-29-21"></a>    <span class="s2">&quot;LastModified&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">57</span><span class="p">,</span> <span class="n">tzinfo</span><span class="o">=</span><span class="n">tzutc</span><span class="p">()),</span>
</span><span id="__span-29-22"><a id="__codelineno-29-22" name="__codelineno-29-22"></a>    <span class="s2">&quot;ContentLength&quot;</span><span class="p">:</span> <span class="mi">28</span><span class="p">,</span>
</span><span id="__span-29-23"><a id="__codelineno-29-23" name="__codelineno-29-23"></a>    <span class="s2">&quot;ETag&quot;</span><span class="p">:</span> <span class="s1">&#39;&quot;5bd9fe559a5630150c700f98bf10fe79&quot;&#39;</span><span class="p">,</span>
</span><span id="__span-29-24"><a id="__codelineno-29-24" name="__codelineno-29-24"></a>    <span class="s2">&quot;ContentType&quot;</span><span class="p">:</span> <span class="s2">&quot;binary/octet-stream&quot;</span><span class="p">,</span>
</span><span id="__span-29-25"><a id="__codelineno-29-25" name="__codelineno-29-25"></a>    <span class="s2">&quot;ServerSideEncryption&quot;</span><span class="p">:</span> <span class="s2">&quot;AES256&quot;</span><span class="p">,</span>
</span><span id="__span-29-26"><a id="__codelineno-29-26" name="__codelineno-29-26"></a>    <span class="s2">&quot;Metadata&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="__span-29-27"><a id="__codelineno-29-27" name="__codelineno-29-27"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<hr />
<h3 id="listing-multiple-objects-in-a-bucket">Listing Multiple Objects in a Bucket</h3>
<p>To list objects in an S3 bucket, use the <code>list_objects</code> method, specifying the bucket name and optional parameters to filter or paginate results. This operation returns a list of objects within the specified bucket, including their keys, sizes, and other metadata.  A sample implementation and usage is shown below:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="8:3"><input checked="checked" id="__tabbed_8_1" name="__tabbed_8" type="radio" /><input id="__tabbed_8_2" name="__tabbed_8" type="radio" /><input id="__tabbed_8_3" name="__tabbed_8" type="radio" /><div class="tabbed-labels"><label for="__tabbed_8_1">aws_s3/api.py</label><label for="__tabbed_8_2">aws_s3/__init__.py</label><label for="__tabbed_8_3">app.py</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-30-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-30-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-30-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-30-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-30-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-30-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-30-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-30-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-30-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-30-10">10</a></span>
<span class="normal"><a href="#__codelineno-30-11">11</a></span>
<span class="normal"><a href="#__codelineno-30-12">12</a></span>
<span class="normal"><a href="#__codelineno-30-13">13</a></span>
<span class="normal"><a href="#__codelineno-30-14">14</a></span>
<span class="normal"><a href="#__codelineno-30-15">15</a></span>
<span class="normal"><a href="#__codelineno-30-16">16</a></span>
<span class="normal"><a href="#__codelineno-30-17">17</a></span>
<span class="normal"><a href="#__codelineno-30-18">18</a></span>
<span class="normal"><a href="#__codelineno-30-19">19</a></span>
<span class="normal"><a href="#__codelineno-30-20">20</a></span>
<span class="normal"><a href="#__codelineno-30-21">21</a></span>
<span class="normal"><a href="#__codelineno-30-22">22</a></span>
<span class="normal"><a href="#__codelineno-30-23">23</a></span>
<span class="normal"><a href="#__codelineno-30-24">24</a></span>
<span class="normal"><a href="#__codelineno-30-25">25</a></span>
<span class="normal"><a href="#__codelineno-30-26">26</a></span>
<span class="normal"><a href="#__codelineno-30-27">27</a></span>
<span class="normal"><a href="#__codelineno-30-28">28</a></span>
<span class="normal"><a href="#__codelineno-30-29">29</a></span>
<span class="normal"><a href="#__codelineno-30-30">30</a></span>
<span class="normal"><a href="#__codelineno-30-31">31</a></span>
<span class="normal"><a href="#__codelineno-30-32">32</a></span>
<span class="normal"><a href="#__codelineno-30-33">33</a></span>
<span class="normal"><a href="#__codelineno-30-34">34</a></span>
<span class="normal"><a href="#__codelineno-30-35">35</a></span>
<span class="normal"><a href="#__codelineno-30-36">36</a></span>
<span class="normal"><a href="#__codelineno-30-37">37</a></span>
<span class="normal"><a href="#__codelineno-30-38">38</a></span>
<span class="normal"><a href="#__codelineno-30-39">39</a></span>
<span class="normal"><a href="#__codelineno-30-40">40</a></span>
<span class="normal"><a href="#__codelineno-30-41">41</a></span>
<span class="normal"><a href="#__codelineno-30-42">42</a></span>
<span class="normal"><a href="#__codelineno-30-43">43</a></span>
<span class="normal"><a href="#__codelineno-30-44">44</a></span>
<span class="normal"><a href="#__codelineno-30-45">45</a></span>
<span class="normal"><a href="#__codelineno-30-46">46</a></span>
<span class="normal"><a href="#__codelineno-30-47">47</a></span>
<span class="normal"><a href="#__codelineno-30-48">48</a></span>
<span class="normal"><a href="#__codelineno-30-49">49</a></span>
<span class="normal"><a href="#__codelineno-30-50">50</a></span>
<span class="normal"><a href="#__codelineno-30-51">51</a></span>
<span class="normal"><a href="#__codelineno-30-52">52</a></span>
<span class="normal"><a href="#__codelineno-30-53">53</a></span>
<span class="normal"><a href="#__codelineno-30-54">54</a></span>
<span class="normal"><a href="#__codelineno-30-55">55</a></span>
<span class="normal"><a href="#__codelineno-30-56">56</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2"></a>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3"></a><span class="kn">import</span> <span class="nn">functools</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4"></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">cast</span>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5"></a>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6"></a><span class="kn">import</span> <span class="nn">boto3</span> <span class="k">as</span> <span class="nn">aws_sdk</span>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7"></a><span class="kn">from</span> <span class="nn">mypy_boto3_s3</span> <span class="kn">import</span> <span class="n">S3Client</span>
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8"></a><span class="kn">from</span> <span class="nn">mypy_boto3_s3.client</span> <span class="kn">import</span> <span class="n">BotocoreClientError</span>
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9"></a><span class="kn">from</span> <span class="nn">mypy_boto3_s3.paginator</span> <span class="kn">import</span> <span class="n">ListObjectsV2Paginator</span>
</span><span id="__span-30-10"><a id="__codelineno-30-10" name="__codelineno-30-10"></a><span class="kn">from</span> <span class="nn">mypy_boto3_s3.type_defs</span> <span class="kn">import</span> <span class="n">ObjectTypeDef</span>
</span><span id="__span-30-11"><a id="__codelineno-30-11" name="__codelineno-30-11"></a>
</span><span id="__span-30-12"><a id="__codelineno-30-12" name="__codelineno-30-12"></a>
</span><span id="__span-30-13"><a id="__codelineno-30-13" name="__codelineno-30-13"></a><span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-30-14"><a id="__codelineno-30-14" name="__codelineno-30-14"></a><span class="k">def</span> <span class="nf">__get_client</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">S3Client</span><span class="p">:</span>
</span><span id="__span-30-15"><a id="__codelineno-30-15" name="__codelineno-30-15"></a>    <span class="n">session</span> <span class="o">=</span> <span class="n">aws_sdk</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
</span><span id="__span-30-16"><a id="__codelineno-30-16" name="__codelineno-30-16"></a>    <span class="k">return</span> <span class="n">session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">&quot;s3&quot;</span><span class="p">)</span>
</span><span id="__span-30-17"><a id="__codelineno-30-17" name="__codelineno-30-17"></a>
</span><span id="__span-30-18"><a id="__codelineno-30-18" name="__codelineno-30-18"></a>
</span><span id="__span-30-19"><a id="__codelineno-30-19" name="__codelineno-30-19"></a><span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-30-20"><a id="__codelineno-30-20" name="__codelineno-30-20"></a><span class="k">def</span> <span class="nf">__get_exceptions</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">BotocoreClientError</span><span class="p">],</span> <span class="o">...</span><span class="p">]:</span>
</span><span id="__span-30-21"><a id="__codelineno-30-21" name="__codelineno-30-21"></a>    <span class="n">client</span> <span class="o">=</span> <span class="n">__get_client</span><span class="p">()</span>
</span><span id="__span-30-22"><a id="__codelineno-30-22" name="__codelineno-30-22"></a>    <span class="k">return</span> <span class="p">(</span>
</span><span id="__span-30-23"><a id="__codelineno-30-23" name="__codelineno-30-23"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">BucketAlreadyExists</span><span class="p">,</span>
</span><span id="__span-30-24"><a id="__codelineno-30-24" name="__codelineno-30-24"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">BucketAlreadyOwnedByYou</span><span class="p">,</span>
</span><span id="__span-30-25"><a id="__codelineno-30-25" name="__codelineno-30-25"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ClientError</span><span class="p">,</span>
</span><span id="__span-30-26"><a id="__codelineno-30-26" name="__codelineno-30-26"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">InvalidObjectState</span><span class="p">,</span>
</span><span id="__span-30-27"><a id="__codelineno-30-27" name="__codelineno-30-27"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NoSuchBucket</span><span class="p">,</span>
</span><span id="__span-30-28"><a id="__codelineno-30-28" name="__codelineno-30-28"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NoSuchKey</span><span class="p">,</span>
</span><span id="__span-30-29"><a id="__codelineno-30-29" name="__codelineno-30-29"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NoSuchUpload</span><span class="p">,</span>
</span><span id="__span-30-30"><a id="__codelineno-30-30" name="__codelineno-30-30"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ObjectAlreadyInActiveTierError</span><span class="p">,</span>
</span><span id="__span-30-31"><a id="__codelineno-30-31" name="__codelineno-30-31"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ObjectNotInActiveTierError</span><span class="p">,</span>
</span><span id="__span-30-32"><a id="__codelineno-30-32" name="__codelineno-30-32"></a>    <span class="p">)</span>
</span><span id="__span-30-33"><a id="__codelineno-30-33" name="__codelineno-30-33"></a>
</span><span id="__span-30-34"><a id="__codelineno-30-34" name="__codelineno-30-34"></a>
</span><span id="__span-30-35"><a id="__codelineno-30-35" name="__codelineno-30-35"></a><span class="k">def</span> <span class="nf">list_objects</span><span class="p">(</span>
</span><span id="__span-30-36"><a id="__codelineno-30-36" name="__codelineno-30-36"></a>    <span class="n">bucket</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">prefix</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-30-37"><a id="__codelineno-30-37" name="__codelineno-30-37"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">ObjectTypeDef</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="__span-30-38"><a id="__codelineno-30-38" name="__codelineno-30-38"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-30-39"><a id="__codelineno-30-39" name="__codelineno-30-39"></a><span class="sd">    Reference/s:</span>
</span><span id="__span-30-40"><a id="__codelineno-30-40" name="__codelineno-30-40"></a><span class="sd">        - [StackOverflow](https://stackoverflow.com/a/59816089)</span>
</span><span id="__span-30-41"><a id="__codelineno-30-41" name="__codelineno-30-41"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-30-42"><a id="__codelineno-30-42" name="__codelineno-30-42"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-30-43"><a id="__codelineno-30-43" name="__codelineno-30-43"></a>        <span class="n">client</span> <span class="o">=</span> <span class="n">__get_client</span><span class="p">()</span>
</span><span id="__span-30-44"><a id="__codelineno-30-44" name="__codelineno-30-44"></a>        <span class="n">paginator</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
</span><span id="__span-30-45"><a id="__codelineno-30-45" name="__codelineno-30-45"></a>            <span class="n">ListObjectsV2Paginator</span><span class="p">,</span>
</span><span id="__span-30-46"><a id="__codelineno-30-46" name="__codelineno-30-46"></a>            <span class="n">client</span><span class="o">.</span><span class="n">get_paginator</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">list_objects_v2</span><span class="o">.</span><span class="vm">__name__</span><span class="p">),</span>
</span><span id="__span-30-47"><a id="__codelineno-30-47" name="__codelineno-30-47"></a>        <span class="p">)</span>
</span><span id="__span-30-48"><a id="__codelineno-30-48" name="__codelineno-30-48"></a>
</span><span id="__span-30-49"><a id="__codelineno-30-49" name="__codelineno-30-49"></a>        <span class="n">result</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ObjectTypeDef</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-30-50"><a id="__codelineno-30-50" name="__codelineno-30-50"></a>        <span class="k">for</span> <span class="n">each_page</span> <span class="ow">in</span> <span class="n">paginator</span><span class="o">.</span><span class="n">paginate</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">,</span> <span class="n">Prefix</span><span class="o">=</span><span class="n">prefix</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="__span-30-51"><a id="__codelineno-30-51" name="__codelineno-30-51"></a>            <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">each_page</span><span class="p">[</span><span class="s2">&quot;Contents&quot;</span><span class="p">])</span>
</span><span id="__span-30-52"><a id="__codelineno-30-52" name="__codelineno-30-52"></a>
</span><span id="__span-30-53"><a id="__codelineno-30-53" name="__codelineno-30-53"></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="__span-30-54"><a id="__codelineno-30-54" name="__codelineno-30-54"></a>
</span><span id="__span-30-55"><a id="__codelineno-30-55" name="__codelineno-30-55"></a>    <span class="k">except</span> <span class="n">__get_exceptions</span><span class="p">()</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-30-56"><a id="__codelineno-30-56" name="__codelineno-30-56"></a>        <span class="k">return</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-31-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="kn">from</span> <span class="nn">.api</span> <span class="kn">import</span> <span class="n">list_objects</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-32-1">1</a></span>
<span class="normal"><a href="#__codelineno-32-2">2</a></span>
<span class="normal"><a href="#__codelineno-32-3">3</a></span>
<span class="normal"><a href="#__codelineno-32-4">4</a></span>
<span class="normal"><a href="#__codelineno-32-5">5</a></span>
<span class="normal"><a href="#__codelineno-32-6">6</a></span>
<span class="normal"><a href="#__codelineno-32-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="kn">from</span> <span class="nn">rich.pretty</span> <span class="kn">import</span> <span class="n">pprint</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2"></a>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3"></a><span class="kn">import</span> <span class="nn">aws_s3</span>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4"></a>
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5"></a><span class="n">bucket</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;my-bucket-00000001&quot;</span>
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6"></a><span class="n">result</span> <span class="o">=</span> <span class="n">aws_s3</span><span class="o">.</span><span class="n">list_objects</span><span class="p">(</span><span class="n">bucket</span><span class="p">)</span>
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7"></a><span class="n">pprint</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">indent_guides</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>Output:</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-33-1">1</a></span>
<span class="normal"><a href="#__codelineno-33-2">2</a></span>
<span class="normal"><a href="#__codelineno-33-3">3</a></span>
<span class="normal"><a href="#__codelineno-33-4">4</a></span>
<span class="normal"><a href="#__codelineno-33-5">5</a></span>
<span class="normal"><a href="#__codelineno-33-6">6</a></span>
<span class="normal"><a href="#__codelineno-33-7">7</a></span>
<span class="normal"><a href="#__codelineno-33-8">8</a></span>
<span class="normal"><a href="#__codelineno-33-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="p">[</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2"></a>    <span class="p">{</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3"></a>        <span class="s2">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;uploaded-sample.json&quot;</span><span class="p">,</span>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4"></a>        <span class="s2">&quot;LastModified&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">57</span><span class="p">,</span> <span class="n">tzinfo</span><span class="o">=</span><span class="n">tzutc</span><span class="p">()),</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5"></a>        <span class="s2">&quot;ETag&quot;</span><span class="p">:</span> <span class="s1">&#39;&quot;5bd9fe559a5630150c700f98bf10fe79&quot;&#39;</span><span class="p">,</span>
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6"></a>        <span class="s2">&quot;Size&quot;</span><span class="p">:</span> <span class="mi">28</span><span class="p">,</span>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7"></a>        <span class="s2">&quot;StorageClass&quot;</span><span class="p">:</span> <span class="s2">&quot;STANDARD&quot;</span><span class="p">,</span>
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8"></a>    <span class="p">}</span>
</span><span id="__span-33-9"><a id="__codelineno-33-9" name="__codelineno-33-9"></a><span class="p">]</span>
</span></code></pre></div></td></tr></table></div>
<hr />
<h3 id="uploading-a-fileobject">Uploading a File/Object</h3>
<p>Uploading a file to an S3 bucket using Boto3 offers multiple methods, providing flexibility to suit different use cases. One common approach is to use the <code>upload_file</code> method of the S3 client, specifying the local file path and the destination bucket and object key. Alternatively, you can utilize the <code>put_object</code> method, providing the object's content and metadata directly from your Python code. For more extensive or streaming uploads, you can use the multipart upload feature by breaking the file into smaller parts and sending them concurrently, which can be especially useful for large files (I don't have any implementation sample of this at the moment ). A sample implementation and usage is shown below:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="9:3"><input checked="checked" id="__tabbed_9_1" name="__tabbed_9" type="radio" /><input id="__tabbed_9_2" name="__tabbed_9" type="radio" /><input id="__tabbed_9_3" name="__tabbed_9" type="radio" /><div class="tabbed-labels"><label for="__tabbed_9_1">aws_s3/api.py</label><label for="__tabbed_9_2">aws_s3/__init__.py</label><label for="__tabbed_9_3">app.py</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-34-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-34-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-34-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-34-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-34-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-34-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-34-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-34-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-34-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-34-10">10</a></span>
<span class="normal"><a href="#__codelineno-34-11">11</a></span>
<span class="normal"><a href="#__codelineno-34-12">12</a></span>
<span class="normal"><a href="#__codelineno-34-13">13</a></span>
<span class="normal"><a href="#__codelineno-34-14">14</a></span>
<span class="normal"><a href="#__codelineno-34-15">15</a></span>
<span class="normal"><a href="#__codelineno-34-16">16</a></span>
<span class="normal"><a href="#__codelineno-34-17">17</a></span>
<span class="normal"><a href="#__codelineno-34-18">18</a></span>
<span class="normal"><a href="#__codelineno-34-19">19</a></span>
<span class="normal"><a href="#__codelineno-34-20">20</a></span>
<span class="normal"><a href="#__codelineno-34-21">21</a></span>
<span class="normal"><a href="#__codelineno-34-22">22</a></span>
<span class="normal"><a href="#__codelineno-34-23">23</a></span>
<span class="normal"><a href="#__codelineno-34-24">24</a></span>
<span class="normal"><a href="#__codelineno-34-25">25</a></span>
<span class="normal"><a href="#__codelineno-34-26">26</a></span>
<span class="normal"><a href="#__codelineno-34-27">27</a></span>
<span class="normal"><a href="#__codelineno-34-28">28</a></span>
<span class="normal"><a href="#__codelineno-34-29">29</a></span>
<span class="normal"><a href="#__codelineno-34-30">30</a></span>
<span class="normal"><a href="#__codelineno-34-31">31</a></span>
<span class="normal"><a href="#__codelineno-34-32">32</a></span>
<span class="normal"><a href="#__codelineno-34-33">33</a></span>
<span class="normal"><a href="#__codelineno-34-34">34</a></span>
<span class="normal"><a href="#__codelineno-34-35">35</a></span>
<span class="normal"><a href="#__codelineno-34-36">36</a></span>
<span class="normal"><a href="#__codelineno-34-37">37</a></span>
<span class="normal"><a href="#__codelineno-34-38">38</a></span>
<span class="normal"><a href="#__codelineno-34-39">39</a></span>
<span class="normal"><a href="#__codelineno-34-40">40</a></span>
<span class="normal"><a href="#__codelineno-34-41">41</a></span>
<span class="normal"><a href="#__codelineno-34-42">42</a></span>
<span class="normal"><a href="#__codelineno-34-43">43</a></span>
<span class="normal"><a href="#__codelineno-34-44">44</a></span>
<span class="normal"><a href="#__codelineno-34-45">45</a></span>
<span class="normal"><a href="#__codelineno-34-46">46</a></span>
<span class="normal"><a href="#__codelineno-34-47">47</a></span>
<span class="normal"><a href="#__codelineno-34-48">48</a></span>
<span class="normal"><a href="#__codelineno-34-49">49</a></span>
<span class="normal"><a href="#__codelineno-34-50">50</a></span>
<span class="normal"><a href="#__codelineno-34-51">51</a></span>
<span class="normal"><a href="#__codelineno-34-52">52</a></span>
<span class="normal"><a href="#__codelineno-34-53">53</a></span>
<span class="normal"><a href="#__codelineno-34-54">54</a></span>
<span class="normal"><a href="#__codelineno-34-55">55</a></span>
<span class="normal"><a href="#__codelineno-34-56">56</a></span>
<span class="normal"><a href="#__codelineno-34-57">57</a></span>
<span class="normal"><a href="#__codelineno-34-58">58</a></span>
<span class="normal"><a href="#__codelineno-34-59">59</a></span>
<span class="normal"><a href="#__codelineno-34-60">60</a></span>
<span class="normal"><a href="#__codelineno-34-61">61</a></span>
<span class="normal"><a href="#__codelineno-34-62">62</a></span>
<span class="normal"><a href="#__codelineno-34-63">63</a></span>
<span class="normal"><a href="#__codelineno-34-64">64</a></span>
<span class="normal"><a href="#__codelineno-34-65">65</a></span>
<span class="normal"><a href="#__codelineno-34-66">66</a></span>
<span class="normal"><a href="#__codelineno-34-67">67</a></span>
<span class="normal"><a href="#__codelineno-34-68">68</a></span>
<span class="normal"><a href="#__codelineno-34-69">69</a></span>
<span class="normal"><a href="#__codelineno-34-70">70</a></span>
<span class="normal"><a href="#__codelineno-34-71">71</a></span>
<span class="normal"><a href="#__codelineno-34-72">72</a></span>
<span class="normal"><a href="#__codelineno-34-73">73</a></span>
<span class="normal"><a href="#__codelineno-34-74">74</a></span>
<span class="normal"><a href="#__codelineno-34-75">75</a></span>
<span class="normal"><a href="#__codelineno-34-76">76</a></span>
<span class="normal"><a href="#__codelineno-34-77">77</a></span>
<span class="normal"><a href="#__codelineno-34-78">78</a></span>
<span class="normal"><a href="#__codelineno-34-79">79</a></span>
<span class="normal"><a href="#__codelineno-34-80">80</a></span>
<span class="normal"><a href="#__codelineno-34-81">81</a></span>
<span class="normal"><a href="#__codelineno-34-82">82</a></span>
<span class="normal"><a href="#__codelineno-34-83">83</a></span>
<span class="normal"><a href="#__codelineno-34-84">84</a></span>
<span class="normal"><a href="#__codelineno-34-85">85</a></span>
<span class="normal"><a href="#__codelineno-34-86">86</a></span>
<span class="normal"><a href="#__codelineno-34-87">87</a></span>
<span class="normal"><a href="#__codelineno-34-88">88</a></span>
<span class="normal"><a href="#__codelineno-34-89">89</a></span>
<span class="normal"><a href="#__codelineno-34-90">90</a></span>
<span class="normal"><a href="#__codelineno-34-91">91</a></span>
<span class="normal"><a href="#__codelineno-34-92">92</a></span>
<span class="normal"><a href="#__codelineno-34-93">93</a></span>
<span class="normal"><a href="#__codelineno-34-94">94</a></span>
<span class="normal"><a href="#__codelineno-34-95">95</a></span>
<span class="normal"><a href="#__codelineno-34-96">96</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2"></a>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3"></a><span class="kn">import</span> <span class="nn">functools</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4"></a><span class="kn">import</span> <span class="nn">os</span>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5"></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Union</span>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6"></a>
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7"></a><span class="kn">import</span> <span class="nn">boto3</span> <span class="k">as</span> <span class="nn">aws_sdk</span>
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8"></a><span class="kn">from</span> <span class="nn">mypy_boto3_s3</span> <span class="kn">import</span> <span class="n">S3Client</span>
</span><span id="__span-34-9"><a id="__codelineno-34-9" name="__codelineno-34-9"></a><span class="kn">from</span> <span class="nn">mypy_boto3_s3.client</span> <span class="kn">import</span> <span class="n">BotocoreClientError</span>
</span><span id="__span-34-10"><a id="__codelineno-34-10" name="__codelineno-34-10"></a><span class="kn">from</span> <span class="nn">mypy_boto3_s3.type_defs</span> <span class="kn">import</span> <span class="n">PutObjectOutputTypeDef</span>
</span><span id="__span-34-11"><a id="__codelineno-34-11" name="__codelineno-34-11"></a>
</span><span id="__span-34-12"><a id="__codelineno-34-12" name="__codelineno-34-12"></a>
</span><span id="__span-34-13"><a id="__codelineno-34-13" name="__codelineno-34-13"></a><span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-34-14"><a id="__codelineno-34-14" name="__codelineno-34-14"></a><span class="k">def</span> <span class="nf">__get_client</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">S3Client</span><span class="p">:</span>
</span><span id="__span-34-15"><a id="__codelineno-34-15" name="__codelineno-34-15"></a>    <span class="n">session</span> <span class="o">=</span> <span class="n">aws_sdk</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
</span><span id="__span-34-16"><a id="__codelineno-34-16" name="__codelineno-34-16"></a>    <span class="k">return</span> <span class="n">session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">&quot;s3&quot;</span><span class="p">)</span>
</span><span id="__span-34-17"><a id="__codelineno-34-17" name="__codelineno-34-17"></a>
</span><span id="__span-34-18"><a id="__codelineno-34-18" name="__codelineno-34-18"></a>
</span><span id="__span-34-19"><a id="__codelineno-34-19" name="__codelineno-34-19"></a><span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-34-20"><a id="__codelineno-34-20" name="__codelineno-34-20"></a><span class="k">def</span> <span class="nf">__get_exceptions</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">BotocoreClientError</span><span class="p">],</span> <span class="o">...</span><span class="p">]:</span>
</span><span id="__span-34-21"><a id="__codelineno-34-21" name="__codelineno-34-21"></a>    <span class="n">client</span> <span class="o">=</span> <span class="n">__get_client</span><span class="p">()</span>
</span><span id="__span-34-22"><a id="__codelineno-34-22" name="__codelineno-34-22"></a>    <span class="k">return</span> <span class="p">(</span>
</span><span id="__span-34-23"><a id="__codelineno-34-23" name="__codelineno-34-23"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">BucketAlreadyExists</span><span class="p">,</span>
</span><span id="__span-34-24"><a id="__codelineno-34-24" name="__codelineno-34-24"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">BucketAlreadyOwnedByYou</span><span class="p">,</span>
</span><span id="__span-34-25"><a id="__codelineno-34-25" name="__codelineno-34-25"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ClientError</span><span class="p">,</span>
</span><span id="__span-34-26"><a id="__codelineno-34-26" name="__codelineno-34-26"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">InvalidObjectState</span><span class="p">,</span>
</span><span id="__span-34-27"><a id="__codelineno-34-27" name="__codelineno-34-27"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NoSuchBucket</span><span class="p">,</span>
</span><span id="__span-34-28"><a id="__codelineno-34-28" name="__codelineno-34-28"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NoSuchKey</span><span class="p">,</span>
</span><span id="__span-34-29"><a id="__codelineno-34-29" name="__codelineno-34-29"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NoSuchUpload</span><span class="p">,</span>
</span><span id="__span-34-30"><a id="__codelineno-34-30" name="__codelineno-34-30"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ObjectAlreadyInActiveTierError</span><span class="p">,</span>
</span><span id="__span-34-31"><a id="__codelineno-34-31" name="__codelineno-34-31"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ObjectNotInActiveTierError</span><span class="p">,</span>
</span><span id="__span-34-32"><a id="__codelineno-34-32" name="__codelineno-34-32"></a>    <span class="p">)</span>
</span><span id="__span-34-33"><a id="__codelineno-34-33" name="__codelineno-34-33"></a>
</span><span id="__span-34-34"><a id="__codelineno-34-34" name="__codelineno-34-34"></a>
</span><span id="__span-34-35"><a id="__codelineno-34-35" name="__codelineno-34-35"></a><span class="k">def</span> <span class="nf">put_object</span><span class="p">(</span>
</span><span id="__span-34-36"><a id="__codelineno-34-36" name="__codelineno-34-36"></a>    <span class="n">bucket</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">body</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-34-37"><a id="__codelineno-34-37" name="__codelineno-34-37"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">PutObjectOutputTypeDef</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="__span-34-38"><a id="__codelineno-34-38" name="__codelineno-34-38"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-34-39"><a id="__codelineno-34-39" name="__codelineno-34-39"></a>        <span class="n">client</span> <span class="o">=</span> <span class="n">__get_client</span><span class="p">()</span>
</span><span id="__span-34-40"><a id="__codelineno-34-40" name="__codelineno-34-40"></a>        <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">put_object</span><span class="p">(</span>
</span><span id="__span-34-41"><a id="__codelineno-34-41" name="__codelineno-34-41"></a>            <span class="n">Bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">,</span>
</span><span id="__span-34-42"><a id="__codelineno-34-42" name="__codelineno-34-42"></a>            <span class="n">Body</span><span class="o">=</span><span class="n">body</span><span class="p">,</span>
</span><span id="__span-34-43"><a id="__codelineno-34-43" name="__codelineno-34-43"></a>            <span class="n">Key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span>
</span><span id="__span-34-44"><a id="__codelineno-34-44" name="__codelineno-34-44"></a>            <span class="n">ChecksumAlgorithm</span><span class="o">=</span><span class="s2">&quot;SHA256&quot;</span><span class="p">,</span>
</span><span id="__span-34-45"><a id="__codelineno-34-45" name="__codelineno-34-45"></a>            <span class="n">Metadata</span><span class="o">=</span><span class="n">metadata</span> <span class="ow">or</span> <span class="p">{},</span>
</span><span id="__span-34-46"><a id="__codelineno-34-46" name="__codelineno-34-46"></a>        <span class="p">)</span>
</span><span id="__span-34-47"><a id="__codelineno-34-47" name="__codelineno-34-47"></a>
</span><span id="__span-34-48"><a id="__codelineno-34-48" name="__codelineno-34-48"></a>    <span class="k">except</span> <span class="n">__get_exceptions</span><span class="p">()</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-34-49"><a id="__codelineno-34-49" name="__codelineno-34-49"></a>        <span class="k">return</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span>
</span><span id="__span-34-50"><a id="__codelineno-34-50" name="__codelineno-34-50"></a>
</span><span id="__span-34-51"><a id="__codelineno-34-51" name="__codelineno-34-51"></a>
</span><span id="__span-34-52"><a id="__codelineno-34-52" name="__codelineno-34-52"></a><span class="n">OBJECT_URI</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;s3://</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">&quot;</span>
</span><span id="__span-34-53"><a id="__codelineno-34-53" name="__codelineno-34-53"></a><span class="n">PROGRESS_BAR</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> [</span><span class="si">{}{}</span><span class="s2">] </span><span class="si">{}</span><span class="s2"> % (</span><span class="si">{}</span><span class="s2"> / </span><span class="si">{}</span><span class="s2"> bytes)...&quot;</span>
</span><span id="__span-34-54"><a id="__codelineno-34-54" name="__codelineno-34-54"></a>
</span><span id="__span-34-55"><a id="__codelineno-34-55" name="__codelineno-34-55"></a>
</span><span id="__span-34-56"><a id="__codelineno-34-56" name="__codelineno-34-56"></a><span class="k">def</span> <span class="nf">upload_file</span><span class="p">(</span>
</span><span id="__span-34-57"><a id="__codelineno-34-57" name="__codelineno-34-57"></a>    <span class="n">bucket</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">show_progress</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="__span-34-58"><a id="__codelineno-34-58" name="__codelineno-34-58"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">]:</span>
</span><span id="__span-34-59"><a id="__codelineno-34-59" name="__codelineno-34-59"></a>    <span class="k">if</span> <span class="n">show_progress</span><span class="p">:</span>
</span><span id="__span-34-60"><a id="__codelineno-34-60" name="__codelineno-34-60"></a>        <span class="n">uri</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">OBJECT_URI</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</span><span id="__span-34-61"><a id="__codelineno-34-61" name="__codelineno-34-61"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Uploading </span><span class="si">{}</span><span class="s2"> to </span><span class="si">{}</span><span class="s2">...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">uri</span><span class="p">))</span>
</span><span id="__span-34-62"><a id="__codelineno-34-62" name="__codelineno-34-62"></a>
</span><span id="__span-34-63"><a id="__codelineno-34-63" name="__codelineno-34-63"></a>    <span class="n">total</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">show_progress</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="__span-34-64"><a id="__codelineno-34-64" name="__codelineno-34-64"></a>    <span class="n">done</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-34-65"><a id="__codelineno-34-65" name="__codelineno-34-65"></a>
</span><span id="__span-34-66"><a id="__codelineno-34-66" name="__codelineno-34-66"></a>    <span class="k">def</span> <span class="nf">callback</span><span class="p">(</span><span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-34-67"><a id="__codelineno-34-67" name="__codelineno-34-67"></a>        <span class="k">nonlocal</span> <span class="n">total</span>
</span><span id="__span-34-68"><a id="__codelineno-34-68" name="__codelineno-34-68"></a>        <span class="k">nonlocal</span> <span class="n">done</span>
</span><span id="__span-34-69"><a id="__codelineno-34-69" name="__codelineno-34-69"></a>        <span class="k">if</span> <span class="n">total</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-34-70"><a id="__codelineno-34-70" name="__codelineno-34-70"></a>            <span class="k">return</span>
</span><span id="__span-34-71"><a id="__codelineno-34-71" name="__codelineno-34-71"></a>        <span class="n">done</span> <span class="o">+=</span> <span class="n">size</span>
</span><span id="__span-34-72"><a id="__codelineno-34-72" name="__codelineno-34-72"></a>        <span class="n">prog</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">done</span> <span class="o">/</span> <span class="n">total</span>  <span class="c1"># Range: [0, 1]</span>
</span><span id="__span-34-73"><a id="__codelineno-34-73" name="__codelineno-34-73"></a>        <span class="n">prog_bar_len</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">32</span>
</span><span id="__span-34-74"><a id="__codelineno-34-74" name="__codelineno-34-74"></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="__span-34-75"><a id="__codelineno-34-75" name="__codelineno-34-75"></a>            <span class="n">PROGRESS_BAR</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="__span-34-76"><a id="__codelineno-34-76" name="__codelineno-34-76"></a>                <span class="s2">&quot;Uploading&quot;</span><span class="p">,</span>
</span><span id="__span-34-77"><a id="__codelineno-34-77" name="__codelineno-34-77"></a>                <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="nb">round</span><span class="p">(</span><span class="n">prog</span> <span class="o">*</span> <span class="n">prog_bar_len</span><span class="p">),</span>
</span><span id="__span-34-78"><a id="__codelineno-34-78" name="__codelineno-34-78"></a>                <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="nb">round</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">prog</span><span class="p">)</span> <span class="o">*</span> <span class="n">prog_bar_len</span><span class="p">),</span>
</span><span id="__span-34-79"><a id="__codelineno-34-79" name="__codelineno-34-79"></a>                <span class="nb">round</span><span class="p">(</span><span class="n">prog</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span>
</span><span id="__span-34-80"><a id="__codelineno-34-80" name="__codelineno-34-80"></a>                <span class="n">done</span><span class="p">,</span>
</span><span id="__span-34-81"><a id="__codelineno-34-81" name="__codelineno-34-81"></a>                <span class="n">total</span><span class="p">,</span>
</span><span id="__span-34-82"><a id="__codelineno-34-82" name="__codelineno-34-82"></a>            <span class="p">),</span>
</span><span id="__span-34-83"><a id="__codelineno-34-83" name="__codelineno-34-83"></a>            <span class="n">end</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">prog</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot; Complete.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="__span-34-84"><a id="__codelineno-34-84" name="__codelineno-34-84"></a>        <span class="p">)</span>
</span><span id="__span-34-85"><a id="__codelineno-34-85" name="__codelineno-34-85"></a>
</span><span id="__span-34-86"><a id="__codelineno-34-86" name="__codelineno-34-86"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-34-87"><a id="__codelineno-34-87" name="__codelineno-34-87"></a>        <span class="n">client</span> <span class="o">=</span> <span class="n">__get_client</span><span class="p">()</span>
</span><span id="__span-34-88"><a id="__codelineno-34-88" name="__codelineno-34-88"></a>        <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">upload_file</span><span class="p">(</span>
</span><span id="__span-34-89"><a id="__codelineno-34-89" name="__codelineno-34-89"></a>            <span class="n">Bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">,</span>
</span><span id="__span-34-90"><a id="__codelineno-34-90" name="__codelineno-34-90"></a>            <span class="n">Key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span>
</span><span id="__span-34-91"><a id="__codelineno-34-91" name="__codelineno-34-91"></a>            <span class="n">Filename</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span>
</span><span id="__span-34-92"><a id="__codelineno-34-92" name="__codelineno-34-92"></a>            <span class="n">Callback</span><span class="o">=</span><span class="n">callback</span> <span class="k">if</span> <span class="n">show_progress</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-34-93"><a id="__codelineno-34-93" name="__codelineno-34-93"></a>        <span class="p">)</span>
</span><span id="__span-34-94"><a id="__codelineno-34-94" name="__codelineno-34-94"></a>
</span><span id="__span-34-95"><a id="__codelineno-34-95" name="__codelineno-34-95"></a>    <span class="k">except</span> <span class="n">__get_exceptions</span><span class="p">()</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-34-96"><a id="__codelineno-34-96" name="__codelineno-34-96"></a>        <span class="k">return</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-35-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="kn">from</span> <span class="nn">.api</span> <span class="kn">import</span> <span class="n">put_object</span><span class="p">,</span> <span class="n">upload_file</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-36-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-36-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-36-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-36-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-36-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-36-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-36-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-36-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-36-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-36-10">10</a></span>
<span class="normal"><a href="#__codelineno-36-11">11</a></span>
<span class="normal"><a href="#__codelineno-36-12">12</a></span>
<span class="normal"><a href="#__codelineno-36-13">13</a></span>
<span class="normal"><a href="#__codelineno-36-14">14</a></span>
<span class="normal"><a href="#__codelineno-36-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1"></a><span class="kn">from</span> <span class="nn">rich.pretty</span> <span class="kn">import</span> <span class="n">pprint</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2"></a>
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3"></a><span class="kn">import</span> <span class="nn">aws_s3</span>
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4"></a>
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5"></a><span class="n">bucket</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;my-bucket-00000001&quot;</span>
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6"></a><span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;sample.json&quot;</span>
</span><span id="__span-36-7"><a id="__codelineno-36-7" name="__codelineno-36-7"></a><span class="n">key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;uploaded-sample.json&quot;</span>
</span><span id="__span-36-8"><a id="__codelineno-36-8" name="__codelineno-36-8"></a>
</span><span id="__span-36-9"><a id="__codelineno-36-9" name="__codelineno-36-9"></a><span class="c1"># Upload using `put_object`</span>
</span><span id="__span-36-10"><a id="__codelineno-36-10" name="__codelineno-36-10"></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">buffer</span><span class="p">:</span>
</span><span id="__span-36-11"><a id="__codelineno-36-11" name="__codelineno-36-11"></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">aws_s3</span><span class="o">.</span><span class="n">put_object</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">buffer</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">key</span><span class="p">)</span>
</span><span id="__span-36-12"><a id="__codelineno-36-12" name="__codelineno-36-12"></a>    <span class="n">pprint</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">indent_guides</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-36-13"><a id="__codelineno-36-13" name="__codelineno-36-13"></a>
</span><span id="__span-36-14"><a id="__codelineno-36-14" name="__codelineno-36-14"></a><span class="c1"># Upload using `upload_file`</span>
</span><span id="__span-36-15"><a id="__codelineno-36-15" name="__codelineno-36-15"></a><span class="n">aws_s3</span><span class="o">.</span><span class="n">upload_file</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">show_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>Output:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="10:2"><input checked="checked" id="__tabbed_10_1" name="__tabbed_10" type="radio" /><input id="__tabbed_10_2" name="__tabbed_10" type="radio" /><div class="tabbed-labels"><label for="__tabbed_10_1">Using <code>put_object</code></label><label for="__tabbed_10_2">Using <code>upload_file</code></label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-37-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-37-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-37-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-37-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-37-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-37-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-37-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-37-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-37-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-37-10">10</a></span>
<span class="normal"><a href="#__codelineno-37-11">11</a></span>
<span class="normal"><a href="#__codelineno-37-12">12</a></span>
<span class="normal"><a href="#__codelineno-37-13">13</a></span>
<span class="normal"><a href="#__codelineno-37-14">14</a></span>
<span class="normal"><a href="#__codelineno-37-15">15</a></span>
<span class="normal"><a href="#__codelineno-37-16">16</a></span>
<span class="normal"><a href="#__codelineno-37-17">17</a></span>
<span class="normal"><a href="#__codelineno-37-18">18</a></span>
<span class="normal"><a href="#__codelineno-37-19">19</a></span>
<span class="normal"><a href="#__codelineno-37-20">20</a></span>
<span class="normal"><a href="#__codelineno-37-21">21</a></span>
<span class="normal"><a href="#__codelineno-37-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1"></a><span class="p">{</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2"></a>    <span class="s2">&quot;ResponseMetadata&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3"></a>        <span class="s2">&quot;RequestId&quot;</span><span class="p">:</span> <span class="s2">&quot;****************&quot;</span><span class="p">,</span>
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4"></a>        <span class="s2">&quot;HostId&quot;</span><span class="p">:</span> <span class="s2">&quot;****************&quot;</span><span class="p">,</span>
</span><span id="__span-37-5"><a id="__codelineno-37-5" name="__codelineno-37-5"></a>        <span class="s2">&quot;HTTPStatusCode&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
</span><span id="__span-37-6"><a id="__codelineno-37-6" name="__codelineno-37-6"></a>        <span class="s2">&quot;HTTPHeaders&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-37-7"><a id="__codelineno-37-7" name="__codelineno-37-7"></a>            <span class="s2">&quot;x-amz-id-2&quot;</span><span class="p">:</span> <span class="s2">&quot;****************&quot;</span><span class="p">,</span>
</span><span id="__span-37-8"><a id="__codelineno-37-8" name="__codelineno-37-8"></a>            <span class="s2">&quot;x-amz-request-id&quot;</span><span class="p">:</span> <span class="s2">&quot;****************&quot;</span><span class="p">,</span>
</span><span id="__span-37-9"><a id="__codelineno-37-9" name="__codelineno-37-9"></a>            <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;Sun, 29 Oct 2023 13:20:01 GMT&quot;</span><span class="p">,</span>
</span><span id="__span-37-10"><a id="__codelineno-37-10" name="__codelineno-37-10"></a>            <span class="s2">&quot;x-amz-server-side-encryption&quot;</span><span class="p">:</span> <span class="s2">&quot;AES256&quot;</span><span class="p">,</span>
</span><span id="__span-37-11"><a id="__codelineno-37-11" name="__codelineno-37-11"></a>            <span class="s2">&quot;etag&quot;</span><span class="p">:</span> <span class="s1">&#39;&quot;5bd9fe559a5630150c700f98bf10fe79&quot;&#39;</span><span class="p">,</span>
</span><span id="__span-37-12"><a id="__codelineno-37-12" name="__codelineno-37-12"></a>            <span class="s2">&quot;x-amz-checksum-sha256&quot;</span><span class="p">:</span> <span class="s2">&quot;ur0o+fCAhHZLxRSy4hx5hxxLVLpMqEdEEp4VD+qyCc4=&quot;</span><span class="p">,</span>
</span><span id="__span-37-13"><a id="__codelineno-37-13" name="__codelineno-37-13"></a>            <span class="s2">&quot;server&quot;</span><span class="p">:</span> <span class="s2">&quot;AmazonS3&quot;</span><span class="p">,</span>
</span><span id="__span-37-14"><a id="__codelineno-37-14" name="__codelineno-37-14"></a>            <span class="s2">&quot;content-length&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>
</span><span id="__span-37-15"><a id="__codelineno-37-15" name="__codelineno-37-15"></a>            <span class="s2">&quot;connection&quot;</span><span class="p">:</span> <span class="s2">&quot;close&quot;</span><span class="p">,</span>
</span><span id="__span-37-16"><a id="__codelineno-37-16" name="__codelineno-37-16"></a>        <span class="p">},</span>
</span><span id="__span-37-17"><a id="__codelineno-37-17" name="__codelineno-37-17"></a>        <span class="s2">&quot;RetryAttempts&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-37-18"><a id="__codelineno-37-18" name="__codelineno-37-18"></a>    <span class="p">},</span>
</span><span id="__span-37-19"><a id="__codelineno-37-19" name="__codelineno-37-19"></a>    <span class="s2">&quot;ETag&quot;</span><span class="p">:</span> <span class="s1">&#39;&quot;5bd9fe559a5630150c700f98bf10fe79&quot;&#39;</span><span class="p">,</span>
</span><span id="__span-37-20"><a id="__codelineno-37-20" name="__codelineno-37-20"></a>    <span class="s2">&quot;ChecksumSHA256&quot;</span><span class="p">:</span> <span class="s2">&quot;ur0o+fCAhHZLxRSy4hx5hxxLVLpMqEdEEp4VD+qyCc4=&quot;</span><span class="p">,</span>
</span><span id="__span-37-21"><a id="__codelineno-37-21" name="__codelineno-37-21"></a>    <span class="s2">&quot;ServerSideEncryption&quot;</span><span class="p">:</span> <span class="s2">&quot;AES256&quot;</span><span class="p">,</span>
</span><span id="__span-37-22"><a id="__codelineno-37-22" name="__codelineno-37-22"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="language-shell highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>Uploading<span class="w"> </span>sample.json<span class="w"> </span>to<span class="w"> </span>s3://my-bucket-00000001/uploaded-sample.json...
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>Uploading<span class="w"> </span><span class="o">[================================]</span><span class="w"> </span><span class="m">100</span><span class="w"> </span>%<span class="w"> </span><span class="o">(</span><span class="m">28</span><span class="w"> </span>/<span class="w"> </span><span class="m">28</span><span class="w"> </span>bytes<span class="o">)</span>...<span class="w"> </span>Complete.
</span></code></pre></div>
</div>
</div>
</div>
<hr />
<h3 id="downloading-a-fileobject">Downloading a File/Object</h3>
<p>Downloading a file from an Amazon S3 bucket using Boto3 offers various methods to suit different needs. A common approach is using the <code>download_file</code> method of the S3 client, specifying the source bucket and object key, along with the local file path where the object will be saved. Alternatively, you can retrieve the object's contents as bytes using the <code>get_object</code> method and then write it to a local file. For more extensive or streaming downloads, you can leverage the S3 Transfer Manager to handle large objects efficiently (Again, I don't have any implementation sample of this at the moment ). These methods provide flexibility for fetching objects from your S3 bucket, whether it's a simple download or a more complex operation, all while benefiting from Boto3's ease of use and extensive AWS integration. A sample implementation and usage is shown below:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="11:3"><input checked="checked" id="__tabbed_11_1" name="__tabbed_11" type="radio" /><input id="__tabbed_11_2" name="__tabbed_11" type="radio" /><input id="__tabbed_11_3" name="__tabbed_11" type="radio" /><div class="tabbed-labels"><label for="__tabbed_11_1">aws_s3/api.py</label><label for="__tabbed_11_2">aws_s3/__init__.py</label><label for="__tabbed_11_3">app.py</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-39-1">  1</a></span>
<span class="normal"><a href="#__codelineno-39-2">  2</a></span>
<span class="normal"><a href="#__codelineno-39-3">  3</a></span>
<span class="normal"><a href="#__codelineno-39-4">  4</a></span>
<span class="normal"><a href="#__codelineno-39-5">  5</a></span>
<span class="normal"><a href="#__codelineno-39-6">  6</a></span>
<span class="normal"><a href="#__codelineno-39-7">  7</a></span>
<span class="normal"><a href="#__codelineno-39-8">  8</a></span>
<span class="normal"><a href="#__codelineno-39-9">  9</a></span>
<span class="normal"><a href="#__codelineno-39-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-39-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-39-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-39-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-39-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-39-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-39-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-39-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-39-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-39-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-39-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-39-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-39-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-39-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-39-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-39-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-39-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-39-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-39-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-39-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-39-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-39-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-39-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-39-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-39-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-39-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-39-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-39-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-39-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-39-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-39-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-39-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-39-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-39-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-39-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-39-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-39-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-39-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-39-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-39-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-39-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-39-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-39-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-39-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-39-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-39-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-39-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-39-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-39-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-39-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-39-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-39-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-39-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-39-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-39-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-39-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-39-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-39-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-39-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-39-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-39-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-39-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-39-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-39-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-39-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-39-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-39-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-39-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-39-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-39-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-39-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-39-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-39-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-39-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-39-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-39-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-39-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-39-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-39-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-39-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-39-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-39-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-39-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-39-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-39-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-39-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-39-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-39-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-39-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-39-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-39-100">100</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2"></a>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3"></a><span class="kn">import</span> <span class="nn">functools</span>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4"></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Union</span>
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5"></a>
</span><span id="__span-39-6"><a id="__codelineno-39-6" name="__codelineno-39-6"></a><span class="kn">import</span> <span class="nn">boto3</span> <span class="k">as</span> <span class="nn">aws_sdk</span>
</span><span id="__span-39-7"><a id="__codelineno-39-7" name="__codelineno-39-7"></a><span class="kn">from</span> <span class="nn">mypy_boto3_s3</span> <span class="kn">import</span> <span class="n">S3Client</span>
</span><span id="__span-39-8"><a id="__codelineno-39-8" name="__codelineno-39-8"></a><span class="kn">from</span> <span class="nn">mypy_boto3_s3.client</span> <span class="kn">import</span> <span class="n">BotocoreClientError</span>
</span><span id="__span-39-9"><a id="__codelineno-39-9" name="__codelineno-39-9"></a><span class="kn">from</span> <span class="nn">mypy_boto3_s3.type_defs</span> <span class="kn">import</span> <span class="n">GetObjectOutputTypeDef</span><span class="p">,</span> <span class="n">HeadObjectOutputTypeDef</span>
</span><span id="__span-39-10"><a id="__codelineno-39-10" name="__codelineno-39-10"></a>
</span><span id="__span-39-11"><a id="__codelineno-39-11" name="__codelineno-39-11"></a>
</span><span id="__span-39-12"><a id="__codelineno-39-12" name="__codelineno-39-12"></a><span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-39-13"><a id="__codelineno-39-13" name="__codelineno-39-13"></a><span class="k">def</span> <span class="nf">__get_client</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">S3Client</span><span class="p">:</span>
</span><span id="__span-39-14"><a id="__codelineno-39-14" name="__codelineno-39-14"></a>    <span class="n">session</span> <span class="o">=</span> <span class="n">aws_sdk</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
</span><span id="__span-39-15"><a id="__codelineno-39-15" name="__codelineno-39-15"></a>    <span class="k">return</span> <span class="n">session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">&quot;s3&quot;</span><span class="p">)</span>
</span><span id="__span-39-16"><a id="__codelineno-39-16" name="__codelineno-39-16"></a>
</span><span id="__span-39-17"><a id="__codelineno-39-17" name="__codelineno-39-17"></a>
</span><span id="__span-39-18"><a id="__codelineno-39-18" name="__codelineno-39-18"></a><span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-39-19"><a id="__codelineno-39-19" name="__codelineno-39-19"></a><span class="k">def</span> <span class="nf">__get_exceptions</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">BotocoreClientError</span><span class="p">],</span> <span class="o">...</span><span class="p">]:</span>
</span><span id="__span-39-20"><a id="__codelineno-39-20" name="__codelineno-39-20"></a>    <span class="n">client</span> <span class="o">=</span> <span class="n">__get_client</span><span class="p">()</span>
</span><span id="__span-39-21"><a id="__codelineno-39-21" name="__codelineno-39-21"></a>    <span class="k">return</span> <span class="p">(</span>
</span><span id="__span-39-22"><a id="__codelineno-39-22" name="__codelineno-39-22"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">BucketAlreadyExists</span><span class="p">,</span>
</span><span id="__span-39-23"><a id="__codelineno-39-23" name="__codelineno-39-23"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">BucketAlreadyOwnedByYou</span><span class="p">,</span>
</span><span id="__span-39-24"><a id="__codelineno-39-24" name="__codelineno-39-24"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ClientError</span><span class="p">,</span>
</span><span id="__span-39-25"><a id="__codelineno-39-25" name="__codelineno-39-25"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">InvalidObjectState</span><span class="p">,</span>
</span><span id="__span-39-26"><a id="__codelineno-39-26" name="__codelineno-39-26"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NoSuchBucket</span><span class="p">,</span>
</span><span id="__span-39-27"><a id="__codelineno-39-27" name="__codelineno-39-27"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NoSuchKey</span><span class="p">,</span>
</span><span id="__span-39-28"><a id="__codelineno-39-28" name="__codelineno-39-28"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NoSuchUpload</span><span class="p">,</span>
</span><span id="__span-39-29"><a id="__codelineno-39-29" name="__codelineno-39-29"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ObjectAlreadyInActiveTierError</span><span class="p">,</span>
</span><span id="__span-39-30"><a id="__codelineno-39-30" name="__codelineno-39-30"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ObjectNotInActiveTierError</span><span class="p">,</span>
</span><span id="__span-39-31"><a id="__codelineno-39-31" name="__codelineno-39-31"></a>    <span class="p">)</span>
</span><span id="__span-39-32"><a id="__codelineno-39-32" name="__codelineno-39-32"></a>
</span><span id="__span-39-33"><a id="__codelineno-39-33" name="__codelineno-39-33"></a>
</span><span id="__span-39-34"><a id="__codelineno-39-34" name="__codelineno-39-34"></a><span class="k">def</span> <span class="nf">get_object</span><span class="p">(</span><span class="n">bucket</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">GetObjectOutputTypeDef</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="__span-39-35"><a id="__codelineno-39-35" name="__codelineno-39-35"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-39-36"><a id="__codelineno-39-36" name="__codelineno-39-36"></a>        <span class="n">client</span> <span class="o">=</span> <span class="n">__get_client</span><span class="p">()</span>
</span><span id="__span-39-37"><a id="__codelineno-39-37" name="__codelineno-39-37"></a>        <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">,</span> <span class="n">Key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
</span><span id="__span-39-38"><a id="__codelineno-39-38" name="__codelineno-39-38"></a>
</span><span id="__span-39-39"><a id="__codelineno-39-39" name="__codelineno-39-39"></a>    <span class="k">except</span> <span class="n">__get_exceptions</span><span class="p">()</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-39-40"><a id="__codelineno-39-40" name="__codelineno-39-40"></a>        <span class="k">return</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span>
</span><span id="__span-39-41"><a id="__codelineno-39-41" name="__codelineno-39-41"></a>
</span><span id="__span-39-42"><a id="__codelineno-39-42" name="__codelineno-39-42"></a>
</span><span id="__span-39-43"><a id="__codelineno-39-43" name="__codelineno-39-43"></a><span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">16</span><span class="p">)</span>
</span><span id="__span-39-44"><a id="__codelineno-39-44" name="__codelineno-39-44"></a><span class="k">def</span> <span class="nf">get_object_metadata</span><span class="p">(</span>
</span><span id="__span-39-45"><a id="__codelineno-39-45" name="__codelineno-39-45"></a>    <span class="n">bucket</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="__span-39-46"><a id="__codelineno-39-46" name="__codelineno-39-46"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">HeadObjectOutputTypeDef</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="__span-39-47"><a id="__codelineno-39-47" name="__codelineno-39-47"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-39-48"><a id="__codelineno-39-48" name="__codelineno-39-48"></a>        <span class="n">client</span> <span class="o">=</span> <span class="n">__get_client</span><span class="p">()</span>
</span><span id="__span-39-49"><a id="__codelineno-39-49" name="__codelineno-39-49"></a>        <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">head_object</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">,</span> <span class="n">Key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
</span><span id="__span-39-50"><a id="__codelineno-39-50" name="__codelineno-39-50"></a>
</span><span id="__span-39-51"><a id="__codelineno-39-51" name="__codelineno-39-51"></a>    <span class="k">except</span> <span class="n">__get_exceptions</span><span class="p">()</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-39-52"><a id="__codelineno-39-52" name="__codelineno-39-52"></a>        <span class="k">return</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span>
</span><span id="__span-39-53"><a id="__codelineno-39-53" name="__codelineno-39-53"></a>
</span><span id="__span-39-54"><a id="__codelineno-39-54" name="__codelineno-39-54"></a>
</span><span id="__span-39-55"><a id="__codelineno-39-55" name="__codelineno-39-55"></a><span class="n">OBJECT_URI</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;s3://</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">&quot;</span>
</span><span id="__span-39-56"><a id="__codelineno-39-56" name="__codelineno-39-56"></a><span class="n">PROGRESS_BAR</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> [</span><span class="si">{}{}</span><span class="s2">] </span><span class="si">{}</span><span class="s2"> % (</span><span class="si">{}</span><span class="s2"> / </span><span class="si">{}</span><span class="s2"> bytes)...&quot;</span>
</span><span id="__span-39-57"><a id="__codelineno-39-57" name="__codelineno-39-57"></a>
</span><span id="__span-39-58"><a id="__codelineno-39-58" name="__codelineno-39-58"></a>
</span><span id="__span-39-59"><a id="__codelineno-39-59" name="__codelineno-39-59"></a><span class="k">def</span> <span class="nf">download_file</span><span class="p">(</span>
</span><span id="__span-39-60"><a id="__codelineno-39-60" name="__codelineno-39-60"></a>    <span class="n">bucket</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">show_progress</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="__span-39-61"><a id="__codelineno-39-61" name="__codelineno-39-61"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">]:</span>
</span><span id="__span-39-62"><a id="__codelineno-39-62" name="__codelineno-39-62"></a>    <span class="k">if</span> <span class="n">show_progress</span><span class="p">:</span>
</span><span id="__span-39-63"><a id="__codelineno-39-63" name="__codelineno-39-63"></a>        <span class="n">uri</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">OBJECT_URI</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</span><span id="__span-39-64"><a id="__codelineno-39-64" name="__codelineno-39-64"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Downloading </span><span class="si">{}</span><span class="s2"> to </span><span class="si">{}</span><span class="s2">...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span> <span class="n">file_path</span><span class="p">))</span>
</span><span id="__span-39-65"><a id="__codelineno-39-65" name="__codelineno-39-65"></a>
</span><span id="__span-39-66"><a id="__codelineno-39-66" name="__codelineno-39-66"></a>    <span class="n">headers</span> <span class="o">=</span> <span class="n">get_object_metadata</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</span><span id="__span-39-67"><a id="__codelineno-39-67" name="__codelineno-39-67"></a>    <span class="n">total</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">headers</span><span class="p">[</span><span class="s2">&quot;ContentLength&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">show_progress</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="__span-39-68"><a id="__codelineno-39-68" name="__codelineno-39-68"></a>    <span class="n">done</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-39-69"><a id="__codelineno-39-69" name="__codelineno-39-69"></a>
</span><span id="__span-39-70"><a id="__codelineno-39-70" name="__codelineno-39-70"></a>    <span class="k">def</span> <span class="nf">callback</span><span class="p">(</span><span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-39-71"><a id="__codelineno-39-71" name="__codelineno-39-71"></a>        <span class="k">nonlocal</span> <span class="n">total</span>
</span><span id="__span-39-72"><a id="__codelineno-39-72" name="__codelineno-39-72"></a>        <span class="k">nonlocal</span> <span class="n">done</span>
</span><span id="__span-39-73"><a id="__codelineno-39-73" name="__codelineno-39-73"></a>        <span class="k">if</span> <span class="n">total</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-39-74"><a id="__codelineno-39-74" name="__codelineno-39-74"></a>            <span class="k">return</span>
</span><span id="__span-39-75"><a id="__codelineno-39-75" name="__codelineno-39-75"></a>        <span class="n">done</span> <span class="o">+=</span> <span class="n">size</span>
</span><span id="__span-39-76"><a id="__codelineno-39-76" name="__codelineno-39-76"></a>        <span class="n">progress</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">done</span> <span class="o">/</span> <span class="n">total</span>  <span class="c1"># Range: [0, 1]</span>
</span><span id="__span-39-77"><a id="__codelineno-39-77" name="__codelineno-39-77"></a>        <span class="n">progress_bar_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">32</span>
</span><span id="__span-39-78"><a id="__codelineno-39-78" name="__codelineno-39-78"></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="__span-39-79"><a id="__codelineno-39-79" name="__codelineno-39-79"></a>            <span class="n">PROGRESS_BAR</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="__span-39-80"><a id="__codelineno-39-80" name="__codelineno-39-80"></a>                <span class="s2">&quot;Downloading&quot;</span><span class="p">,</span>
</span><span id="__span-39-81"><a id="__codelineno-39-81" name="__codelineno-39-81"></a>                <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="nb">round</span><span class="p">(</span><span class="n">progress</span> <span class="o">*</span> <span class="n">progress_bar_length</span><span class="p">),</span>
</span><span id="__span-39-82"><a id="__codelineno-39-82" name="__codelineno-39-82"></a>                <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="nb">round</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">progress</span><span class="p">)</span> <span class="o">*</span> <span class="n">progress_bar_length</span><span class="p">),</span>
</span><span id="__span-39-83"><a id="__codelineno-39-83" name="__codelineno-39-83"></a>                <span class="nb">round</span><span class="p">(</span><span class="n">progress</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="__span-39-84"><a id="__codelineno-39-84" name="__codelineno-39-84"></a>                <span class="n">done</span><span class="p">,</span>
</span><span id="__span-39-85"><a id="__codelineno-39-85" name="__codelineno-39-85"></a>                <span class="n">total</span><span class="p">,</span>
</span><span id="__span-39-86"><a id="__codelineno-39-86" name="__codelineno-39-86"></a>            <span class="p">),</span>
</span><span id="__span-39-87"><a id="__codelineno-39-87" name="__codelineno-39-87"></a>            <span class="n">end</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">progress</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot; Complete.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="__span-39-88"><a id="__codelineno-39-88" name="__codelineno-39-88"></a>        <span class="p">)</span>
</span><span id="__span-39-89"><a id="__codelineno-39-89" name="__codelineno-39-89"></a>
</span><span id="__span-39-90"><a id="__codelineno-39-90" name="__codelineno-39-90"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-39-91"><a id="__codelineno-39-91" name="__codelineno-39-91"></a>        <span class="n">client</span> <span class="o">=</span> <span class="n">__get_client</span><span class="p">()</span>
</span><span id="__span-39-92"><a id="__codelineno-39-92" name="__codelineno-39-92"></a>        <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">download_file</span><span class="p">(</span>
</span><span id="__span-39-93"><a id="__codelineno-39-93" name="__codelineno-39-93"></a>            <span class="n">Bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">,</span>
</span><span id="__span-39-94"><a id="__codelineno-39-94" name="__codelineno-39-94"></a>            <span class="n">Key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span>
</span><span id="__span-39-95"><a id="__codelineno-39-95" name="__codelineno-39-95"></a>            <span class="n">Filename</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span>
</span><span id="__span-39-96"><a id="__codelineno-39-96" name="__codelineno-39-96"></a>            <span class="n">Callback</span><span class="o">=</span><span class="n">callback</span> <span class="k">if</span> <span class="n">show_progress</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-39-97"><a id="__codelineno-39-97" name="__codelineno-39-97"></a>        <span class="p">)</span>
</span><span id="__span-39-98"><a id="__codelineno-39-98" name="__codelineno-39-98"></a>
</span><span id="__span-39-99"><a id="__codelineno-39-99" name="__codelineno-39-99"></a>    <span class="k">except</span> <span class="n">__get_exceptions</span><span class="p">()</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-39-100"><a id="__codelineno-39-100" name="__codelineno-39-100"></a>        <span class="k">return</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-40-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1"></a><span class="kn">from</span> <span class="nn">.api</span> <span class="kn">import</span> <span class="n">get_object</span><span class="p">,</span> <span class="n">download_file</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-41-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-41-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-41-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-41-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-41-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-41-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-41-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-41-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-41-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-41-10">10</a></span>
<span class="normal"><a href="#__codelineno-41-11">11</a></span>
<span class="normal"><a href="#__codelineno-41-12">12</a></span>
<span class="normal"><a href="#__codelineno-41-13">13</a></span>
<span class="normal"><a href="#__codelineno-41-14">14</a></span>
<span class="normal"><a href="#__codelineno-41-15">15</a></span>
<span class="normal"><a href="#__codelineno-41-16">16</a></span>
<span class="normal"><a href="#__codelineno-41-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1"></a><span class="kn">from</span> <span class="nn">rich.pretty</span> <span class="kn">import</span> <span class="n">pprint</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2"></a>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3"></a><span class="kn">import</span> <span class="nn">aws_s3</span>
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4"></a>
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5"></a><span class="n">bucket</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;my-bucket-00000001&quot;</span>
</span><span id="__span-41-6"><a id="__codelineno-41-6" name="__codelineno-41-6"></a><span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;sample.json&quot;</span>
</span><span id="__span-41-7"><a id="__codelineno-41-7" name="__codelineno-41-7"></a><span class="n">key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;uploaded-sample.json&quot;</span>
</span><span id="__span-41-8"><a id="__codelineno-41-8" name="__codelineno-41-8"></a>
</span><span id="__span-41-9"><a id="__codelineno-41-9" name="__codelineno-41-9"></a><span class="c1"># Download using `get_object`</span>
</span><span id="__span-41-10"><a id="__codelineno-41-10" name="__codelineno-41-10"></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">buffer</span><span class="p">:</span>
</span><span id="__span-41-11"><a id="__codelineno-41-11" name="__codelineno-41-11"></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">aws_s3</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</span><span id="__span-41-12"><a id="__codelineno-41-12" name="__codelineno-41-12"></a>    <span class="n">pprint</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">indent_guides</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-41-13"><a id="__codelineno-41-13" name="__codelineno-41-13"></a>    <span class="n">body</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;Body&quot;</span><span class="p">]</span>
</span><span id="__span-41-14"><a id="__codelineno-41-14" name="__codelineno-41-14"></a>    <span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span><span id="__span-41-15"><a id="__codelineno-41-15" name="__codelineno-41-15"></a>
</span><span id="__span-41-16"><a id="__codelineno-41-16" name="__codelineno-41-16"></a><span class="c1"># Download using `download_file`</span>
</span><span id="__span-41-17"><a id="__codelineno-41-17" name="__codelineno-41-17"></a><span class="n">aws_s3</span><span class="o">.</span><span class="n">download_file</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">show_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>Output:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="12:2"><input checked="checked" id="__tabbed_12_1" name="__tabbed_12" type="radio" /><input id="__tabbed_12_2" name="__tabbed_12" type="radio" /><div class="tabbed-labels"><label for="__tabbed_12_1">Using <code>get_object</code></label><label for="__tabbed_12_2">Using <code>download_file</code></label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-42-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-42-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-42-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-42-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-42-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-42-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-42-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-42-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-42-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-42-10">10</a></span>
<span class="normal"><a href="#__codelineno-42-11">11</a></span>
<span class="normal"><a href="#__codelineno-42-12">12</a></span>
<span class="normal"><a href="#__codelineno-42-13">13</a></span>
<span class="normal"><a href="#__codelineno-42-14">14</a></span>
<span class="normal"><a href="#__codelineno-42-15">15</a></span>
<span class="normal"><a href="#__codelineno-42-16">16</a></span>
<span class="normal"><a href="#__codelineno-42-17">17</a></span>
<span class="normal"><a href="#__codelineno-42-18">18</a></span>
<span class="normal"><a href="#__codelineno-42-19">19</a></span>
<span class="normal"><a href="#__codelineno-42-20">20</a></span>
<span class="normal"><a href="#__codelineno-42-21">21</a></span>
<span class="normal"><a href="#__codelineno-42-22">22</a></span>
<span class="normal"><a href="#__codelineno-42-23">23</a></span>
<span class="normal"><a href="#__codelineno-42-24">24</a></span>
<span class="normal"><a href="#__codelineno-42-25">25</a></span>
<span class="normal"><a href="#__codelineno-42-26">26</a></span>
<span class="normal"><a href="#__codelineno-42-27">27</a></span>
<span class="normal"><a href="#__codelineno-42-28">28</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1"></a><span class="p">{</span>
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2"></a>    <span class="s1">&#39;ResponseMetadata&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3"></a>        <span class="s1">&#39;RequestId&#39;</span><span class="p">:</span> <span class="s1">&#39;****************&#39;</span><span class="p">,</span>
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4"></a>        <span class="s1">&#39;HostId&#39;</span><span class="p">:</span> <span class="s1">&#39;****************&#39;</span><span class="p">,</span>
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5"></a>        <span class="s1">&#39;HTTPStatusCode&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
</span><span id="__span-42-6"><a id="__codelineno-42-6" name="__codelineno-42-6"></a>        <span class="s1">&#39;HTTPHeaders&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-42-7"><a id="__codelineno-42-7" name="__codelineno-42-7"></a>            <span class="s1">&#39;x-amz-id-2&#39;</span><span class="p">:</span> <span class="s1">&#39;****************&#39;</span><span class="p">,</span>
</span><span id="__span-42-8"><a id="__codelineno-42-8" name="__codelineno-42-8"></a>            <span class="s1">&#39;x-amz-request-id&#39;</span><span class="p">:</span> <span class="s1">&#39;****************&#39;</span><span class="p">,</span>
</span><span id="__span-42-9"><a id="__codelineno-42-9" name="__codelineno-42-9"></a>            <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="s1">&#39;Sun, 29 Oct 2023 13:49:34 GMT&#39;</span><span class="p">,</span>
</span><span id="__span-42-10"><a id="__codelineno-42-10" name="__codelineno-42-10"></a>            <span class="s1">&#39;last-modified&#39;</span><span class="p">:</span> <span class="s1">&#39;Sun, 29 Oct 2023 13:47:57 GMT&#39;</span><span class="p">,</span>
</span><span id="__span-42-11"><a id="__codelineno-42-11" name="__codelineno-42-11"></a>            <span class="s1">&#39;etag&#39;</span><span class="p">:</span> <span class="s1">&#39;&quot;5bd9fe559a5630150c700f98bf10fe79&quot;&#39;</span><span class="p">,</span>
</span><span id="__span-42-12"><a id="__codelineno-42-12" name="__codelineno-42-12"></a>            <span class="s1">&#39;x-amz-server-side-encryption&#39;</span><span class="p">:</span> <span class="s1">&#39;AES256&#39;</span><span class="p">,</span>
</span><span id="__span-42-13"><a id="__codelineno-42-13" name="__codelineno-42-13"></a>            <span class="s1">&#39;accept-ranges&#39;</span><span class="p">:</span> <span class="s1">&#39;bytes&#39;</span><span class="p">,</span>
</span><span id="__span-42-14"><a id="__codelineno-42-14" name="__codelineno-42-14"></a>            <span class="s1">&#39;content-type&#39;</span><span class="p">:</span> <span class="s1">&#39;binary/octet-stream&#39;</span><span class="p">,</span>
</span><span id="__span-42-15"><a id="__codelineno-42-15" name="__codelineno-42-15"></a>            <span class="s1">&#39;server&#39;</span><span class="p">:</span> <span class="s1">&#39;AmazonS3&#39;</span><span class="p">,</span>
</span><span id="__span-42-16"><a id="__codelineno-42-16" name="__codelineno-42-16"></a>            <span class="s1">&#39;content-length&#39;</span><span class="p">:</span> <span class="s1">&#39;28&#39;</span>
</span><span id="__span-42-17"><a id="__codelineno-42-17" name="__codelineno-42-17"></a>        <span class="p">},</span>
</span><span id="__span-42-18"><a id="__codelineno-42-18" name="__codelineno-42-18"></a>        <span class="s1">&#39;RetryAttempts&#39;</span><span class="p">:</span> <span class="mi">0</span>
</span><span id="__span-42-19"><a id="__codelineno-42-19" name="__codelineno-42-19"></a>    <span class="p">},</span>
</span><span id="__span-42-20"><a id="__codelineno-42-20" name="__codelineno-42-20"></a>    <span class="s1">&#39;AcceptRanges&#39;</span><span class="p">:</span> <span class="s1">&#39;bytes&#39;</span><span class="p">,</span>
</span><span id="__span-42-21"><a id="__codelineno-42-21" name="__codelineno-42-21"></a>    <span class="s1">&#39;LastModified&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">57</span><span class="p">,</span> <span class="n">tzinfo</span><span class="o">=</span><span class="n">tzutc</span><span class="p">()),</span>
</span><span id="__span-42-22"><a id="__codelineno-42-22" name="__codelineno-42-22"></a>    <span class="s1">&#39;ContentLength&#39;</span><span class="p">:</span> <span class="mi">28</span><span class="p">,</span>
</span><span id="__span-42-23"><a id="__codelineno-42-23" name="__codelineno-42-23"></a>    <span class="s1">&#39;ETag&#39;</span><span class="p">:</span> <span class="s1">&#39;&quot;5bd9fe559a5630150c700f98bf10fe79&quot;&#39;</span><span class="p">,</span>
</span><span id="__span-42-24"><a id="__codelineno-42-24" name="__codelineno-42-24"></a>    <span class="s1">&#39;ContentType&#39;</span><span class="p">:</span> <span class="s1">&#39;binary/octet-stream&#39;</span><span class="p">,</span>
</span><span id="__span-42-25"><a id="__codelineno-42-25" name="__codelineno-42-25"></a>    <span class="s1">&#39;ServerSideEncryption&#39;</span><span class="p">:</span> <span class="s1">&#39;AES256&#39;</span><span class="p">,</span>
</span><span id="__span-42-26"><a id="__codelineno-42-26" name="__codelineno-42-26"></a>    <span class="s1">&#39;Metadata&#39;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="__span-42-27"><a id="__codelineno-42-27" name="__codelineno-42-27"></a>    <span class="s1">&#39;Body&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">botocore</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">StreamingBody</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x7fa9c2028340</span><span class="o">&gt;</span>
</span><span id="__span-42-28"><a id="__codelineno-42-28" name="__codelineno-42-28"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="language-shell highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a>Downloading<span class="w"> </span>s3://my-bucket-00000001/uploaded-sample.json<span class="w"> </span>to<span class="w"> </span>sample.json...
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a>Downloading<span class="w"> </span><span class="o">[================================]</span><span class="w"> </span><span class="m">100</span>.0<span class="w"> </span>%<span class="w"> </span><span class="o">(</span><span class="m">28</span><span class="w"> </span>/<span class="w"> </span><span class="m">28</span><span class="w"> </span>bytes<span class="o">)</span>...<span class="w"> </span>Complete.
</span></code></pre></div>
</div>
</div>
</div>
<hr />
<h3 id="copying-a-fileobject">Copying a File/Object</h3>
<p>To duplicate objects within the same bucket or across different S3 buckets, use the <code>copy_object</code> method provided by the S3 client, specifying the source and destination bucket names and object keys. This operation duplicates the object, preserving its metadata and content, and can be useful for tasks like creating backups, moving objects between buckets, or creating replicas. Boto3 simplifies the object copying process, making it a powerful tool for managing data in your S3 storage efficiently. A sample implementation and usage is shown below:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="13:3"><input checked="checked" id="__tabbed_13_1" name="__tabbed_13" type="radio" /><input id="__tabbed_13_2" name="__tabbed_13" type="radio" /><input id="__tabbed_13_3" name="__tabbed_13" type="radio" /><div class="tabbed-labels"><label for="__tabbed_13_1">aws_s3/api.py</label><label for="__tabbed_13_2">aws_s3/__init__.py</label><label for="__tabbed_13_3">app.py</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-44-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-44-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-44-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-44-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-44-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-44-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-44-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-44-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-44-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-44-10">10</a></span>
<span class="normal"><a href="#__codelineno-44-11">11</a></span>
<span class="normal"><a href="#__codelineno-44-12">12</a></span>
<span class="normal"><a href="#__codelineno-44-13">13</a></span>
<span class="normal"><a href="#__codelineno-44-14">14</a></span>
<span class="normal"><a href="#__codelineno-44-15">15</a></span>
<span class="normal"><a href="#__codelineno-44-16">16</a></span>
<span class="normal"><a href="#__codelineno-44-17">17</a></span>
<span class="normal"><a href="#__codelineno-44-18">18</a></span>
<span class="normal"><a href="#__codelineno-44-19">19</a></span>
<span class="normal"><a href="#__codelineno-44-20">20</a></span>
<span class="normal"><a href="#__codelineno-44-21">21</a></span>
<span class="normal"><a href="#__codelineno-44-22">22</a></span>
<span class="normal"><a href="#__codelineno-44-23">23</a></span>
<span class="normal"><a href="#__codelineno-44-24">24</a></span>
<span class="normal"><a href="#__codelineno-44-25">25</a></span>
<span class="normal"><a href="#__codelineno-44-26">26</a></span>
<span class="normal"><a href="#__codelineno-44-27">27</a></span>
<span class="normal"><a href="#__codelineno-44-28">28</a></span>
<span class="normal"><a href="#__codelineno-44-29">29</a></span>
<span class="normal"><a href="#__codelineno-44-30">30</a></span>
<span class="normal"><a href="#__codelineno-44-31">31</a></span>
<span class="normal"><a href="#__codelineno-44-32">32</a></span>
<span class="normal"><a href="#__codelineno-44-33">33</a></span>
<span class="normal"><a href="#__codelineno-44-34">34</a></span>
<span class="normal"><a href="#__codelineno-44-35">35</a></span>
<span class="normal"><a href="#__codelineno-44-36">36</a></span>
<span class="normal"><a href="#__codelineno-44-37">37</a></span>
<span class="normal"><a href="#__codelineno-44-38">38</a></span>
<span class="normal"><a href="#__codelineno-44-39">39</a></span>
<span class="normal"><a href="#__codelineno-44-40">40</a></span>
<span class="normal"><a href="#__codelineno-44-41">41</a></span>
<span class="normal"><a href="#__codelineno-44-42">42</a></span>
<span class="normal"><a href="#__codelineno-44-43">43</a></span>
<span class="normal"><a href="#__codelineno-44-44">44</a></span>
<span class="normal"><a href="#__codelineno-44-45">45</a></span>
<span class="normal"><a href="#__codelineno-44-46">46</a></span>
<span class="normal"><a href="#__codelineno-44-47">47</a></span>
<span class="normal"><a href="#__codelineno-44-48">48</a></span>
<span class="normal"><a href="#__codelineno-44-49">49</a></span>
<span class="normal"><a href="#__codelineno-44-50">50</a></span>
<span class="normal"><a href="#__codelineno-44-51">51</a></span>
<span class="normal"><a href="#__codelineno-44-52">52</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2"></a>
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3"></a><span class="kn">import</span> <span class="nn">functools</span>
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4"></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Union</span>
</span><span id="__span-44-5"><a id="__codelineno-44-5" name="__codelineno-44-5"></a>
</span><span id="__span-44-6"><a id="__codelineno-44-6" name="__codelineno-44-6"></a><span class="kn">import</span> <span class="nn">boto3</span> <span class="k">as</span> <span class="nn">aws_sdk</span>
</span><span id="__span-44-7"><a id="__codelineno-44-7" name="__codelineno-44-7"></a><span class="kn">from</span> <span class="nn">mypy_boto3_s3</span> <span class="kn">import</span> <span class="n">S3Client</span>
</span><span id="__span-44-8"><a id="__codelineno-44-8" name="__codelineno-44-8"></a><span class="kn">from</span> <span class="nn">mypy_boto3_s3.client</span> <span class="kn">import</span> <span class="n">BotocoreClientError</span>
</span><span id="__span-44-9"><a id="__codelineno-44-9" name="__codelineno-44-9"></a><span class="kn">from</span> <span class="nn">mypy_boto3_s3.type_defs</span> <span class="kn">import</span> <span class="n">CopyObjectOutputTypeDef</span><span class="p">,</span> <span class="n">CopySourceTypeDef</span>
</span><span id="__span-44-10"><a id="__codelineno-44-10" name="__codelineno-44-10"></a>
</span><span id="__span-44-11"><a id="__codelineno-44-11" name="__codelineno-44-11"></a>
</span><span id="__span-44-12"><a id="__codelineno-44-12" name="__codelineno-44-12"></a><span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-44-13"><a id="__codelineno-44-13" name="__codelineno-44-13"></a><span class="k">def</span> <span class="nf">__get_client</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">S3Client</span><span class="p">:</span>
</span><span id="__span-44-14"><a id="__codelineno-44-14" name="__codelineno-44-14"></a>    <span class="n">session</span> <span class="o">=</span> <span class="n">aws_sdk</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
</span><span id="__span-44-15"><a id="__codelineno-44-15" name="__codelineno-44-15"></a>    <span class="k">return</span> <span class="n">session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">&quot;s3&quot;</span><span class="p">)</span>
</span><span id="__span-44-16"><a id="__codelineno-44-16" name="__codelineno-44-16"></a>
</span><span id="__span-44-17"><a id="__codelineno-44-17" name="__codelineno-44-17"></a>
</span><span id="__span-44-18"><a id="__codelineno-44-18" name="__codelineno-44-18"></a><span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-44-19"><a id="__codelineno-44-19" name="__codelineno-44-19"></a><span class="k">def</span> <span class="nf">__get_exceptions</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">BotocoreClientError</span><span class="p">],</span> <span class="o">...</span><span class="p">]:</span>
</span><span id="__span-44-20"><a id="__codelineno-44-20" name="__codelineno-44-20"></a>    <span class="n">client</span> <span class="o">=</span> <span class="n">__get_client</span><span class="p">()</span>
</span><span id="__span-44-21"><a id="__codelineno-44-21" name="__codelineno-44-21"></a>    <span class="k">return</span> <span class="p">(</span>
</span><span id="__span-44-22"><a id="__codelineno-44-22" name="__codelineno-44-22"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">BucketAlreadyExists</span><span class="p">,</span>
</span><span id="__span-44-23"><a id="__codelineno-44-23" name="__codelineno-44-23"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">BucketAlreadyOwnedByYou</span><span class="p">,</span>
</span><span id="__span-44-24"><a id="__codelineno-44-24" name="__codelineno-44-24"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ClientError</span><span class="p">,</span>
</span><span id="__span-44-25"><a id="__codelineno-44-25" name="__codelineno-44-25"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">InvalidObjectState</span><span class="p">,</span>
</span><span id="__span-44-26"><a id="__codelineno-44-26" name="__codelineno-44-26"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NoSuchBucket</span><span class="p">,</span>
</span><span id="__span-44-27"><a id="__codelineno-44-27" name="__codelineno-44-27"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NoSuchKey</span><span class="p">,</span>
</span><span id="__span-44-28"><a id="__codelineno-44-28" name="__codelineno-44-28"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NoSuchUpload</span><span class="p">,</span>
</span><span id="__span-44-29"><a id="__codelineno-44-29" name="__codelineno-44-29"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ObjectAlreadyInActiveTierError</span><span class="p">,</span>
</span><span id="__span-44-30"><a id="__codelineno-44-30" name="__codelineno-44-30"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ObjectNotInActiveTierError</span><span class="p">,</span>
</span><span id="__span-44-31"><a id="__codelineno-44-31" name="__codelineno-44-31"></a>    <span class="p">)</span>
</span><span id="__span-44-32"><a id="__codelineno-44-32" name="__codelineno-44-32"></a>
</span><span id="__span-44-33"><a id="__codelineno-44-33" name="__codelineno-44-33"></a>
</span><span id="__span-44-34"><a id="__codelineno-44-34" name="__codelineno-44-34"></a><span class="k">def</span> <span class="nf">copy_object</span><span class="p">(</span>
</span><span id="__span-44-35"><a id="__codelineno-44-35" name="__codelineno-44-35"></a>    <span class="n">source_bucket</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-44-36"><a id="__codelineno-44-36" name="__codelineno-44-36"></a>    <span class="n">source_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-44-37"><a id="__codelineno-44-37" name="__codelineno-44-37"></a>    <span class="n">target_bucket</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-44-38"><a id="__codelineno-44-38" name="__codelineno-44-38"></a>    <span class="n">target_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-44-39"><a id="__codelineno-44-39" name="__codelineno-44-39"></a>    <span class="o">*</span><span class="p">,</span>
</span><span id="__span-44-40"><a id="__codelineno-44-40" name="__codelineno-44-40"></a>    <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-44-41"><a id="__codelineno-44-41" name="__codelineno-44-41"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">CopyObjectOutputTypeDef</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="__span-44-42"><a id="__codelineno-44-42" name="__codelineno-44-42"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-44-43"><a id="__codelineno-44-43" name="__codelineno-44-43"></a>        <span class="n">client</span> <span class="o">=</span> <span class="n">__get_client</span><span class="p">()</span>
</span><span id="__span-44-44"><a id="__codelineno-44-44" name="__codelineno-44-44"></a>        <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">copy_object</span><span class="p">(</span>
</span><span id="__span-44-45"><a id="__codelineno-44-45" name="__codelineno-44-45"></a>            <span class="n">Bucket</span><span class="o">=</span><span class="n">target_bucket</span><span class="p">,</span>
</span><span id="__span-44-46"><a id="__codelineno-44-46" name="__codelineno-44-46"></a>            <span class="n">Key</span><span class="o">=</span><span class="n">target_key</span><span class="p">,</span>
</span><span id="__span-44-47"><a id="__codelineno-44-47" name="__codelineno-44-47"></a>            <span class="n">CopySource</span><span class="o">=</span><span class="n">CopySourceTypeDef</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">source_bucket</span><span class="p">,</span> <span class="n">Key</span><span class="o">=</span><span class="n">source_key</span><span class="p">),</span>
</span><span id="__span-44-48"><a id="__codelineno-44-48" name="__codelineno-44-48"></a>            <span class="n">Metadata</span><span class="o">=</span><span class="n">metadata</span> <span class="ow">or</span> <span class="p">{},</span>
</span><span id="__span-44-49"><a id="__codelineno-44-49" name="__codelineno-44-49"></a>        <span class="p">)</span>
</span><span id="__span-44-50"><a id="__codelineno-44-50" name="__codelineno-44-50"></a>
</span><span id="__span-44-51"><a id="__codelineno-44-51" name="__codelineno-44-51"></a>    <span class="k">except</span> <span class="n">__get_exceptions</span><span class="p">()</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-44-52"><a id="__codelineno-44-52" name="__codelineno-44-52"></a>        <span class="k">return</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-45-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1"></a><span class="kn">from</span> <span class="nn">.api</span> <span class="kn">import</span> <span class="n">copy_object</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-46-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-46-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-46-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-46-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-46-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-46-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-46-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-46-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-46-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-46-10">10</a></span>
<span class="normal"><a href="#__codelineno-46-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1"></a><span class="kn">from</span> <span class="nn">rich.pretty</span> <span class="kn">import</span> <span class="n">pprint</span>
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2"></a>
</span><span id="__span-46-3"><a id="__codelineno-46-3" name="__codelineno-46-3"></a><span class="kn">import</span> <span class="nn">aws_s3</span>
</span><span id="__span-46-4"><a id="__codelineno-46-4" name="__codelineno-46-4"></a>
</span><span id="__span-46-5"><a id="__codelineno-46-5" name="__codelineno-46-5"></a><span class="n">source_bucket</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;my-bucket-00000001&quot;</span>
</span><span id="__span-46-6"><a id="__codelineno-46-6" name="__codelineno-46-6"></a><span class="n">source_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;upload-sample.json&quot;</span>
</span><span id="__span-46-7"><a id="__codelineno-46-7" name="__codelineno-46-7"></a><span class="n">target_bucket</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;my-bucket-00000001&quot;</span>
</span><span id="__span-46-8"><a id="__codelineno-46-8" name="__codelineno-46-8"></a><span class="n">target_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;upload-sample-copy.json&quot;</span>
</span><span id="__span-46-9"><a id="__codelineno-46-9" name="__codelineno-46-9"></a>
</span><span id="__span-46-10"><a id="__codelineno-46-10" name="__codelineno-46-10"></a><span class="n">result</span> <span class="o">=</span> <span class="n">aws_s3</span><span class="o">.</span><span class="n">copy_object</span><span class="p">(</span><span class="n">source_bucket</span><span class="p">,</span> <span class="n">source_key</span><span class="p">,</span> <span class="n">target_bucket</span><span class="p">,</span> <span class="n">target_key</span><span class="p">)</span>
</span><span id="__span-46-11"><a id="__codelineno-46-11" name="__codelineno-46-11"></a><span class="n">pprint</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">indent_guides</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>Output:</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-47-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-47-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-47-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-47-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-47-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-47-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-47-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-47-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-47-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-47-10">10</a></span>
<span class="normal"><a href="#__codelineno-47-11">11</a></span>
<span class="normal"><a href="#__codelineno-47-12">12</a></span>
<span class="normal"><a href="#__codelineno-47-13">13</a></span>
<span class="normal"><a href="#__codelineno-47-14">14</a></span>
<span class="normal"><a href="#__codelineno-47-15">15</a></span>
<span class="normal"><a href="#__codelineno-47-16">16</a></span>
<span class="normal"><a href="#__codelineno-47-17">17</a></span>
<span class="normal"><a href="#__codelineno-47-18">18</a></span>
<span class="normal"><a href="#__codelineno-47-19">19</a></span>
<span class="normal"><a href="#__codelineno-47-20">20</a></span>
<span class="normal"><a href="#__codelineno-47-21">21</a></span>
<span class="normal"><a href="#__codelineno-47-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1"></a><span class="p">{</span>
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2"></a>    <span class="s2">&quot;ResponseMetadata&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3"></a>        <span class="s2">&quot;RequestId&quot;</span><span class="p">:</span> <span class="s2">&quot;****************&quot;</span><span class="p">,</span>
</span><span id="__span-47-4"><a id="__codelineno-47-4" name="__codelineno-47-4"></a>        <span class="s2">&quot;HostId&quot;</span><span class="p">:</span> <span class="s2">&quot;****************&quot;</span><span class="p">,</span>
</span><span id="__span-47-5"><a id="__codelineno-47-5" name="__codelineno-47-5"></a>        <span class="s2">&quot;HTTPStatusCode&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
</span><span id="__span-47-6"><a id="__codelineno-47-6" name="__codelineno-47-6"></a>        <span class="s2">&quot;HTTPHeaders&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-47-7"><a id="__codelineno-47-7" name="__codelineno-47-7"></a>            <span class="s2">&quot;x-amz-id-2&quot;</span><span class="p">:</span> <span class="s2">&quot;****************&quot;</span><span class="p">,</span>
</span><span id="__span-47-8"><a id="__codelineno-47-8" name="__codelineno-47-8"></a>            <span class="s2">&quot;x-amz-request-id&quot;</span><span class="p">:</span> <span class="s2">&quot;****************&quot;</span><span class="p">,</span>
</span><span id="__span-47-9"><a id="__codelineno-47-9" name="__codelineno-47-9"></a>            <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;Sun, 29 Oct 2023 15:16:48 GMT&quot;</span><span class="p">,</span>
</span><span id="__span-47-10"><a id="__codelineno-47-10" name="__codelineno-47-10"></a>            <span class="s2">&quot;x-amz-server-side-encryption&quot;</span><span class="p">:</span> <span class="s2">&quot;AES256&quot;</span><span class="p">,</span>
</span><span id="__span-47-11"><a id="__codelineno-47-11" name="__codelineno-47-11"></a>            <span class="s2">&quot;content-type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/xml&quot;</span><span class="p">,</span>
</span><span id="__span-47-12"><a id="__codelineno-47-12" name="__codelineno-47-12"></a>            <span class="s2">&quot;server&quot;</span><span class="p">:</span> <span class="s2">&quot;AmazonS3&quot;</span><span class="p">,</span>
</span><span id="__span-47-13"><a id="__codelineno-47-13" name="__codelineno-47-13"></a>            <span class="s2">&quot;content-length&quot;</span><span class="p">:</span> <span class="s2">&quot;224&quot;</span><span class="p">,</span>
</span><span id="__span-47-14"><a id="__codelineno-47-14" name="__codelineno-47-14"></a>        <span class="p">},</span>
</span><span id="__span-47-15"><a id="__codelineno-47-15" name="__codelineno-47-15"></a>        <span class="s2">&quot;RetryAttempts&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-47-16"><a id="__codelineno-47-16" name="__codelineno-47-16"></a>    <span class="p">},</span>
</span><span id="__span-47-17"><a id="__codelineno-47-17" name="__codelineno-47-17"></a>    <span class="s2">&quot;ServerSideEncryption&quot;</span><span class="p">:</span> <span class="s2">&quot;AES256&quot;</span><span class="p">,</span>
</span><span id="__span-47-18"><a id="__codelineno-47-18" name="__codelineno-47-18"></a>    <span class="s2">&quot;CopyObjectResult&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-47-19"><a id="__codelineno-47-19" name="__codelineno-47-19"></a>        <span class="s2">&quot;ETag&quot;</span><span class="p">:</span> <span class="s1">&#39;&quot;5bd9fe559a5630150c700f98bf10fe79&quot;&#39;</span><span class="p">,</span>
</span><span id="__span-47-20"><a id="__codelineno-47-20" name="__codelineno-47-20"></a>        <span class="s2">&quot;LastModified&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="n">tzinfo</span><span class="o">=</span><span class="n">tzutc</span><span class="p">()),</span>
</span><span id="__span-47-21"><a id="__codelineno-47-21" name="__codelineno-47-21"></a>    <span class="p">},</span>
</span><span id="__span-47-22"><a id="__codelineno-47-22" name="__codelineno-47-22"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<hr />
<h3 id="deleting-filesobjects">Deleting Files/Objects</h3>
<p>To delete a single object, you can use the <code>delete_object</code> method provided by the S3 client, specifying the bucket name and the object key. This deletes the specified object from the S3 bucket. For deleting multiple objects, you can use the <code>delete_objects</code> method, passing a list of object keys to be removed in a single request. Handling deletions with Boto3 simplifies the task of managing your S3 data, whether you need to remove individual objects or perform bulk deletions, ensuring that your storage resources remain organized and uncluttered. A sample implementation and usage is shown below:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="14:3"><input checked="checked" id="__tabbed_14_1" name="__tabbed_14" type="radio" /><input id="__tabbed_14_2" name="__tabbed_14" type="radio" /><input id="__tabbed_14_3" name="__tabbed_14" type="radio" /><div class="tabbed-labels"><label for="__tabbed_14_1">aws_s3/api.py</label><label for="__tabbed_14_2">aws_s3/__init__.py</label><label for="__tabbed_14_3">app.py</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-48-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-48-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-48-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-48-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-48-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-48-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-48-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-48-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-48-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-48-10">10</a></span>
<span class="normal"><a href="#__codelineno-48-11">11</a></span>
<span class="normal"><a href="#__codelineno-48-12">12</a></span>
<span class="normal"><a href="#__codelineno-48-13">13</a></span>
<span class="normal"><a href="#__codelineno-48-14">14</a></span>
<span class="normal"><a href="#__codelineno-48-15">15</a></span>
<span class="normal"><a href="#__codelineno-48-16">16</a></span>
<span class="normal"><a href="#__codelineno-48-17">17</a></span>
<span class="normal"><a href="#__codelineno-48-18">18</a></span>
<span class="normal"><a href="#__codelineno-48-19">19</a></span>
<span class="normal"><a href="#__codelineno-48-20">20</a></span>
<span class="normal"><a href="#__codelineno-48-21">21</a></span>
<span class="normal"><a href="#__codelineno-48-22">22</a></span>
<span class="normal"><a href="#__codelineno-48-23">23</a></span>
<span class="normal"><a href="#__codelineno-48-24">24</a></span>
<span class="normal"><a href="#__codelineno-48-25">25</a></span>
<span class="normal"><a href="#__codelineno-48-26">26</a></span>
<span class="normal"><a href="#__codelineno-48-27">27</a></span>
<span class="normal"><a href="#__codelineno-48-28">28</a></span>
<span class="normal"><a href="#__codelineno-48-29">29</a></span>
<span class="normal"><a href="#__codelineno-48-30">30</a></span>
<span class="normal"><a href="#__codelineno-48-31">31</a></span>
<span class="normal"><a href="#__codelineno-48-32">32</a></span>
<span class="normal"><a href="#__codelineno-48-33">33</a></span>
<span class="normal"><a href="#__codelineno-48-34">34</a></span>
<span class="normal"><a href="#__codelineno-48-35">35</a></span>
<span class="normal"><a href="#__codelineno-48-36">36</a></span>
<span class="normal"><a href="#__codelineno-48-37">37</a></span>
<span class="normal"><a href="#__codelineno-48-38">38</a></span>
<span class="normal"><a href="#__codelineno-48-39">39</a></span>
<span class="normal"><a href="#__codelineno-48-40">40</a></span>
<span class="normal"><a href="#__codelineno-48-41">41</a></span>
<span class="normal"><a href="#__codelineno-48-42">42</a></span>
<span class="normal"><a href="#__codelineno-48-43">43</a></span>
<span class="normal"><a href="#__codelineno-48-44">44</a></span>
<span class="normal"><a href="#__codelineno-48-45">45</a></span>
<span class="normal"><a href="#__codelineno-48-46">46</a></span>
<span class="normal"><a href="#__codelineno-48-47">47</a></span>
<span class="normal"><a href="#__codelineno-48-48">48</a></span>
<span class="normal"><a href="#__codelineno-48-49">49</a></span>
<span class="normal"><a href="#__codelineno-48-50">50</a></span>
<span class="normal"><a href="#__codelineno-48-51">51</a></span>
<span class="normal"><a href="#__codelineno-48-52">52</a></span>
<span class="normal"><a href="#__codelineno-48-53">53</a></span>
<span class="normal"><a href="#__codelineno-48-54">54</a></span>
<span class="normal"><a href="#__codelineno-48-55">55</a></span>
<span class="normal"><a href="#__codelineno-48-56">56</a></span>
<span class="normal"><a href="#__codelineno-48-57">57</a></span>
<span class="normal"><a href="#__codelineno-48-58">58</a></span>
<span class="normal"><a href="#__codelineno-48-59">59</a></span>
<span class="normal"><a href="#__codelineno-48-60">60</a></span>
<span class="normal"><a href="#__codelineno-48-61">61</a></span>
<span class="normal"><a href="#__codelineno-48-62">62</a></span>
<span class="normal"><a href="#__codelineno-48-63">63</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2"></a>
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3"></a><span class="kn">import</span> <span class="nn">functools</span>
</span><span id="__span-48-4"><a id="__codelineno-48-4" name="__codelineno-48-4"></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Union</span>
</span><span id="__span-48-5"><a id="__codelineno-48-5" name="__codelineno-48-5"></a>
</span><span id="__span-48-6"><a id="__codelineno-48-6" name="__codelineno-48-6"></a><span class="kn">import</span> <span class="nn">boto3</span> <span class="k">as</span> <span class="nn">aws_sdk</span>
</span><span id="__span-48-7"><a id="__codelineno-48-7" name="__codelineno-48-7"></a><span class="kn">from</span> <span class="nn">mypy_boto3_s3</span> <span class="kn">import</span> <span class="n">S3Client</span>
</span><span id="__span-48-8"><a id="__codelineno-48-8" name="__codelineno-48-8"></a><span class="kn">from</span> <span class="nn">mypy_boto3_s3.client</span> <span class="kn">import</span> <span class="n">BotocoreClientError</span>
</span><span id="__span-48-9"><a id="__codelineno-48-9" name="__codelineno-48-9"></a><span class="kn">from</span> <span class="nn">mypy_boto3_s3.type_defs</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="__span-48-10"><a id="__codelineno-48-10" name="__codelineno-48-10"></a>    <span class="n">DeleteObjectOutputTypeDef</span><span class="p">,</span>
</span><span id="__span-48-11"><a id="__codelineno-48-11" name="__codelineno-48-11"></a>    <span class="n">DeleteObjectsOutputTypeDef</span><span class="p">,</span>
</span><span id="__span-48-12"><a id="__codelineno-48-12" name="__codelineno-48-12"></a>    <span class="n">DeleteTypeDef</span><span class="p">,</span>
</span><span id="__span-48-13"><a id="__codelineno-48-13" name="__codelineno-48-13"></a>    <span class="n">ObjectIdentifierTypeDef</span><span class="p">,</span>
</span><span id="__span-48-14"><a id="__codelineno-48-14" name="__codelineno-48-14"></a><span class="p">)</span>
</span><span id="__span-48-15"><a id="__codelineno-48-15" name="__codelineno-48-15"></a>
</span><span id="__span-48-16"><a id="__codelineno-48-16" name="__codelineno-48-16"></a>
</span><span id="__span-48-17"><a id="__codelineno-48-17" name="__codelineno-48-17"></a><span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-48-18"><a id="__codelineno-48-18" name="__codelineno-48-18"></a><span class="k">def</span> <span class="nf">__get_client</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">S3Client</span><span class="p">:</span>
</span><span id="__span-48-19"><a id="__codelineno-48-19" name="__codelineno-48-19"></a>    <span class="n">session</span> <span class="o">=</span> <span class="n">aws_sdk</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
</span><span id="__span-48-20"><a id="__codelineno-48-20" name="__codelineno-48-20"></a>    <span class="k">return</span> <span class="n">session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">&quot;s3&quot;</span><span class="p">)</span>
</span><span id="__span-48-21"><a id="__codelineno-48-21" name="__codelineno-48-21"></a>
</span><span id="__span-48-22"><a id="__codelineno-48-22" name="__codelineno-48-22"></a>
</span><span id="__span-48-23"><a id="__codelineno-48-23" name="__codelineno-48-23"></a><span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-48-24"><a id="__codelineno-48-24" name="__codelineno-48-24"></a><span class="k">def</span> <span class="nf">__get_exceptions</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">BotocoreClientError</span><span class="p">],</span> <span class="o">...</span><span class="p">]:</span>
</span><span id="__span-48-25"><a id="__codelineno-48-25" name="__codelineno-48-25"></a>    <span class="n">client</span> <span class="o">=</span> <span class="n">__get_client</span><span class="p">()</span>
</span><span id="__span-48-26"><a id="__codelineno-48-26" name="__codelineno-48-26"></a>    <span class="k">return</span> <span class="p">(</span>
</span><span id="__span-48-27"><a id="__codelineno-48-27" name="__codelineno-48-27"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">BucketAlreadyExists</span><span class="p">,</span>
</span><span id="__span-48-28"><a id="__codelineno-48-28" name="__codelineno-48-28"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">BucketAlreadyOwnedByYou</span><span class="p">,</span>
</span><span id="__span-48-29"><a id="__codelineno-48-29" name="__codelineno-48-29"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ClientError</span><span class="p">,</span>
</span><span id="__span-48-30"><a id="__codelineno-48-30" name="__codelineno-48-30"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">InvalidObjectState</span><span class="p">,</span>
</span><span id="__span-48-31"><a id="__codelineno-48-31" name="__codelineno-48-31"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NoSuchBucket</span><span class="p">,</span>
</span><span id="__span-48-32"><a id="__codelineno-48-32" name="__codelineno-48-32"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NoSuchKey</span><span class="p">,</span>
</span><span id="__span-48-33"><a id="__codelineno-48-33" name="__codelineno-48-33"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NoSuchUpload</span><span class="p">,</span>
</span><span id="__span-48-34"><a id="__codelineno-48-34" name="__codelineno-48-34"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ObjectAlreadyInActiveTierError</span><span class="p">,</span>
</span><span id="__span-48-35"><a id="__codelineno-48-35" name="__codelineno-48-35"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ObjectNotInActiveTierError</span><span class="p">,</span>
</span><span id="__span-48-36"><a id="__codelineno-48-36" name="__codelineno-48-36"></a>    <span class="p">)</span>
</span><span id="__span-48-37"><a id="__codelineno-48-37" name="__codelineno-48-37"></a>
</span><span id="__span-48-38"><a id="__codelineno-48-38" name="__codelineno-48-38"></a>
</span><span id="__span-48-39"><a id="__codelineno-48-39" name="__codelineno-48-39"></a><span class="k">def</span> <span class="nf">delete_object</span><span class="p">(</span>
</span><span id="__span-48-40"><a id="__codelineno-48-40" name="__codelineno-48-40"></a>    <span class="n">bucket</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="__span-48-41"><a id="__codelineno-48-41" name="__codelineno-48-41"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">DeleteObjectOutputTypeDef</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="__span-48-42"><a id="__codelineno-48-42" name="__codelineno-48-42"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-48-43"><a id="__codelineno-48-43" name="__codelineno-48-43"></a>        <span class="n">client</span> <span class="o">=</span> <span class="n">__get_client</span><span class="p">()</span>
</span><span id="__span-48-44"><a id="__codelineno-48-44" name="__codelineno-48-44"></a>        <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">delete_object</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">,</span> <span class="n">Key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
</span><span id="__span-48-45"><a id="__codelineno-48-45" name="__codelineno-48-45"></a>
</span><span id="__span-48-46"><a id="__codelineno-48-46" name="__codelineno-48-46"></a>    <span class="k">except</span> <span class="n">__get_exceptions</span><span class="p">()</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-48-47"><a id="__codelineno-48-47" name="__codelineno-48-47"></a>        <span class="k">return</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span>
</span><span id="__span-48-48"><a id="__codelineno-48-48" name="__codelineno-48-48"></a>
</span><span id="__span-48-49"><a id="__codelineno-48-49" name="__codelineno-48-49"></a>
</span><span id="__span-48-50"><a id="__codelineno-48-50" name="__codelineno-48-50"></a><span class="k">def</span> <span class="nf">delete_objects</span><span class="p">(</span>
</span><span id="__span-48-51"><a id="__codelineno-48-51" name="__codelineno-48-51"></a>    <span class="n">bucket</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">keys</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span><span id="__span-48-52"><a id="__codelineno-48-52" name="__codelineno-48-52"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">DeleteObjectsOutputTypeDef</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="__span-48-53"><a id="__codelineno-48-53" name="__codelineno-48-53"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-48-54"><a id="__codelineno-48-54" name="__codelineno-48-54"></a>        <span class="n">client</span> <span class="o">=</span> <span class="n">__get_client</span><span class="p">()</span>
</span><span id="__span-48-55"><a id="__codelineno-48-55" name="__codelineno-48-55"></a>        <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">delete_objects</span><span class="p">(</span>
</span><span id="__span-48-56"><a id="__codelineno-48-56" name="__codelineno-48-56"></a>            <span class="n">Bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">,</span>
</span><span id="__span-48-57"><a id="__codelineno-48-57" name="__codelineno-48-57"></a>            <span class="n">Delete</span><span class="o">=</span><span class="n">DeleteTypeDef</span><span class="p">(</span>
</span><span id="__span-48-58"><a id="__codelineno-48-58" name="__codelineno-48-58"></a>                <span class="n">Objects</span><span class="o">=</span><span class="p">[</span><span class="n">ObjectIdentifierTypeDef</span><span class="p">(</span><span class="n">Key</span><span class="o">=</span><span class="n">each_key</span><span class="p">)</span> <span class="k">for</span> <span class="n">each_key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">]</span>
</span><span id="__span-48-59"><a id="__codelineno-48-59" name="__codelineno-48-59"></a>            <span class="p">),</span>
</span><span id="__span-48-60"><a id="__codelineno-48-60" name="__codelineno-48-60"></a>        <span class="p">)</span>
</span><span id="__span-48-61"><a id="__codelineno-48-61" name="__codelineno-48-61"></a>
</span><span id="__span-48-62"><a id="__codelineno-48-62" name="__codelineno-48-62"></a>    <span class="k">except</span> <span class="n">__get_exceptions</span><span class="p">()</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-48-63"><a id="__codelineno-48-63" name="__codelineno-48-63"></a>        <span class="k">return</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-49-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1"></a><span class="kn">from</span> <span class="nn">.api</span> <span class="kn">import</span> <span class="n">delete_object</span><span class="p">,</span> <span class="n">delete_objects</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-50-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-50-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-50-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-50-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-50-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-50-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-50-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-50-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-50-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-50-10">10</a></span>
<span class="normal"><a href="#__codelineno-50-11">11</a></span>
<span class="normal"><a href="#__codelineno-50-12">12</a></span>
<span class="normal"><a href="#__codelineno-50-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1"></a><span class="kn">from</span> <span class="nn">rich.pretty</span> <span class="kn">import</span> <span class="n">pprint</span>
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2"></a>
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3"></a><span class="kn">import</span> <span class="nn">aws_s3</span>
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4"></a>
</span><span id="__span-50-5"><a id="__codelineno-50-5" name="__codelineno-50-5"></a><span class="n">bucket</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;my-bucket-00000001&quot;</span>
</span><span id="__span-50-6"><a id="__codelineno-50-6" name="__codelineno-50-6"></a><span class="n">key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;upload-sample.json&quot;</span>
</span><span id="__span-50-7"><a id="__codelineno-50-7" name="__codelineno-50-7"></a><span class="n">key_copy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;upload-sample-copy.json&quot;</span>
</span><span id="__span-50-8"><a id="__codelineno-50-8" name="__codelineno-50-8"></a>
</span><span id="__span-50-9"><a id="__codelineno-50-9" name="__codelineno-50-9"></a><span class="n">result</span> <span class="o">=</span> <span class="n">aws_s3</span><span class="o">.</span><span class="n">delete_object</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</span><span id="__span-50-10"><a id="__codelineno-50-10" name="__codelineno-50-10"></a><span class="n">pprint</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">indent_guides</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-50-11"><a id="__codelineno-50-11" name="__codelineno-50-11"></a>
</span><span id="__span-50-12"><a id="__codelineno-50-12" name="__codelineno-50-12"></a><span class="n">result</span> <span class="o">=</span> <span class="n">aws_s3</span><span class="o">.</span><span class="n">delete_objects</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="p">[</span><span class="n">key</span><span class="p">,</span> <span class="n">key_copy</span><span class="p">])</span>
</span><span id="__span-50-13"><a id="__codelineno-50-13" name="__codelineno-50-13"></a><span class="n">pprint</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">indent_guides</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>Output:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="15:2"><input checked="checked" id="__tabbed_15_1" name="__tabbed_15" type="radio" /><input id="__tabbed_15_2" name="__tabbed_15" type="radio" /><div class="tabbed-labels"><label for="__tabbed_15_1">Using <code>delete_object</code></label><label for="__tabbed_15_2">Using <code>delete_objects</code></label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-51-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-51-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-51-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-51-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-51-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-51-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-51-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-51-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-51-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-51-10">10</a></span>
<span class="normal"><a href="#__codelineno-51-11">11</a></span>
<span class="normal"><a href="#__codelineno-51-12">12</a></span>
<span class="normal"><a href="#__codelineno-51-13">13</a></span>
<span class="normal"><a href="#__codelineno-51-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1"></a><span class="p">{</span>
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2"></a>    <span class="s2">&quot;ResponseMetadata&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3"></a>        <span class="s2">&quot;RequestId&quot;</span><span class="p">:</span> <span class="s2">&quot;****************&quot;</span><span class="p">,</span>
</span><span id="__span-51-4"><a id="__codelineno-51-4" name="__codelineno-51-4"></a>        <span class="s2">&quot;HostId&quot;</span><span class="p">:</span> <span class="s2">&quot;****************&quot;</span><span class="p">,</span>
</span><span id="__span-51-5"><a id="__codelineno-51-5" name="__codelineno-51-5"></a>        <span class="s2">&quot;HTTPStatusCode&quot;</span><span class="p">:</span> <span class="mi">204</span><span class="p">,</span>
</span><span id="__span-51-6"><a id="__codelineno-51-6" name="__codelineno-51-6"></a>        <span class="s2">&quot;HTTPHeaders&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-51-7"><a id="__codelineno-51-7" name="__codelineno-51-7"></a>            <span class="s2">&quot;x-amz-id-2&quot;</span><span class="p">:</span> <span class="s2">&quot;****************&quot;</span><span class="p">,</span>
</span><span id="__span-51-8"><a id="__codelineno-51-8" name="__codelineno-51-8"></a>            <span class="s2">&quot;x-amz-request-id&quot;</span><span class="p">:</span> <span class="s2">&quot;****************&quot;</span><span class="p">,</span>
</span><span id="__span-51-9"><a id="__codelineno-51-9" name="__codelineno-51-9"></a>            <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;Sun, 29 Oct 2023 15:27:08 GMT&quot;</span><span class="p">,</span>
</span><span id="__span-51-10"><a id="__codelineno-51-10" name="__codelineno-51-10"></a>            <span class="s2">&quot;server&quot;</span><span class="p">:</span> <span class="s2">&quot;AmazonS3&quot;</span><span class="p">,</span>
</span><span id="__span-51-11"><a id="__codelineno-51-11" name="__codelineno-51-11"></a>        <span class="p">},</span>
</span><span id="__span-51-12"><a id="__codelineno-51-12" name="__codelineno-51-12"></a>        <span class="s2">&quot;RetryAttempts&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-51-13"><a id="__codelineno-51-13" name="__codelineno-51-13"></a>    <span class="p">}</span>
</span><span id="__span-51-14"><a id="__codelineno-51-14" name="__codelineno-51-14"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-52-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-52-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-52-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-52-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-52-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-52-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-52-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-52-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-52-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-52-10">10</a></span>
<span class="normal"><a href="#__codelineno-52-11">11</a></span>
<span class="normal"><a href="#__codelineno-52-12">12</a></span>
<span class="normal"><a href="#__codelineno-52-13">13</a></span>
<span class="normal"><a href="#__codelineno-52-14">14</a></span>
<span class="normal"><a href="#__codelineno-52-15">15</a></span>
<span class="normal"><a href="#__codelineno-52-16">16</a></span>
<span class="normal"><a href="#__codelineno-52-17">17</a></span>
<span class="normal"><a href="#__codelineno-52-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1"></a><span class="p">{</span>
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2"></a>    <span class="s2">&quot;ResponseMetadata&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3"></a>        <span class="s2">&quot;RequestId&quot;</span><span class="p">:</span> <span class="s2">&quot;****************&quot;</span><span class="p">,</span>
</span><span id="__span-52-4"><a id="__codelineno-52-4" name="__codelineno-52-4"></a>        <span class="s2">&quot;HostId&quot;</span><span class="p">:</span> <span class="s2">&quot;****************&quot;</span><span class="p">,</span>
</span><span id="__span-52-5"><a id="__codelineno-52-5" name="__codelineno-52-5"></a>        <span class="s2">&quot;HTTPStatusCode&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
</span><span id="__span-52-6"><a id="__codelineno-52-6" name="__codelineno-52-6"></a>        <span class="s2">&quot;HTTPHeaders&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-52-7"><a id="__codelineno-52-7" name="__codelineno-52-7"></a>            <span class="s2">&quot;x-amz-id-2&quot;</span><span class="p">:</span> <span class="s2">&quot;****************&quot;</span><span class="p">,</span>
</span><span id="__span-52-8"><a id="__codelineno-52-8" name="__codelineno-52-8"></a>            <span class="s2">&quot;x-amz-request-id&quot;</span><span class="p">:</span> <span class="s2">&quot;****************&quot;</span><span class="p">,</span>
</span><span id="__span-52-9"><a id="__codelineno-52-9" name="__codelineno-52-9"></a>            <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;Sun, 29 Oct 2023 15:27:08 GMT&quot;</span><span class="p">,</span>
</span><span id="__span-52-10"><a id="__codelineno-52-10" name="__codelineno-52-10"></a>            <span class="s2">&quot;content-type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/xml&quot;</span><span class="p">,</span>
</span><span id="__span-52-11"><a id="__codelineno-52-11" name="__codelineno-52-11"></a>            <span class="s2">&quot;transfer-encoding&quot;</span><span class="p">:</span> <span class="s2">&quot;chunked&quot;</span><span class="p">,</span>
</span><span id="__span-52-12"><a id="__codelineno-52-12" name="__codelineno-52-12"></a>            <span class="s2">&quot;server&quot;</span><span class="p">:</span> <span class="s2">&quot;AmazonS3&quot;</span><span class="p">,</span>
</span><span id="__span-52-13"><a id="__codelineno-52-13" name="__codelineno-52-13"></a>            <span class="s2">&quot;connection&quot;</span><span class="p">:</span> <span class="s2">&quot;close&quot;</span><span class="p">,</span>
</span><span id="__span-52-14"><a id="__codelineno-52-14" name="__codelineno-52-14"></a>        <span class="p">},</span>
</span><span id="__span-52-15"><a id="__codelineno-52-15" name="__codelineno-52-15"></a>        <span class="s2">&quot;RetryAttempts&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-52-16"><a id="__codelineno-52-16" name="__codelineno-52-16"></a>    <span class="p">},</span>
</span><span id="__span-52-17"><a id="__codelineno-52-17" name="__codelineno-52-17"></a>    <span class="s2">&quot;Deleted&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;upload-sample.json&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;upload-sample-copy.json&quot;</span><span class="p">}],</span>
</span><span id="__span-52-18"><a id="__codelineno-52-18" name="__codelineno-52-18"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<hr />
<h3 id="moving-a-fileobject">Moving a File/Object</h3>
<p>As of writing, the S3 client does not have a method specifically for moving an S3 object within a bucket or to other buckets. However, we can implement it by combining the <code>copy_object</code> and <code>delete_object</code>, in that order. A sample implementation and usage is shown below:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="16:3"><input checked="checked" id="__tabbed_16_1" name="__tabbed_16" type="radio" /><input id="__tabbed_16_2" name="__tabbed_16" type="radio" /><input id="__tabbed_16_3" name="__tabbed_16" type="radio" /><div class="tabbed-labels"><label for="__tabbed_16_1">aws_s3/api.py</label><label for="__tabbed_16_2">aws_s3/__init__.py</label><label for="__tabbed_16_3">app.py</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-53-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-53-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-53-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-53-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-53-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-53-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-53-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-53-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-53-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-53-10">10</a></span>
<span class="normal"><a href="#__codelineno-53-11">11</a></span>
<span class="normal"><a href="#__codelineno-53-12">12</a></span>
<span class="normal"><a href="#__codelineno-53-13">13</a></span>
<span class="normal"><a href="#__codelineno-53-14">14</a></span>
<span class="normal"><a href="#__codelineno-53-15">15</a></span>
<span class="normal"><a href="#__codelineno-53-16">16</a></span>
<span class="normal"><a href="#__codelineno-53-17">17</a></span>
<span class="normal"><a href="#__codelineno-53-18">18</a></span>
<span class="normal"><a href="#__codelineno-53-19">19</a></span>
<span class="normal"><a href="#__codelineno-53-20">20</a></span>
<span class="normal"><a href="#__codelineno-53-21">21</a></span>
<span class="normal"><a href="#__codelineno-53-22">22</a></span>
<span class="normal"><a href="#__codelineno-53-23">23</a></span>
<span class="normal"><a href="#__codelineno-53-24">24</a></span>
<span class="normal"><a href="#__codelineno-53-25">25</a></span>
<span class="normal"><a href="#__codelineno-53-26">26</a></span>
<span class="normal"><a href="#__codelineno-53-27">27</a></span>
<span class="normal"><a href="#__codelineno-53-28">28</a></span>
<span class="normal"><a href="#__codelineno-53-29">29</a></span>
<span class="normal"><a href="#__codelineno-53-30">30</a></span>
<span class="normal"><a href="#__codelineno-53-31">31</a></span>
<span class="normal"><a href="#__codelineno-53-32">32</a></span>
<span class="normal"><a href="#__codelineno-53-33">33</a></span>
<span class="normal"><a href="#__codelineno-53-34">34</a></span>
<span class="normal"><a href="#__codelineno-53-35">35</a></span>
<span class="normal"><a href="#__codelineno-53-36">36</a></span>
<span class="normal"><a href="#__codelineno-53-37">37</a></span>
<span class="normal"><a href="#__codelineno-53-38">38</a></span>
<span class="normal"><a href="#__codelineno-53-39">39</a></span>
<span class="normal"><a href="#__codelineno-53-40">40</a></span>
<span class="normal"><a href="#__codelineno-53-41">41</a></span>
<span class="normal"><a href="#__codelineno-53-42">42</a></span>
<span class="normal"><a href="#__codelineno-53-43">43</a></span>
<span class="normal"><a href="#__codelineno-53-44">44</a></span>
<span class="normal"><a href="#__codelineno-53-45">45</a></span>
<span class="normal"><a href="#__codelineno-53-46">46</a></span>
<span class="normal"><a href="#__codelineno-53-47">47</a></span>
<span class="normal"><a href="#__codelineno-53-48">48</a></span>
<span class="normal"><a href="#__codelineno-53-49">49</a></span>
<span class="normal"><a href="#__codelineno-53-50">50</a></span>
<span class="normal"><a href="#__codelineno-53-51">51</a></span>
<span class="normal"><a href="#__codelineno-53-52">52</a></span>
<span class="normal"><a href="#__codelineno-53-53">53</a></span>
<span class="normal"><a href="#__codelineno-53-54">54</a></span>
<span class="normal"><a href="#__codelineno-53-55">55</a></span>
<span class="normal"><a href="#__codelineno-53-56">56</a></span>
<span class="normal"><a href="#__codelineno-53-57">57</a></span>
<span class="normal"><a href="#__codelineno-53-58">58</a></span>
<span class="normal"><a href="#__codelineno-53-59">59</a></span>
<span class="normal"><a href="#__codelineno-53-60">60</a></span>
<span class="normal"><a href="#__codelineno-53-61">61</a></span>
<span class="normal"><a href="#__codelineno-53-62">62</a></span>
<span class="normal"><a href="#__codelineno-53-63">63</a></span>
<span class="normal"><a href="#__codelineno-53-64">64</a></span>
<span class="normal"><a href="#__codelineno-53-65">65</a></span>
<span class="normal"><a href="#__codelineno-53-66">66</a></span>
<span class="normal"><a href="#__codelineno-53-67">67</a></span>
<span class="normal"><a href="#__codelineno-53-68">68</a></span>
<span class="normal"><a href="#__codelineno-53-69">69</a></span>
<span class="normal"><a href="#__codelineno-53-70">70</a></span>
<span class="normal"><a href="#__codelineno-53-71">71</a></span>
<span class="normal"><a href="#__codelineno-53-72">72</a></span>
<span class="normal"><a href="#__codelineno-53-73">73</a></span>
<span class="normal"><a href="#__codelineno-53-74">74</a></span>
<span class="normal"><a href="#__codelineno-53-75">75</a></span>
<span class="normal"><a href="#__codelineno-53-76">76</a></span>
<span class="normal"><a href="#__codelineno-53-77">77</a></span>
<span class="normal"><a href="#__codelineno-53-78">78</a></span>
<span class="normal"><a href="#__codelineno-53-79">79</a></span>
<span class="normal"><a href="#__codelineno-53-80">80</a></span>
<span class="normal"><a href="#__codelineno-53-81">81</a></span>
<span class="normal"><a href="#__codelineno-53-82">82</a></span>
<span class="normal"><a href="#__codelineno-53-83">83</a></span>
<span class="normal"><a href="#__codelineno-53-84">84</a></span>
<span class="normal"><a href="#__codelineno-53-85">85</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2"></a>
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3"></a><span class="kn">import</span> <span class="nn">functools</span>
</span><span id="__span-53-4"><a id="__codelineno-53-4" name="__codelineno-53-4"></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Union</span>
</span><span id="__span-53-5"><a id="__codelineno-53-5" name="__codelineno-53-5"></a>
</span><span id="__span-53-6"><a id="__codelineno-53-6" name="__codelineno-53-6"></a><span class="kn">import</span> <span class="nn">boto3</span> <span class="k">as</span> <span class="nn">aws_sdk</span>
</span><span id="__span-53-7"><a id="__codelineno-53-7" name="__codelineno-53-7"></a><span class="kn">from</span> <span class="nn">mypy_boto3_s3</span> <span class="kn">import</span> <span class="n">S3Client</span>
</span><span id="__span-53-8"><a id="__codelineno-53-8" name="__codelineno-53-8"></a><span class="kn">from</span> <span class="nn">mypy_boto3_s3.client</span> <span class="kn">import</span> <span class="n">BotocoreClientError</span>
</span><span id="__span-53-9"><a id="__codelineno-53-9" name="__codelineno-53-9"></a><span class="kn">from</span> <span class="nn">mypy_boto3_s3.type_defs</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="__span-53-10"><a id="__codelineno-53-10" name="__codelineno-53-10"></a>    <span class="n">CopyObjectOutputTypeDef</span><span class="p">,</span>
</span><span id="__span-53-11"><a id="__codelineno-53-11" name="__codelineno-53-11"></a>    <span class="n">CopySourceTypeDef</span><span class="p">,</span>
</span><span id="__span-53-12"><a id="__codelineno-53-12" name="__codelineno-53-12"></a>    <span class="n">DeleteObjectOutputTypeDef</span><span class="p">,</span>
</span><span id="__span-53-13"><a id="__codelineno-53-13" name="__codelineno-53-13"></a><span class="p">)</span>
</span><span id="__span-53-14"><a id="__codelineno-53-14" name="__codelineno-53-14"></a>
</span><span id="__span-53-15"><a id="__codelineno-53-15" name="__codelineno-53-15"></a>
</span><span id="__span-53-16"><a id="__codelineno-53-16" name="__codelineno-53-16"></a><span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-53-17"><a id="__codelineno-53-17" name="__codelineno-53-17"></a><span class="k">def</span> <span class="nf">__get_client</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">S3Client</span><span class="p">:</span>
</span><span id="__span-53-18"><a id="__codelineno-53-18" name="__codelineno-53-18"></a>    <span class="n">session</span> <span class="o">=</span> <span class="n">aws_sdk</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
</span><span id="__span-53-19"><a id="__codelineno-53-19" name="__codelineno-53-19"></a>    <span class="k">return</span> <span class="n">session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">&quot;s3&quot;</span><span class="p">)</span>
</span><span id="__span-53-20"><a id="__codelineno-53-20" name="__codelineno-53-20"></a>
</span><span id="__span-53-21"><a id="__codelineno-53-21" name="__codelineno-53-21"></a>
</span><span id="__span-53-22"><a id="__codelineno-53-22" name="__codelineno-53-22"></a><span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-53-23"><a id="__codelineno-53-23" name="__codelineno-53-23"></a><span class="k">def</span> <span class="nf">__get_exceptions</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">BotocoreClientError</span><span class="p">],</span> <span class="o">...</span><span class="p">]:</span>
</span><span id="__span-53-24"><a id="__codelineno-53-24" name="__codelineno-53-24"></a>    <span class="n">client</span> <span class="o">=</span> <span class="n">__get_client</span><span class="p">()</span>
</span><span id="__span-53-25"><a id="__codelineno-53-25" name="__codelineno-53-25"></a>    <span class="k">return</span> <span class="p">(</span>
</span><span id="__span-53-26"><a id="__codelineno-53-26" name="__codelineno-53-26"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">BucketAlreadyExists</span><span class="p">,</span>
</span><span id="__span-53-27"><a id="__codelineno-53-27" name="__codelineno-53-27"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">BucketAlreadyOwnedByYou</span><span class="p">,</span>
</span><span id="__span-53-28"><a id="__codelineno-53-28" name="__codelineno-53-28"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ClientError</span><span class="p">,</span>
</span><span id="__span-53-29"><a id="__codelineno-53-29" name="__codelineno-53-29"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">InvalidObjectState</span><span class="p">,</span>
</span><span id="__span-53-30"><a id="__codelineno-53-30" name="__codelineno-53-30"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NoSuchBucket</span><span class="p">,</span>
</span><span id="__span-53-31"><a id="__codelineno-53-31" name="__codelineno-53-31"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NoSuchKey</span><span class="p">,</span>
</span><span id="__span-53-32"><a id="__codelineno-53-32" name="__codelineno-53-32"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NoSuchUpload</span><span class="p">,</span>
</span><span id="__span-53-33"><a id="__codelineno-53-33" name="__codelineno-53-33"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ObjectAlreadyInActiveTierError</span><span class="p">,</span>
</span><span id="__span-53-34"><a id="__codelineno-53-34" name="__codelineno-53-34"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ObjectNotInActiveTierError</span><span class="p">,</span>
</span><span id="__span-53-35"><a id="__codelineno-53-35" name="__codelineno-53-35"></a>    <span class="p">)</span>
</span><span id="__span-53-36"><a id="__codelineno-53-36" name="__codelineno-53-36"></a>
</span><span id="__span-53-37"><a id="__codelineno-53-37" name="__codelineno-53-37"></a>
</span><span id="__span-53-38"><a id="__codelineno-53-38" name="__codelineno-53-38"></a><span class="k">def</span> <span class="nf">copy_object</span><span class="p">(</span>
</span><span id="__span-53-39"><a id="__codelineno-53-39" name="__codelineno-53-39"></a>    <span class="n">source_bucket</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-53-40"><a id="__codelineno-53-40" name="__codelineno-53-40"></a>    <span class="n">source_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-53-41"><a id="__codelineno-53-41" name="__codelineno-53-41"></a>    <span class="n">target_bucket</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-53-42"><a id="__codelineno-53-42" name="__codelineno-53-42"></a>    <span class="n">target_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-53-43"><a id="__codelineno-53-43" name="__codelineno-53-43"></a>    <span class="o">*</span><span class="p">,</span>
</span><span id="__span-53-44"><a id="__codelineno-53-44" name="__codelineno-53-44"></a>    <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-53-45"><a id="__codelineno-53-45" name="__codelineno-53-45"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">CopyObjectOutputTypeDef</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="__span-53-46"><a id="__codelineno-53-46" name="__codelineno-53-46"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-53-47"><a id="__codelineno-53-47" name="__codelineno-53-47"></a>        <span class="n">client</span> <span class="o">=</span> <span class="n">__get_client</span><span class="p">()</span>
</span><span id="__span-53-48"><a id="__codelineno-53-48" name="__codelineno-53-48"></a>        <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">copy_object</span><span class="p">(</span>
</span><span id="__span-53-49"><a id="__codelineno-53-49" name="__codelineno-53-49"></a>            <span class="n">Bucket</span><span class="o">=</span><span class="n">target_bucket</span><span class="p">,</span>
</span><span id="__span-53-50"><a id="__codelineno-53-50" name="__codelineno-53-50"></a>            <span class="n">Key</span><span class="o">=</span><span class="n">target_key</span><span class="p">,</span>
</span><span id="__span-53-51"><a id="__codelineno-53-51" name="__codelineno-53-51"></a>            <span class="n">CopySource</span><span class="o">=</span><span class="n">CopySourceTypeDef</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">source_bucket</span><span class="p">,</span> <span class="n">Key</span><span class="o">=</span><span class="n">source_key</span><span class="p">),</span>
</span><span id="__span-53-52"><a id="__codelineno-53-52" name="__codelineno-53-52"></a>            <span class="n">Metadata</span><span class="o">=</span><span class="n">metadata</span> <span class="ow">or</span> <span class="p">{},</span>
</span><span id="__span-53-53"><a id="__codelineno-53-53" name="__codelineno-53-53"></a>        <span class="p">)</span>
</span><span id="__span-53-54"><a id="__codelineno-53-54" name="__codelineno-53-54"></a>
</span><span id="__span-53-55"><a id="__codelineno-53-55" name="__codelineno-53-55"></a>    <span class="k">except</span> <span class="n">__get_exceptions</span><span class="p">()</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-53-56"><a id="__codelineno-53-56" name="__codelineno-53-56"></a>        <span class="k">return</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span>
</span><span id="__span-53-57"><a id="__codelineno-53-57" name="__codelineno-53-57"></a>
</span><span id="__span-53-58"><a id="__codelineno-53-58" name="__codelineno-53-58"></a>
</span><span id="__span-53-59"><a id="__codelineno-53-59" name="__codelineno-53-59"></a><span class="k">def</span> <span class="nf">delete_object</span><span class="p">(</span>
</span><span id="__span-53-60"><a id="__codelineno-53-60" name="__codelineno-53-60"></a>    <span class="n">bucket</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="__span-53-61"><a id="__codelineno-53-61" name="__codelineno-53-61"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">DeleteObjectOutputTypeDef</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="__span-53-62"><a id="__codelineno-53-62" name="__codelineno-53-62"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-53-63"><a id="__codelineno-53-63" name="__codelineno-53-63"></a>        <span class="n">client</span> <span class="o">=</span> <span class="n">__get_client</span><span class="p">()</span>
</span><span id="__span-53-64"><a id="__codelineno-53-64" name="__codelineno-53-64"></a>        <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">delete_object</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">,</span> <span class="n">Key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
</span><span id="__span-53-65"><a id="__codelineno-53-65" name="__codelineno-53-65"></a>
</span><span id="__span-53-66"><a id="__codelineno-53-66" name="__codelineno-53-66"></a>    <span class="k">except</span> <span class="n">__get_exceptions</span><span class="p">()</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-53-67"><a id="__codelineno-53-67" name="__codelineno-53-67"></a>        <span class="k">return</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span>
</span><span id="__span-53-68"><a id="__codelineno-53-68" name="__codelineno-53-68"></a>
</span><span id="__span-53-69"><a id="__codelineno-53-69" name="__codelineno-53-69"></a>
</span><span id="__span-53-70"><a id="__codelineno-53-70" name="__codelineno-53-70"></a><span class="k">def</span> <span class="nf">move_object</span><span class="p">(</span>
</span><span id="__span-53-71"><a id="__codelineno-53-71" name="__codelineno-53-71"></a>    <span class="n">source_bucket</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-53-72"><a id="__codelineno-53-72" name="__codelineno-53-72"></a>    <span class="n">source_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-53-73"><a id="__codelineno-53-73" name="__codelineno-53-73"></a>    <span class="n">target_bucket</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-53-74"><a id="__codelineno-53-74" name="__codelineno-53-74"></a>    <span class="n">target_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-53-75"><a id="__codelineno-53-75" name="__codelineno-53-75"></a>    <span class="o">*</span><span class="p">,</span>
</span><span id="__span-53-76"><a id="__codelineno-53-76" name="__codelineno-53-76"></a>    <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-53-77"><a id="__codelineno-53-77" name="__codelineno-53-77"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">]:</span>
</span><span id="__span-53-78"><a id="__codelineno-53-78" name="__codelineno-53-78"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-53-79"><a id="__codelineno-53-79" name="__codelineno-53-79"></a>        <span class="n">copy_object</span><span class="p">(</span>
</span><span id="__span-53-80"><a id="__codelineno-53-80" name="__codelineno-53-80"></a>            <span class="n">source_bucket</span><span class="p">,</span> <span class="n">source_key</span><span class="p">,</span> <span class="n">target_bucket</span><span class="p">,</span> <span class="n">target_key</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span>
</span><span id="__span-53-81"><a id="__codelineno-53-81" name="__codelineno-53-81"></a>        <span class="p">)</span>
</span><span id="__span-53-82"><a id="__codelineno-53-82" name="__codelineno-53-82"></a>        <span class="n">delete_object</span><span class="p">(</span><span class="n">source_bucket</span><span class="p">,</span> <span class="n">source_key</span><span class="p">)</span>
</span><span id="__span-53-83"><a id="__codelineno-53-83" name="__codelineno-53-83"></a>
</span><span id="__span-53-84"><a id="__codelineno-53-84" name="__codelineno-53-84"></a>    <span class="k">except</span> <span class="n">__get_exceptions</span><span class="p">()</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-53-85"><a id="__codelineno-53-85" name="__codelineno-53-85"></a>        <span class="k">return</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-54-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1"></a><span class="kn">from</span> <span class="nn">.api</span> <span class="kn">import</span> <span class="n">move_object</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-55-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1"></a>
</span></code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<hr />
<h2 id="final-code">Final Code</h2>
<p>Below is the full implementation of all the S3 bucket and object client methods discussed above:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="17:3"><input checked="checked" id="__tabbed_17_1" name="__tabbed_17" type="radio" /><input id="__tabbed_17_2" name="__tabbed_17" type="radio" /><input id="__tabbed_17_3" name="__tabbed_17" type="radio" /><div class="tabbed-labels"><label for="__tabbed_17_1">requirements.txt</label><label for="__tabbed_17_2">aws_s3/__init__.py</label><label for="__tabbed_17_3">aws_s3/api.py</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-56-1">1</a></span>
<span class="normal"><a href="#__codelineno-56-2">2</a></span>
<span class="normal"><a href="#__codelineno-56-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1"></a>boto3==1.28.63
</span><span id="__span-56-2"><a id="__codelineno-56-2" name="__codelineno-56-2"></a>mypy-boto3-s3==1.28.55
</span><span id="__span-56-3"><a id="__codelineno-56-3" name="__codelineno-56-3"></a>rich
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-57-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-57-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-57-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-57-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-57-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-57-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-57-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-57-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-57-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-57-10">10</a></span>
<span class="normal"><a href="#__codelineno-57-11">11</a></span>
<span class="normal"><a href="#__codelineno-57-12">12</a></span>
<span class="normal"><a href="#__codelineno-57-13">13</a></span>
<span class="normal"><a href="#__codelineno-57-14">14</a></span>
<span class="normal"><a href="#__codelineno-57-15">15</a></span>
<span class="normal"><a href="#__codelineno-57-16">16</a></span>
<span class="normal"><a href="#__codelineno-57-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1"></a><span class="kn">from</span> <span class="nn">.api</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="__span-57-2"><a id="__codelineno-57-2" name="__codelineno-57-2"></a>    <span class="n">copy_object</span><span class="p">,</span>
</span><span id="__span-57-3"><a id="__codelineno-57-3" name="__codelineno-57-3"></a>    <span class="n">create_bucket</span><span class="p">,</span>
</span><span id="__span-57-4"><a id="__codelineno-57-4" name="__codelineno-57-4"></a>    <span class="n">delete_bucket</span><span class="p">,</span>
</span><span id="__span-57-5"><a id="__codelineno-57-5" name="__codelineno-57-5"></a>    <span class="n">delete_object</span><span class="p">,</span>
</span><span id="__span-57-6"><a id="__codelineno-57-6" name="__codelineno-57-6"></a>    <span class="n">delete_objects</span><span class="p">,</span>
</span><span id="__span-57-7"><a id="__codelineno-57-7" name="__codelineno-57-7"></a>    <span class="n">download_file</span><span class="p">,</span>
</span><span id="__span-57-8"><a id="__codelineno-57-8" name="__codelineno-57-8"></a>    <span class="n">generate_presigned_url</span><span class="p">,</span>
</span><span id="__span-57-9"><a id="__codelineno-57-9" name="__codelineno-57-9"></a>    <span class="n">get_bucket_metadata</span><span class="p">,</span>
</span><span id="__span-57-10"><a id="__codelineno-57-10" name="__codelineno-57-10"></a>    <span class="n">get_object</span><span class="p">,</span>
</span><span id="__span-57-11"><a id="__codelineno-57-11" name="__codelineno-57-11"></a>    <span class="n">get_object_metadata</span><span class="p">,</span>
</span><span id="__span-57-12"><a id="__codelineno-57-12" name="__codelineno-57-12"></a>    <span class="n">list_buckets</span><span class="p">,</span>
</span><span id="__span-57-13"><a id="__codelineno-57-13" name="__codelineno-57-13"></a>    <span class="n">list_objects</span><span class="p">,</span>
</span><span id="__span-57-14"><a id="__codelineno-57-14" name="__codelineno-57-14"></a>    <span class="n">move_object</span><span class="p">,</span>
</span><span id="__span-57-15"><a id="__codelineno-57-15" name="__codelineno-57-15"></a>    <span class="n">put_object</span><span class="p">,</span>
</span><span id="__span-57-16"><a id="__codelineno-57-16" name="__codelineno-57-16"></a>    <span class="n">upload_file</span><span class="p">,</span>
</span><span id="__span-57-17"><a id="__codelineno-57-17" name="__codelineno-57-17"></a><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-58-1">  1</a></span>
<span class="normal"><a href="#__codelineno-58-2">  2</a></span>
<span class="normal"><a href="#__codelineno-58-3">  3</a></span>
<span class="normal"><a href="#__codelineno-58-4">  4</a></span>
<span class="normal"><a href="#__codelineno-58-5">  5</a></span>
<span class="normal"><a href="#__codelineno-58-6">  6</a></span>
<span class="normal"><a href="#__codelineno-58-7">  7</a></span>
<span class="normal"><a href="#__codelineno-58-8">  8</a></span>
<span class="normal"><a href="#__codelineno-58-9">  9</a></span>
<span class="normal"><a href="#__codelineno-58-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-58-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-58-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-58-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-58-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-58-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-58-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-58-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-58-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-58-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-58-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-58-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-58-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-58-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-58-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-58-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-58-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-58-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-58-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-58-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-58-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-58-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-58-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-58-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-58-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-58-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-58-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-58-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-58-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-58-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-58-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-58-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-58-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-58-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-58-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-58-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-58-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-58-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-58-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-58-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-58-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-58-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-58-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-58-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-58-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-58-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-58-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-58-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-58-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-58-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-58-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-58-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-58-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-58-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-58-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-58-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-58-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-58-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-58-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-58-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-58-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-58-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-58-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-58-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-58-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-58-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-58-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-58-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-58-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-58-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-58-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-58-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-58-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-58-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-58-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-58-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-58-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-58-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-58-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-58-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-58-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-58-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-58-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-58-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-58-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-58-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-58-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-58-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-58-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-58-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-58-100">100</a></span>
<span class="normal"><a href="#__codelineno-58-101">101</a></span>
<span class="normal"><a href="#__codelineno-58-102">102</a></span>
<span class="normal"><a href="#__codelineno-58-103">103</a></span>
<span class="normal"><a href="#__codelineno-58-104">104</a></span>
<span class="normal"><a href="#__codelineno-58-105">105</a></span>
<span class="normal"><a href="#__codelineno-58-106">106</a></span>
<span class="normal"><a href="#__codelineno-58-107">107</a></span>
<span class="normal"><a href="#__codelineno-58-108">108</a></span>
<span class="normal"><a href="#__codelineno-58-109">109</a></span>
<span class="normal"><a href="#__codelineno-58-110">110</a></span>
<span class="normal"><a href="#__codelineno-58-111">111</a></span>
<span class="normal"><a href="#__codelineno-58-112">112</a></span>
<span class="normal"><a href="#__codelineno-58-113">113</a></span>
<span class="normal"><a href="#__codelineno-58-114">114</a></span>
<span class="normal"><a href="#__codelineno-58-115">115</a></span>
<span class="normal"><a href="#__codelineno-58-116">116</a></span>
<span class="normal"><a href="#__codelineno-58-117">117</a></span>
<span class="normal"><a href="#__codelineno-58-118">118</a></span>
<span class="normal"><a href="#__codelineno-58-119">119</a></span>
<span class="normal"><a href="#__codelineno-58-120">120</a></span>
<span class="normal"><a href="#__codelineno-58-121">121</a></span>
<span class="normal"><a href="#__codelineno-58-122">122</a></span>
<span class="normal"><a href="#__codelineno-58-123">123</a></span>
<span class="normal"><a href="#__codelineno-58-124">124</a></span>
<span class="normal"><a href="#__codelineno-58-125">125</a></span>
<span class="normal"><a href="#__codelineno-58-126">126</a></span>
<span class="normal"><a href="#__codelineno-58-127">127</a></span>
<span class="normal"><a href="#__codelineno-58-128">128</a></span>
<span class="normal"><a href="#__codelineno-58-129">129</a></span>
<span class="normal"><a href="#__codelineno-58-130">130</a></span>
<span class="normal"><a href="#__codelineno-58-131">131</a></span>
<span class="normal"><a href="#__codelineno-58-132">132</a></span>
<span class="normal"><a href="#__codelineno-58-133">133</a></span>
<span class="normal"><a href="#__codelineno-58-134">134</a></span>
<span class="normal"><a href="#__codelineno-58-135">135</a></span>
<span class="normal"><a href="#__codelineno-58-136">136</a></span>
<span class="normal"><a href="#__codelineno-58-137">137</a></span>
<span class="normal"><a href="#__codelineno-58-138">138</a></span>
<span class="normal"><a href="#__codelineno-58-139">139</a></span>
<span class="normal"><a href="#__codelineno-58-140">140</a></span>
<span class="normal"><a href="#__codelineno-58-141">141</a></span>
<span class="normal"><a href="#__codelineno-58-142">142</a></span>
<span class="normal"><a href="#__codelineno-58-143">143</a></span>
<span class="normal"><a href="#__codelineno-58-144">144</a></span>
<span class="normal"><a href="#__codelineno-58-145">145</a></span>
<span class="normal"><a href="#__codelineno-58-146">146</a></span>
<span class="normal"><a href="#__codelineno-58-147">147</a></span>
<span class="normal"><a href="#__codelineno-58-148">148</a></span>
<span class="normal"><a href="#__codelineno-58-149">149</a></span>
<span class="normal"><a href="#__codelineno-58-150">150</a></span>
<span class="normal"><a href="#__codelineno-58-151">151</a></span>
<span class="normal"><a href="#__codelineno-58-152">152</a></span>
<span class="normal"><a href="#__codelineno-58-153">153</a></span>
<span class="normal"><a href="#__codelineno-58-154">154</a></span>
<span class="normal"><a href="#__codelineno-58-155">155</a></span>
<span class="normal"><a href="#__codelineno-58-156">156</a></span>
<span class="normal"><a href="#__codelineno-58-157">157</a></span>
<span class="normal"><a href="#__codelineno-58-158">158</a></span>
<span class="normal"><a href="#__codelineno-58-159">159</a></span>
<span class="normal"><a href="#__codelineno-58-160">160</a></span>
<span class="normal"><a href="#__codelineno-58-161">161</a></span>
<span class="normal"><a href="#__codelineno-58-162">162</a></span>
<span class="normal"><a href="#__codelineno-58-163">163</a></span>
<span class="normal"><a href="#__codelineno-58-164">164</a></span>
<span class="normal"><a href="#__codelineno-58-165">165</a></span>
<span class="normal"><a href="#__codelineno-58-166">166</a></span>
<span class="normal"><a href="#__codelineno-58-167">167</a></span>
<span class="normal"><a href="#__codelineno-58-168">168</a></span>
<span class="normal"><a href="#__codelineno-58-169">169</a></span>
<span class="normal"><a href="#__codelineno-58-170">170</a></span>
<span class="normal"><a href="#__codelineno-58-171">171</a></span>
<span class="normal"><a href="#__codelineno-58-172">172</a></span>
<span class="normal"><a href="#__codelineno-58-173">173</a></span>
<span class="normal"><a href="#__codelineno-58-174">174</a></span>
<span class="normal"><a href="#__codelineno-58-175">175</a></span>
<span class="normal"><a href="#__codelineno-58-176">176</a></span>
<span class="normal"><a href="#__codelineno-58-177">177</a></span>
<span class="normal"><a href="#__codelineno-58-178">178</a></span>
<span class="normal"><a href="#__codelineno-58-179">179</a></span>
<span class="normal"><a href="#__codelineno-58-180">180</a></span>
<span class="normal"><a href="#__codelineno-58-181">181</a></span>
<span class="normal"><a href="#__codelineno-58-182">182</a></span>
<span class="normal"><a href="#__codelineno-58-183">183</a></span>
<span class="normal"><a href="#__codelineno-58-184">184</a></span>
<span class="normal"><a href="#__codelineno-58-185">185</a></span>
<span class="normal"><a href="#__codelineno-58-186">186</a></span>
<span class="normal"><a href="#__codelineno-58-187">187</a></span>
<span class="normal"><a href="#__codelineno-58-188">188</a></span>
<span class="normal"><a href="#__codelineno-58-189">189</a></span>
<span class="normal"><a href="#__codelineno-58-190">190</a></span>
<span class="normal"><a href="#__codelineno-58-191">191</a></span>
<span class="normal"><a href="#__codelineno-58-192">192</a></span>
<span class="normal"><a href="#__codelineno-58-193">193</a></span>
<span class="normal"><a href="#__codelineno-58-194">194</a></span>
<span class="normal"><a href="#__codelineno-58-195">195</a></span>
<span class="normal"><a href="#__codelineno-58-196">196</a></span>
<span class="normal"><a href="#__codelineno-58-197">197</a></span>
<span class="normal"><a href="#__codelineno-58-198">198</a></span>
<span class="normal"><a href="#__codelineno-58-199">199</a></span>
<span class="normal"><a href="#__codelineno-58-200">200</a></span>
<span class="normal"><a href="#__codelineno-58-201">201</a></span>
<span class="normal"><a href="#__codelineno-58-202">202</a></span>
<span class="normal"><a href="#__codelineno-58-203">203</a></span>
<span class="normal"><a href="#__codelineno-58-204">204</a></span>
<span class="normal"><a href="#__codelineno-58-205">205</a></span>
<span class="normal"><a href="#__codelineno-58-206">206</a></span>
<span class="normal"><a href="#__codelineno-58-207">207</a></span>
<span class="normal"><a href="#__codelineno-58-208">208</a></span>
<span class="normal"><a href="#__codelineno-58-209">209</a></span>
<span class="normal"><a href="#__codelineno-58-210">210</a></span>
<span class="normal"><a href="#__codelineno-58-211">211</a></span>
<span class="normal"><a href="#__codelineno-58-212">212</a></span>
<span class="normal"><a href="#__codelineno-58-213">213</a></span>
<span class="normal"><a href="#__codelineno-58-214">214</a></span>
<span class="normal"><a href="#__codelineno-58-215">215</a></span>
<span class="normal"><a href="#__codelineno-58-216">216</a></span>
<span class="normal"><a href="#__codelineno-58-217">217</a></span>
<span class="normal"><a href="#__codelineno-58-218">218</a></span>
<span class="normal"><a href="#__codelineno-58-219">219</a></span>
<span class="normal"><a href="#__codelineno-58-220">220</a></span>
<span class="normal"><a href="#__codelineno-58-221">221</a></span>
<span class="normal"><a href="#__codelineno-58-222">222</a></span>
<span class="normal"><a href="#__codelineno-58-223">223</a></span>
<span class="normal"><a href="#__codelineno-58-224">224</a></span>
<span class="normal"><a href="#__codelineno-58-225">225</a></span>
<span class="normal"><a href="#__codelineno-58-226">226</a></span>
<span class="normal"><a href="#__codelineno-58-227">227</a></span>
<span class="normal"><a href="#__codelineno-58-228">228</a></span>
<span class="normal"><a href="#__codelineno-58-229">229</a></span>
<span class="normal"><a href="#__codelineno-58-230">230</a></span>
<span class="normal"><a href="#__codelineno-58-231">231</a></span>
<span class="normal"><a href="#__codelineno-58-232">232</a></span>
<span class="normal"><a href="#__codelineno-58-233">233</a></span>
<span class="normal"><a href="#__codelineno-58-234">234</a></span>
<span class="normal"><a href="#__codelineno-58-235">235</a></span>
<span class="normal"><a href="#__codelineno-58-236">236</a></span>
<span class="normal"><a href="#__codelineno-58-237">237</a></span>
<span class="normal"><a href="#__codelineno-58-238">238</a></span>
<span class="normal"><a href="#__codelineno-58-239">239</a></span>
<span class="normal"><a href="#__codelineno-58-240">240</a></span>
<span class="normal"><a href="#__codelineno-58-241">241</a></span>
<span class="normal"><a href="#__codelineno-58-242">242</a></span>
<span class="normal"><a href="#__codelineno-58-243">243</a></span>
<span class="normal"><a href="#__codelineno-58-244">244</a></span>
<span class="normal"><a href="#__codelineno-58-245">245</a></span>
<span class="normal"><a href="#__codelineno-58-246">246</a></span>
<span class="normal"><a href="#__codelineno-58-247">247</a></span>
<span class="normal"><a href="#__codelineno-58-248">248</a></span>
<span class="normal"><a href="#__codelineno-58-249">249</a></span>
<span class="normal"><a href="#__codelineno-58-250">250</a></span>
<span class="normal"><a href="#__codelineno-58-251">251</a></span>
<span class="normal"><a href="#__codelineno-58-252">252</a></span>
<span class="normal"><a href="#__codelineno-58-253">253</a></span>
<span class="normal"><a href="#__codelineno-58-254">254</a></span>
<span class="normal"><a href="#__codelineno-58-255">255</a></span>
<span class="normal"><a href="#__codelineno-58-256">256</a></span>
<span class="normal"><a href="#__codelineno-58-257">257</a></span>
<span class="normal"><a href="#__codelineno-58-258">258</a></span>
<span class="normal"><a href="#__codelineno-58-259">259</a></span>
<span class="normal"><a href="#__codelineno-58-260">260</a></span>
<span class="normal"><a href="#__codelineno-58-261">261</a></span>
<span class="normal"><a href="#__codelineno-58-262">262</a></span>
<span class="normal"><a href="#__codelineno-58-263">263</a></span>
<span class="normal"><a href="#__codelineno-58-264">264</a></span>
<span class="normal"><a href="#__codelineno-58-265">265</a></span>
<span class="normal"><a href="#__codelineno-58-266">266</a></span>
<span class="normal"><a href="#__codelineno-58-267">267</a></span>
<span class="normal"><a href="#__codelineno-58-268">268</a></span>
<span class="normal"><a href="#__codelineno-58-269">269</a></span>
<span class="normal"><a href="#__codelineno-58-270">270</a></span>
<span class="normal"><a href="#__codelineno-58-271">271</a></span>
<span class="normal"><a href="#__codelineno-58-272">272</a></span>
<span class="normal"><a href="#__codelineno-58-273">273</a></span>
<span class="normal"><a href="#__codelineno-58-274">274</a></span>
<span class="normal"><a href="#__codelineno-58-275">275</a></span>
<span class="normal"><a href="#__codelineno-58-276">276</a></span>
<span class="normal"><a href="#__codelineno-58-277">277</a></span>
<span class="normal"><a href="#__codelineno-58-278">278</a></span>
<span class="normal"><a href="#__codelineno-58-279">279</a></span>
<span class="normal"><a href="#__codelineno-58-280">280</a></span>
<span class="normal"><a href="#__codelineno-58-281">281</a></span>
<span class="normal"><a href="#__codelineno-58-282">282</a></span>
<span class="normal"><a href="#__codelineno-58-283">283</a></span>
<span class="normal"><a href="#__codelineno-58-284">284</a></span>
<span class="normal"><a href="#__codelineno-58-285">285</a></span>
<span class="normal"><a href="#__codelineno-58-286">286</a></span>
<span class="normal"><a href="#__codelineno-58-287">287</a></span>
<span class="normal"><a href="#__codelineno-58-288">288</a></span>
<span class="normal"><a href="#__codelineno-58-289">289</a></span>
<span class="normal"><a href="#__codelineno-58-290">290</a></span>
<span class="normal"><a href="#__codelineno-58-291">291</a></span>
<span class="normal"><a href="#__codelineno-58-292">292</a></span>
<span class="normal"><a href="#__codelineno-58-293">293</a></span>
<span class="normal"><a href="#__codelineno-58-294">294</a></span>
<span class="normal"><a href="#__codelineno-58-295">295</a></span>
<span class="normal"><a href="#__codelineno-58-296">296</a></span>
<span class="normal"><a href="#__codelineno-58-297">297</a></span>
<span class="normal"><a href="#__codelineno-58-298">298</a></span>
<span class="normal"><a href="#__codelineno-58-299">299</a></span>
<span class="normal"><a href="#__codelineno-58-300">300</a></span>
<span class="normal"><a href="#__codelineno-58-301">301</a></span>
<span class="normal"><a href="#__codelineno-58-302">302</a></span>
<span class="normal"><a href="#__codelineno-58-303">303</a></span>
<span class="normal"><a href="#__codelineno-58-304">304</a></span>
<span class="normal"><a href="#__codelineno-58-305">305</a></span>
<span class="normal"><a href="#__codelineno-58-306">306</a></span>
<span class="normal"><a href="#__codelineno-58-307">307</a></span>
<span class="normal"><a href="#__codelineno-58-308">308</a></span>
<span class="normal"><a href="#__codelineno-58-309">309</a></span>
<span class="normal"><a href="#__codelineno-58-310">310</a></span>
<span class="normal"><a href="#__codelineno-58-311">311</a></span>
<span class="normal"><a href="#__codelineno-58-312">312</a></span>
<span class="normal"><a href="#__codelineno-58-313">313</a></span>
<span class="normal"><a href="#__codelineno-58-314">314</a></span>
<span class="normal"><a href="#__codelineno-58-315">315</a></span>
<span class="normal"><a href="#__codelineno-58-316">316</a></span>
<span class="normal"><a href="#__codelineno-58-317">317</a></span>
<span class="normal"><a href="#__codelineno-58-318">318</a></span>
<span class="normal"><a href="#__codelineno-58-319">319</a></span>
<span class="normal"><a href="#__codelineno-58-320">320</a></span>
<span class="normal"><a href="#__codelineno-58-321">321</a></span>
<span class="normal"><a href="#__codelineno-58-322">322</a></span>
<span class="normal"><a href="#__codelineno-58-323">323</a></span>
<span class="normal"><a href="#__codelineno-58-324">324</a></span>
<span class="normal"><a href="#__codelineno-58-325">325</a></span>
<span class="normal"><a href="#__codelineno-58-326">326</a></span>
<span class="normal"><a href="#__codelineno-58-327">327</a></span>
<span class="normal"><a href="#__codelineno-58-328">328</a></span>
<span class="normal"><a href="#__codelineno-58-329">329</a></span>
<span class="normal"><a href="#__codelineno-58-330">330</a></span>
<span class="normal"><a href="#__codelineno-58-331">331</a></span>
<span class="normal"><a href="#__codelineno-58-332">332</a></span>
<span class="normal"><a href="#__codelineno-58-333">333</a></span>
<span class="normal"><a href="#__codelineno-58-334">334</a></span>
<span class="normal"><a href="#__codelineno-58-335">335</a></span>
<span class="normal"><a href="#__codelineno-58-336">336</a></span>
<span class="normal"><a href="#__codelineno-58-337">337</a></span>
<span class="normal"><a href="#__codelineno-58-338">338</a></span>
<span class="normal"><a href="#__codelineno-58-339">339</a></span>
<span class="normal"><a href="#__codelineno-58-340">340</a></span>
<span class="normal"><a href="#__codelineno-58-341">341</a></span>
<span class="normal"><a href="#__codelineno-58-342">342</a></span>
<span class="normal"><a href="#__codelineno-58-343">343</a></span>
<span class="normal"><a href="#__codelineno-58-344">344</a></span>
<span class="normal"><a href="#__codelineno-58-345">345</a></span>
<span class="normal"><a href="#__codelineno-58-346">346</a></span>
<span class="normal"><a href="#__codelineno-58-347">347</a></span>
<span class="normal"><a href="#__codelineno-58-348">348</a></span>
<span class="normal"><a href="#__codelineno-58-349">349</a></span>
<span class="normal"><a href="#__codelineno-58-350">350</a></span>
<span class="normal"><a href="#__codelineno-58-351">351</a></span>
<span class="normal"><a href="#__codelineno-58-352">352</a></span>
<span class="normal"><a href="#__codelineno-58-353">353</a></span>
<span class="normal"><a href="#__codelineno-58-354">354</a></span>
<span class="normal"><a href="#__codelineno-58-355">355</a></span>
<span class="normal"><a href="#__codelineno-58-356">356</a></span>
<span class="normal"><a href="#__codelineno-58-357">357</a></span>
<span class="normal"><a href="#__codelineno-58-358">358</a></span>
<span class="normal"><a href="#__codelineno-58-359">359</a></span>
<span class="normal"><a href="#__codelineno-58-360">360</a></span>
<span class="normal"><a href="#__codelineno-58-361">361</a></span>
<span class="normal"><a href="#__codelineno-58-362">362</a></span>
<span class="normal"><a href="#__codelineno-58-363">363</a></span>
<span class="normal"><a href="#__codelineno-58-364">364</a></span>
<span class="normal"><a href="#__codelineno-58-365">365</a></span>
<span class="normal"><a href="#__codelineno-58-366">366</a></span>
<span class="normal"><a href="#__codelineno-58-367">367</a></span>
<span class="normal"><a href="#__codelineno-58-368">368</a></span>
<span class="normal"><a href="#__codelineno-58-369">369</a></span>
<span class="normal"><a href="#__codelineno-58-370">370</a></span>
<span class="normal"><a href="#__codelineno-58-371">371</a></span>
<span class="normal"><a href="#__codelineno-58-372">372</a></span>
<span class="normal"><a href="#__codelineno-58-373">373</a></span>
<span class="normal"><a href="#__codelineno-58-374">374</a></span>
<span class="normal"><a href="#__codelineno-58-375">375</a></span>
<span class="normal"><a href="#__codelineno-58-376">376</a></span>
<span class="normal"><a href="#__codelineno-58-377">377</a></span>
<span class="normal"><a href="#__codelineno-58-378">378</a></span>
<span class="normal"><a href="#__codelineno-58-379">379</a></span>
<span class="normal"><a href="#__codelineno-58-380">380</a></span>
<span class="normal"><a href="#__codelineno-58-381">381</a></span>
<span class="normal"><a href="#__codelineno-58-382">382</a></span>
<span class="normal"><a href="#__codelineno-58-383">383</a></span>
<span class="normal"><a href="#__codelineno-58-384">384</a></span>
<span class="normal"><a href="#__codelineno-58-385">385</a></span>
<span class="normal"><a href="#__codelineno-58-386">386</a></span>
<span class="normal"><a href="#__codelineno-58-387">387</a></span>
<span class="normal"><a href="#__codelineno-58-388">388</a></span>
<span class="normal"><a href="#__codelineno-58-389">389</a></span>
<span class="normal"><a href="#__codelineno-58-390">390</a></span>
<span class="normal"><a href="#__codelineno-58-391">391</a></span>
<span class="normal"><a href="#__codelineno-58-392">392</a></span>
<span class="normal"><a href="#__codelineno-58-393">393</a></span>
<span class="normal"><a href="#__codelineno-58-394">394</a></span>
<span class="normal"><a href="#__codelineno-58-395">395</a></span>
<span class="normal"><a href="#__codelineno-58-396">396</a></span>
<span class="normal"><a href="#__codelineno-58-397">397</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
</span><span id="__span-58-2"><a id="__codelineno-58-2" name="__codelineno-58-2"></a>
</span><span id="__span-58-3"><a id="__codelineno-58-3" name="__codelineno-58-3"></a><span class="kn">import</span> <span class="nn">functools</span>
</span><span id="__span-58-4"><a id="__codelineno-58-4" name="__codelineno-58-4"></a><span class="kn">import</span> <span class="nn">os</span>
</span><span id="__span-58-5"><a id="__codelineno-58-5" name="__codelineno-58-5"></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">cast</span>
</span><span id="__span-58-6"><a id="__codelineno-58-6" name="__codelineno-58-6"></a>
</span><span id="__span-58-7"><a id="__codelineno-58-7" name="__codelineno-58-7"></a><span class="kn">import</span> <span class="nn">boto3</span> <span class="k">as</span> <span class="nn">aws_sdk</span>
</span><span id="__span-58-8"><a id="__codelineno-58-8" name="__codelineno-58-8"></a><span class="kn">from</span> <span class="nn">mypy_boto3_s3</span> <span class="kn">import</span> <span class="n">S3Client</span>
</span><span id="__span-58-9"><a id="__codelineno-58-9" name="__codelineno-58-9"></a><span class="kn">from</span> <span class="nn">mypy_boto3_s3.client</span> <span class="kn">import</span> <span class="n">BotocoreClientError</span>
</span><span id="__span-58-10"><a id="__codelineno-58-10" name="__codelineno-58-10"></a><span class="kn">from</span> <span class="nn">mypy_boto3_s3.paginator</span> <span class="kn">import</span> <span class="n">ListObjectsV2Paginator</span>
</span><span id="__span-58-11"><a id="__codelineno-58-11" name="__codelineno-58-11"></a><span class="kn">from</span> <span class="nn">mypy_boto3_s3.type_defs</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="__span-58-12"><a id="__codelineno-58-12" name="__codelineno-58-12"></a>    <span class="n">CopyObjectOutputTypeDef</span><span class="p">,</span>
</span><span id="__span-58-13"><a id="__codelineno-58-13" name="__codelineno-58-13"></a>    <span class="n">CopySourceTypeDef</span><span class="p">,</span>
</span><span id="__span-58-14"><a id="__codelineno-58-14" name="__codelineno-58-14"></a>    <span class="n">CreateBucketConfigurationTypeDef</span><span class="p">,</span>
</span><span id="__span-58-15"><a id="__codelineno-58-15" name="__codelineno-58-15"></a>    <span class="n">CreateBucketOutputTypeDef</span><span class="p">,</span>
</span><span id="__span-58-16"><a id="__codelineno-58-16" name="__codelineno-58-16"></a>    <span class="n">DeleteObjectOutputTypeDef</span><span class="p">,</span>
</span><span id="__span-58-17"><a id="__codelineno-58-17" name="__codelineno-58-17"></a>    <span class="n">DeleteObjectsOutputTypeDef</span><span class="p">,</span>
</span><span id="__span-58-18"><a id="__codelineno-58-18" name="__codelineno-58-18"></a>    <span class="n">DeleteTypeDef</span><span class="p">,</span>
</span><span id="__span-58-19"><a id="__codelineno-58-19" name="__codelineno-58-19"></a>    <span class="n">EmptyResponseMetadataTypeDef</span><span class="p">,</span>
</span><span id="__span-58-20"><a id="__codelineno-58-20" name="__codelineno-58-20"></a>    <span class="n">GetObjectOutputTypeDef</span><span class="p">,</span>
</span><span id="__span-58-21"><a id="__codelineno-58-21" name="__codelineno-58-21"></a>    <span class="n">HeadObjectOutputTypeDef</span><span class="p">,</span>
</span><span id="__span-58-22"><a id="__codelineno-58-22" name="__codelineno-58-22"></a>    <span class="n">ListBucketsOutputTypeDef</span><span class="p">,</span>
</span><span id="__span-58-23"><a id="__codelineno-58-23" name="__codelineno-58-23"></a>    <span class="n">ObjectIdentifierTypeDef</span><span class="p">,</span>
</span><span id="__span-58-24"><a id="__codelineno-58-24" name="__codelineno-58-24"></a>    <span class="n">ObjectTypeDef</span><span class="p">,</span>
</span><span id="__span-58-25"><a id="__codelineno-58-25" name="__codelineno-58-25"></a>    <span class="n">PutObjectOutputTypeDef</span><span class="p">,</span>
</span><span id="__span-58-26"><a id="__codelineno-58-26" name="__codelineno-58-26"></a><span class="p">)</span>
</span><span id="__span-58-27"><a id="__codelineno-58-27" name="__codelineno-58-27"></a>
</span><span id="__span-58-28"><a id="__codelineno-58-28" name="__codelineno-58-28"></a>
</span><span id="__span-58-29"><a id="__codelineno-58-29" name="__codelineno-58-29"></a><span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-58-30"><a id="__codelineno-58-30" name="__codelineno-58-30"></a><span class="k">def</span> <span class="nf">__get_client</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">S3Client</span><span class="p">:</span>
</span><span id="__span-58-31"><a id="__codelineno-58-31" name="__codelineno-58-31"></a>    <span class="n">session</span> <span class="o">=</span> <span class="n">aws_sdk</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
</span><span id="__span-58-32"><a id="__codelineno-58-32" name="__codelineno-58-32"></a>    <span class="k">return</span> <span class="n">session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">&quot;s3&quot;</span><span class="p">)</span>
</span><span id="__span-58-33"><a id="__codelineno-58-33" name="__codelineno-58-33"></a>
</span><span id="__span-58-34"><a id="__codelineno-58-34" name="__codelineno-58-34"></a>
</span><span id="__span-58-35"><a id="__codelineno-58-35" name="__codelineno-58-35"></a><span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-58-36"><a id="__codelineno-58-36" name="__codelineno-58-36"></a><span class="k">def</span> <span class="nf">__get_exceptions</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">BotocoreClientError</span><span class="p">],</span> <span class="o">...</span><span class="p">]:</span>
</span><span id="__span-58-37"><a id="__codelineno-58-37" name="__codelineno-58-37"></a>    <span class="n">client</span> <span class="o">=</span> <span class="n">__get_client</span><span class="p">()</span>
</span><span id="__span-58-38"><a id="__codelineno-58-38" name="__codelineno-58-38"></a>    <span class="k">return</span> <span class="p">(</span>
</span><span id="__span-58-39"><a id="__codelineno-58-39" name="__codelineno-58-39"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">BucketAlreadyExists</span><span class="p">,</span>
</span><span id="__span-58-40"><a id="__codelineno-58-40" name="__codelineno-58-40"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">BucketAlreadyOwnedByYou</span><span class="p">,</span>
</span><span id="__span-58-41"><a id="__codelineno-58-41" name="__codelineno-58-41"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ClientError</span><span class="p">,</span>
</span><span id="__span-58-42"><a id="__codelineno-58-42" name="__codelineno-58-42"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">InvalidObjectState</span><span class="p">,</span>
</span><span id="__span-58-43"><a id="__codelineno-58-43" name="__codelineno-58-43"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NoSuchBucket</span><span class="p">,</span>
</span><span id="__span-58-44"><a id="__codelineno-58-44" name="__codelineno-58-44"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NoSuchKey</span><span class="p">,</span>
</span><span id="__span-58-45"><a id="__codelineno-58-45" name="__codelineno-58-45"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NoSuchUpload</span><span class="p">,</span>
</span><span id="__span-58-46"><a id="__codelineno-58-46" name="__codelineno-58-46"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ObjectAlreadyInActiveTierError</span><span class="p">,</span>
</span><span id="__span-58-47"><a id="__codelineno-58-47" name="__codelineno-58-47"></a>        <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ObjectNotInActiveTierError</span><span class="p">,</span>
</span><span id="__span-58-48"><a id="__codelineno-58-48" name="__codelineno-58-48"></a>    <span class="p">)</span>
</span><span id="__span-58-49"><a id="__codelineno-58-49" name="__codelineno-58-49"></a>
</span><span id="__span-58-50"><a id="__codelineno-58-50" name="__codelineno-58-50"></a>
</span><span id="__span-58-51"><a id="__codelineno-58-51" name="__codelineno-58-51"></a><span class="k">def</span> <span class="nf">create_bucket</span><span class="p">(</span>
</span><span id="__span-58-52"><a id="__codelineno-58-52" name="__codelineno-58-52"></a>    <span class="n">bucket</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">region</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-58-53"><a id="__codelineno-58-53" name="__codelineno-58-53"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">CreateBucketOutputTypeDef</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="__span-58-54"><a id="__codelineno-58-54" name="__codelineno-58-54"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-58-55"><a id="__codelineno-58-55" name="__codelineno-58-55"></a><span class="sd">    Create an AWS S3 bucket with name `bucket` in region `region`. If `region` is not</span>
</span><span id="__span-58-56"><a id="__codelineno-58-56" name="__codelineno-58-56"></a><span class="sd">    defined, then `region` will be set to `us-east-1`.</span>
</span><span id="__span-58-57"><a id="__codelineno-58-57" name="__codelineno-58-57"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-58-58"><a id="__codelineno-58-58" name="__codelineno-58-58"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-58-59"><a id="__codelineno-58-59" name="__codelineno-58-59"></a>        <span class="n">client</span> <span class="o">=</span> <span class="n">__get_client</span><span class="p">()</span>
</span><span id="__span-58-60"><a id="__codelineno-58-60" name="__codelineno-58-60"></a>        <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">create_bucket</span><span class="p">(</span>
</span><span id="__span-58-61"><a id="__codelineno-58-61" name="__codelineno-58-61"></a>            <span class="n">Bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">,</span>
</span><span id="__span-58-62"><a id="__codelineno-58-62" name="__codelineno-58-62"></a>            <span class="n">CreateBucketConfiguration</span><span class="o">=</span><span class="n">CreateBucketConfigurationTypeDef</span><span class="p">(</span>
</span><span id="__span-58-63"><a id="__codelineno-58-63" name="__codelineno-58-63"></a>                <span class="n">LocationConstraint</span><span class="o">=</span><span class="n">region</span> <span class="ow">or</span> <span class="s2">&quot;us-east-1&quot;</span>
</span><span id="__span-58-64"><a id="__codelineno-58-64" name="__codelineno-58-64"></a>            <span class="p">),</span>
</span><span id="__span-58-65"><a id="__codelineno-58-65" name="__codelineno-58-65"></a>        <span class="p">)</span>
</span><span id="__span-58-66"><a id="__codelineno-58-66" name="__codelineno-58-66"></a>
</span><span id="__span-58-67"><a id="__codelineno-58-67" name="__codelineno-58-67"></a>    <span class="k">except</span> <span class="n">__get_exceptions</span><span class="p">()</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-58-68"><a id="__codelineno-58-68" name="__codelineno-58-68"></a>        <span class="k">return</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span>
</span><span id="__span-58-69"><a id="__codelineno-58-69" name="__codelineno-58-69"></a>
</span><span id="__span-58-70"><a id="__codelineno-58-70" name="__codelineno-58-70"></a>
</span><span id="__span-58-71"><a id="__codelineno-58-71" name="__codelineno-58-71"></a><span class="k">def</span> <span class="nf">get_bucket_metadata</span><span class="p">(</span>
</span><span id="__span-58-72"><a id="__codelineno-58-72" name="__codelineno-58-72"></a>    <span class="n">bucket</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-58-73"><a id="__codelineno-58-73" name="__codelineno-58-73"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">EmptyResponseMetadataTypeDef</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="__span-58-74"><a id="__codelineno-58-74" name="__codelineno-58-74"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-58-75"><a id="__codelineno-58-75" name="__codelineno-58-75"></a>        <span class="n">client</span> <span class="o">=</span> <span class="n">__get_client</span><span class="p">()</span>
</span><span id="__span-58-76"><a id="__codelineno-58-76" name="__codelineno-58-76"></a>        <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">head_bucket</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">)</span>
</span><span id="__span-58-77"><a id="__codelineno-58-77" name="__codelineno-58-77"></a>
</span><span id="__span-58-78"><a id="__codelineno-58-78" name="__codelineno-58-78"></a>    <span class="k">except</span> <span class="n">__get_exceptions</span><span class="p">()</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-58-79"><a id="__codelineno-58-79" name="__codelineno-58-79"></a>        <span class="k">return</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span>
</span><span id="__span-58-80"><a id="__codelineno-58-80" name="__codelineno-58-80"></a>
</span><span id="__span-58-81"><a id="__codelineno-58-81" name="__codelineno-58-81"></a>
</span><span id="__span-58-82"><a id="__codelineno-58-82" name="__codelineno-58-82"></a><span class="k">def</span> <span class="nf">list_buckets</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">ListBucketsOutputTypeDef</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="__span-58-83"><a id="__codelineno-58-83" name="__codelineno-58-83"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-58-84"><a id="__codelineno-58-84" name="__codelineno-58-84"></a>        <span class="n">client</span> <span class="o">=</span> <span class="n">__get_client</span><span class="p">()</span>
</span><span id="__span-58-85"><a id="__codelineno-58-85" name="__codelineno-58-85"></a>        <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">list_buckets</span><span class="p">()</span>
</span><span id="__span-58-86"><a id="__codelineno-58-86" name="__codelineno-58-86"></a>
</span><span id="__span-58-87"><a id="__codelineno-58-87" name="__codelineno-58-87"></a>    <span class="k">except</span> <span class="n">__get_exceptions</span><span class="p">()</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-58-88"><a id="__codelineno-58-88" name="__codelineno-58-88"></a>        <span class="k">return</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span>
</span><span id="__span-58-89"><a id="__codelineno-58-89" name="__codelineno-58-89"></a>
</span><span id="__span-58-90"><a id="__codelineno-58-90" name="__codelineno-58-90"></a>
</span><span id="__span-58-91"><a id="__codelineno-58-91" name="__codelineno-58-91"></a><span class="k">def</span> <span class="nf">delete_bucket</span><span class="p">(</span><span class="n">bucket</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="__span-58-92"><a id="__codelineno-58-92" name="__codelineno-58-92"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-58-93"><a id="__codelineno-58-93" name="__codelineno-58-93"></a>        <span class="n">client</span> <span class="o">=</span> <span class="n">__get_client</span><span class="p">()</span>
</span><span id="__span-58-94"><a id="__codelineno-58-94" name="__codelineno-58-94"></a>        <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">delete_bucket</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">)</span>
</span><span id="__span-58-95"><a id="__codelineno-58-95" name="__codelineno-58-95"></a>
</span><span id="__span-58-96"><a id="__codelineno-58-96" name="__codelineno-58-96"></a>    <span class="k">except</span> <span class="n">__get_exceptions</span><span class="p">()</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-58-97"><a id="__codelineno-58-97" name="__codelineno-58-97"></a>        <span class="k">return</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span>
</span><span id="__span-58-98"><a id="__codelineno-58-98" name="__codelineno-58-98"></a>
</span><span id="__span-58-99"><a id="__codelineno-58-99" name="__codelineno-58-99"></a>
</span><span id="__span-58-100"><a id="__codelineno-58-100" name="__codelineno-58-100"></a><span class="n">HTTPVerb</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;PUT&quot;</span><span class="p">,</span> <span class="s2">&quot;DELETE&quot;</span><span class="p">,</span> <span class="s2">&quot;HEAD&quot;</span><span class="p">]</span>
</span><span id="__span-58-101"><a id="__codelineno-58-101" name="__codelineno-58-101"></a>
</span><span id="__span-58-102"><a id="__codelineno-58-102" name="__codelineno-58-102"></a>
</span><span id="__span-58-103"><a id="__codelineno-58-103" name="__codelineno-58-103"></a><span class="k">def</span> <span class="nf">generate_presigned_url</span><span class="p">(</span>
</span><span id="__span-58-104"><a id="__codelineno-58-104" name="__codelineno-58-104"></a>    <span class="n">method</span><span class="p">:</span> <span class="n">HTTPVerb</span><span class="p">,</span> <span class="n">bucket</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">ttl</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3600</span>
</span><span id="__span-58-105"><a id="__codelineno-58-105" name="__codelineno-58-105"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="__span-58-106"><a id="__codelineno-58-106" name="__codelineno-58-106"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-58-107"><a id="__codelineno-58-107" name="__codelineno-58-107"></a><span class="sd">    Generate a URL for uploading (`PUT`), downloading (`GET`), or deleting (`DELETE`)</span>
</span><span id="__span-58-108"><a id="__codelineno-58-108" name="__codelineno-58-108"></a><span class="sd">    objects to/from/in an S3 bucket. If `ttl` is not defined, then the generated URL</span>
</span><span id="__span-58-109"><a id="__codelineno-58-109" name="__codelineno-58-109"></a><span class="sd">    will be valid for 1 hour (3600 seconds).</span>
</span><span id="__span-58-110"><a id="__codelineno-58-110" name="__codelineno-58-110"></a>
</span><span id="__span-58-111"><a id="__codelineno-58-111" name="__codelineno-58-111"></a><span class="sd">    Usage:</span>
</span><span id="__span-58-112"><a id="__codelineno-58-112" name="__codelineno-58-112"></a>
</span><span id="__span-58-113"><a id="__codelineno-58-113" name="__codelineno-58-113"></a><span class="sd">    &gt;&gt;&gt; import aws_s3</span>
</span><span id="__span-58-114"><a id="__codelineno-58-114" name="__codelineno-58-114"></a><span class="sd">    &gt;&gt;&gt; import requests</span>
</span><span id="__span-58-115"><a id="__codelineno-58-115" name="__codelineno-58-115"></a><span class="sd">    &gt;&gt;&gt;</span>
</span><span id="__span-58-116"><a id="__codelineno-58-116" name="__codelineno-58-116"></a><span class="sd">    &gt;&gt;&gt; bucket: str = &quot;sample-bucket&quot;</span>
</span><span id="__span-58-117"><a id="__codelineno-58-117" name="__codelineno-58-117"></a><span class="sd">    &gt;&gt;&gt; file_path: str = &quot;sample.json&quot;</span>
</span><span id="__span-58-118"><a id="__codelineno-58-118" name="__codelineno-58-118"></a><span class="sd">    &gt;&gt;&gt; key: str = &quot;upload/sample.json&quot;</span>
</span><span id="__span-58-119"><a id="__codelineno-58-119" name="__codelineno-58-119"></a><span class="sd">    &gt;&gt;&gt;</span>
</span><span id="__span-58-120"><a id="__codelineno-58-120" name="__codelineno-58-120"></a><span class="sd">    &gt;&gt;&gt; # Uploading an object:</span>
</span><span id="__span-58-121"><a id="__codelineno-58-121" name="__codelineno-58-121"></a><span class="sd">    &gt;&gt;&gt; with open(file_path, &quot;rb&quot;) as buffer:</span>
</span><span id="__span-58-122"><a id="__codelineno-58-122" name="__codelineno-58-122"></a><span class="sd">    &gt;&gt;&gt;     url = aws_s3.generate_presigned_url(&quot;PUT&quot;, bucket, key)</span>
</span><span id="__span-58-123"><a id="__codelineno-58-123" name="__codelineno-58-123"></a><span class="sd">    &gt;&gt;&gt;     print(f&quot;Generated URL: {url}&quot;)</span>
</span><span id="__span-58-124"><a id="__codelineno-58-124" name="__codelineno-58-124"></a><span class="sd">    &gt;&gt;&gt;     response = requests.put(url, data=buffer.read())</span>
</span><span id="__span-58-125"><a id="__codelineno-58-125" name="__codelineno-58-125"></a><span class="sd">    &gt;&gt;&gt;     assert response.status_code == 200, &quot;HTTP Status Code 200&quot;</span>
</span><span id="__span-58-126"><a id="__codelineno-58-126" name="__codelineno-58-126"></a><span class="sd">    &gt;&gt;&gt;</span>
</span><span id="__span-58-127"><a id="__codelineno-58-127" name="__codelineno-58-127"></a><span class="sd">    &gt;&gt;&gt; # Downloading an object:</span>
</span><span id="__span-58-128"><a id="__codelineno-58-128" name="__codelineno-58-128"></a><span class="sd">    &gt;&gt;&gt; with open(file_path, &quot;wb&quot;) as buffer:</span>
</span><span id="__span-58-129"><a id="__codelineno-58-129" name="__codelineno-58-129"></a><span class="sd">    &gt;&gt;&gt;     url = aws_s3.generate_presigned_url(&quot;GET&quot;, bucket, key)</span>
</span><span id="__span-58-130"><a id="__codelineno-58-130" name="__codelineno-58-130"></a><span class="sd">    &gt;&gt;&gt;     print(f&quot;Generated URL: {url}&quot;)</span>
</span><span id="__span-58-131"><a id="__codelineno-58-131" name="__codelineno-58-131"></a><span class="sd">    &gt;&gt;&gt;     response = requests.get(url)</span>
</span><span id="__span-58-132"><a id="__codelineno-58-132" name="__codelineno-58-132"></a><span class="sd">    &gt;&gt;&gt;     buffer.write(response.content)</span>
</span><span id="__span-58-133"><a id="__codelineno-58-133" name="__codelineno-58-133"></a><span class="sd">    &gt;&gt;&gt;     assert response.status_code == 200, &quot;HTTP Status Code 200&quot;</span>
</span><span id="__span-58-134"><a id="__codelineno-58-134" name="__codelineno-58-134"></a><span class="sd">    &gt;&gt;&gt;</span>
</span><span id="__span-58-135"><a id="__codelineno-58-135" name="__codelineno-58-135"></a><span class="sd">    &gt;&gt;&gt; # Deleting an object:</span>
</span><span id="__span-58-136"><a id="__codelineno-58-136" name="__codelineno-58-136"></a><span class="sd">    &gt;&gt;&gt; url = aws_s3.generate_presigned_url(&quot;DELETE&quot;, bucket, key)</span>
</span><span id="__span-58-137"><a id="__codelineno-58-137" name="__codelineno-58-137"></a><span class="sd">    &gt;&gt;&gt; print(f&quot;Generated URL: {url}&quot;)</span>
</span><span id="__span-58-138"><a id="__codelineno-58-138" name="__codelineno-58-138"></a><span class="sd">    &gt;&gt;&gt; response = requests.delete(url)</span>
</span><span id="__span-58-139"><a id="__codelineno-58-139" name="__codelineno-58-139"></a><span class="sd">    &gt;&gt;&gt; assert response.status_code == 204, &quot;HTTP Status Code 204&quot;</span>
</span><span id="__span-58-140"><a id="__codelineno-58-140" name="__codelineno-58-140"></a>
</span><span id="__span-58-141"><a id="__codelineno-58-141" name="__codelineno-58-141"></a><span class="sd">    Reference/s:</span>
</span><span id="__span-58-142"><a id="__codelineno-58-142" name="__codelineno-58-142"></a><span class="sd">        - [StackOverflow](https://stackoverflow.com/a/69376282)</span>
</span><span id="__span-58-143"><a id="__codelineno-58-143" name="__codelineno-58-143"></a><span class="sd">        - [AWS S3 Docs](https://tinyurl.com/2p87uuum)</span>
</span><span id="__span-58-144"><a id="__codelineno-58-144" name="__codelineno-58-144"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-58-145"><a id="__codelineno-58-145" name="__codelineno-58-145"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-58-146"><a id="__codelineno-58-146" name="__codelineno-58-146"></a>        <span class="n">client</span> <span class="o">=</span> <span class="n">__get_client</span><span class="p">()</span>
</span><span id="__span-58-147"><a id="__codelineno-58-147" name="__codelineno-58-147"></a>        <span class="n">CLIENT_METHOD_DISPATCH</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">HTTPVerb</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-58-148"><a id="__codelineno-58-148" name="__codelineno-58-148"></a>            <span class="s2">&quot;GET&quot;</span><span class="p">:</span> <span class="n">client</span><span class="o">.</span><span class="n">get_object</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
</span><span id="__span-58-149"><a id="__codelineno-58-149" name="__codelineno-58-149"></a>            <span class="s2">&quot;PUT&quot;</span><span class="p">:</span> <span class="n">client</span><span class="o">.</span><span class="n">put_object</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
</span><span id="__span-58-150"><a id="__codelineno-58-150" name="__codelineno-58-150"></a>            <span class="s2">&quot;DELETE&quot;</span><span class="p">:</span> <span class="n">client</span><span class="o">.</span><span class="n">delete_object</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
</span><span id="__span-58-151"><a id="__codelineno-58-151" name="__codelineno-58-151"></a>            <span class="s2">&quot;HEAD&quot;</span><span class="p">:</span> <span class="n">client</span><span class="o">.</span><span class="n">head_object</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
</span><span id="__span-58-152"><a id="__codelineno-58-152" name="__codelineno-58-152"></a>        <span class="p">}</span>
</span><span id="__span-58-153"><a id="__codelineno-58-153" name="__codelineno-58-153"></a>        <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">generate_presigned_url</span><span class="p">(</span>
</span><span id="__span-58-154"><a id="__codelineno-58-154" name="__codelineno-58-154"></a>            <span class="n">ClientMethod</span><span class="o">=</span><span class="n">CLIENT_METHOD_DISPATCH</span><span class="p">[</span><span class="n">method</span><span class="p">],</span>
</span><span id="__span-58-155"><a id="__codelineno-58-155" name="__codelineno-58-155"></a>            <span class="n">Params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Bucket&quot;</span><span class="p">:</span> <span class="n">bucket</span><span class="p">,</span> <span class="s2">&quot;Key&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">},</span>
</span><span id="__span-58-156"><a id="__codelineno-58-156" name="__codelineno-58-156"></a>            <span class="n">ExpiresIn</span><span class="o">=</span><span class="n">ttl</span><span class="p">,</span>
</span><span id="__span-58-157"><a id="__codelineno-58-157" name="__codelineno-58-157"></a>        <span class="p">)</span>
</span><span id="__span-58-158"><a id="__codelineno-58-158" name="__codelineno-58-158"></a>
</span><span id="__span-58-159"><a id="__codelineno-58-159" name="__codelineno-58-159"></a>    <span class="k">except</span> <span class="n">__get_exceptions</span><span class="p">()</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-58-160"><a id="__codelineno-58-160" name="__codelineno-58-160"></a>        <span class="k">return</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span>
</span><span id="__span-58-161"><a id="__codelineno-58-161" name="__codelineno-58-161"></a>
</span><span id="__span-58-162"><a id="__codelineno-58-162" name="__codelineno-58-162"></a>
</span><span id="__span-58-163"><a id="__codelineno-58-163" name="__codelineno-58-163"></a><span class="k">def</span> <span class="nf">put_object</span><span class="p">(</span>
</span><span id="__span-58-164"><a id="__codelineno-58-164" name="__codelineno-58-164"></a>    <span class="n">bucket</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">body</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-58-165"><a id="__codelineno-58-165" name="__codelineno-58-165"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">PutObjectOutputTypeDef</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="__span-58-166"><a id="__codelineno-58-166" name="__codelineno-58-166"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-58-167"><a id="__codelineno-58-167" name="__codelineno-58-167"></a>        <span class="n">client</span> <span class="o">=</span> <span class="n">__get_client</span><span class="p">()</span>
</span><span id="__span-58-168"><a id="__codelineno-58-168" name="__codelineno-58-168"></a>        <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">put_object</span><span class="p">(</span>
</span><span id="__span-58-169"><a id="__codelineno-58-169" name="__codelineno-58-169"></a>            <span class="n">Bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">,</span>
</span><span id="__span-58-170"><a id="__codelineno-58-170" name="__codelineno-58-170"></a>            <span class="n">Body</span><span class="o">=</span><span class="n">body</span><span class="p">,</span>
</span><span id="__span-58-171"><a id="__codelineno-58-171" name="__codelineno-58-171"></a>            <span class="n">Key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span>
</span><span id="__span-58-172"><a id="__codelineno-58-172" name="__codelineno-58-172"></a>            <span class="n">ChecksumAlgorithm</span><span class="o">=</span><span class="s2">&quot;SHA256&quot;</span><span class="p">,</span>
</span><span id="__span-58-173"><a id="__codelineno-58-173" name="__codelineno-58-173"></a>            <span class="n">Metadata</span><span class="o">=</span><span class="n">metadata</span> <span class="ow">or</span> <span class="p">{},</span>
</span><span id="__span-58-174"><a id="__codelineno-58-174" name="__codelineno-58-174"></a>        <span class="p">)</span>
</span><span id="__span-58-175"><a id="__codelineno-58-175" name="__codelineno-58-175"></a>
</span><span id="__span-58-176"><a id="__codelineno-58-176" name="__codelineno-58-176"></a>    <span class="k">except</span> <span class="n">__get_exceptions</span><span class="p">()</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-58-177"><a id="__codelineno-58-177" name="__codelineno-58-177"></a>        <span class="k">return</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span>
</span><span id="__span-58-178"><a id="__codelineno-58-178" name="__codelineno-58-178"></a>
</span><span id="__span-58-179"><a id="__codelineno-58-179" name="__codelineno-58-179"></a>
</span><span id="__span-58-180"><a id="__codelineno-58-180" name="__codelineno-58-180"></a><span class="k">def</span> <span class="nf">get_object</span><span class="p">(</span><span class="n">bucket</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">GetObjectOutputTypeDef</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="__span-58-181"><a id="__codelineno-58-181" name="__codelineno-58-181"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-58-182"><a id="__codelineno-58-182" name="__codelineno-58-182"></a>        <span class="n">client</span> <span class="o">=</span> <span class="n">__get_client</span><span class="p">()</span>
</span><span id="__span-58-183"><a id="__codelineno-58-183" name="__codelineno-58-183"></a>        <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">,</span> <span class="n">Key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
</span><span id="__span-58-184"><a id="__codelineno-58-184" name="__codelineno-58-184"></a>
</span><span id="__span-58-185"><a id="__codelineno-58-185" name="__codelineno-58-185"></a>    <span class="k">except</span> <span class="n">__get_exceptions</span><span class="p">()</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-58-186"><a id="__codelineno-58-186" name="__codelineno-58-186"></a>        <span class="k">return</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span>
</span><span id="__span-58-187"><a id="__codelineno-58-187" name="__codelineno-58-187"></a>
</span><span id="__span-58-188"><a id="__codelineno-58-188" name="__codelineno-58-188"></a>
</span><span id="__span-58-189"><a id="__codelineno-58-189" name="__codelineno-58-189"></a><span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">16</span><span class="p">)</span>
</span><span id="__span-58-190"><a id="__codelineno-58-190" name="__codelineno-58-190"></a><span class="k">def</span> <span class="nf">get_object_metadata</span><span class="p">(</span>
</span><span id="__span-58-191"><a id="__codelineno-58-191" name="__codelineno-58-191"></a>    <span class="n">bucket</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="__span-58-192"><a id="__codelineno-58-192" name="__codelineno-58-192"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">HeadObjectOutputTypeDef</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="__span-58-193"><a id="__codelineno-58-193" name="__codelineno-58-193"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-58-194"><a id="__codelineno-58-194" name="__codelineno-58-194"></a>        <span class="n">client</span> <span class="o">=</span> <span class="n">__get_client</span><span class="p">()</span>
</span><span id="__span-58-195"><a id="__codelineno-58-195" name="__codelineno-58-195"></a>        <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">head_object</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">,</span> <span class="n">Key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
</span><span id="__span-58-196"><a id="__codelineno-58-196" name="__codelineno-58-196"></a>
</span><span id="__span-58-197"><a id="__codelineno-58-197" name="__codelineno-58-197"></a>    <span class="k">except</span> <span class="n">__get_exceptions</span><span class="p">()</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-58-198"><a id="__codelineno-58-198" name="__codelineno-58-198"></a>        <span class="k">return</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span>
</span><span id="__span-58-199"><a id="__codelineno-58-199" name="__codelineno-58-199"></a>
</span><span id="__span-58-200"><a id="__codelineno-58-200" name="__codelineno-58-200"></a>
</span><span id="__span-58-201"><a id="__codelineno-58-201" name="__codelineno-58-201"></a><span class="k">def</span> <span class="nf">list_objects</span><span class="p">(</span>
</span><span id="__span-58-202"><a id="__codelineno-58-202" name="__codelineno-58-202"></a>    <span class="n">bucket</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">prefix</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-58-203"><a id="__codelineno-58-203" name="__codelineno-58-203"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">ObjectTypeDef</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="__span-58-204"><a id="__codelineno-58-204" name="__codelineno-58-204"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-58-205"><a id="__codelineno-58-205" name="__codelineno-58-205"></a><span class="sd">    Reference/s:</span>
</span><span id="__span-58-206"><a id="__codelineno-58-206" name="__codelineno-58-206"></a><span class="sd">        - [StackOverflow](https://stackoverflow.com/a/59816089)</span>
</span><span id="__span-58-207"><a id="__codelineno-58-207" name="__codelineno-58-207"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-58-208"><a id="__codelineno-58-208" name="__codelineno-58-208"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-58-209"><a id="__codelineno-58-209" name="__codelineno-58-209"></a>        <span class="n">client</span> <span class="o">=</span> <span class="n">__get_client</span><span class="p">()</span>
</span><span id="__span-58-210"><a id="__codelineno-58-210" name="__codelineno-58-210"></a>        <span class="n">paginator</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
</span><span id="__span-58-211"><a id="__codelineno-58-211" name="__codelineno-58-211"></a>            <span class="n">ListObjectsV2Paginator</span><span class="p">,</span>
</span><span id="__span-58-212"><a id="__codelineno-58-212" name="__codelineno-58-212"></a>            <span class="n">client</span><span class="o">.</span><span class="n">get_paginator</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">list_objects_v2</span><span class="o">.</span><span class="vm">__name__</span><span class="p">),</span>
</span><span id="__span-58-213"><a id="__codelineno-58-213" name="__codelineno-58-213"></a>        <span class="p">)</span>
</span><span id="__span-58-214"><a id="__codelineno-58-214" name="__codelineno-58-214"></a>
</span><span id="__span-58-215"><a id="__codelineno-58-215" name="__codelineno-58-215"></a>        <span class="n">result</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ObjectTypeDef</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-58-216"><a id="__codelineno-58-216" name="__codelineno-58-216"></a>        <span class="k">for</span> <span class="n">each_page</span> <span class="ow">in</span> <span class="n">paginator</span><span class="o">.</span><span class="n">paginate</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">,</span> <span class="n">Prefix</span><span class="o">=</span><span class="n">prefix</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="__span-58-217"><a id="__codelineno-58-217" name="__codelineno-58-217"></a>            <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">each_page</span><span class="p">[</span><span class="s2">&quot;Contents&quot;</span><span class="p">])</span>
</span><span id="__span-58-218"><a id="__codelineno-58-218" name="__codelineno-58-218"></a>
</span><span id="__span-58-219"><a id="__codelineno-58-219" name="__codelineno-58-219"></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="__span-58-220"><a id="__codelineno-58-220" name="__codelineno-58-220"></a>
</span><span id="__span-58-221"><a id="__codelineno-58-221" name="__codelineno-58-221"></a>    <span class="k">except</span> <span class="n">__get_exceptions</span><span class="p">()</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-58-222"><a id="__codelineno-58-222" name="__codelineno-58-222"></a>        <span class="k">return</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span>
</span><span id="__span-58-223"><a id="__codelineno-58-223" name="__codelineno-58-223"></a>
</span><span id="__span-58-224"><a id="__codelineno-58-224" name="__codelineno-58-224"></a>
</span><span id="__span-58-225"><a id="__codelineno-58-225" name="__codelineno-58-225"></a><span class="n">OBJECT_URI</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;s3://</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">&quot;</span>
</span><span id="__span-58-226"><a id="__codelineno-58-226" name="__codelineno-58-226"></a><span class="n">PROGRESS_BAR</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> [</span><span class="si">{}{}</span><span class="s2">] </span><span class="si">{}</span><span class="s2"> % (</span><span class="si">{}</span><span class="s2"> / </span><span class="si">{}</span><span class="s2"> bytes)...&quot;</span>
</span><span id="__span-58-227"><a id="__codelineno-58-227" name="__codelineno-58-227"></a>
</span><span id="__span-58-228"><a id="__codelineno-58-228" name="__codelineno-58-228"></a>
</span><span id="__span-58-229"><a id="__codelineno-58-229" name="__codelineno-58-229"></a><span class="k">def</span> <span class="nf">upload_file</span><span class="p">(</span>
</span><span id="__span-58-230"><a id="__codelineno-58-230" name="__codelineno-58-230"></a>    <span class="n">bucket</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">show_progress</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="__span-58-231"><a id="__codelineno-58-231" name="__codelineno-58-231"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">]:</span>
</span><span id="__span-58-232"><a id="__codelineno-58-232" name="__codelineno-58-232"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-58-233"><a id="__codelineno-58-233" name="__codelineno-58-233"></a><span class="sd">    Upload a file from local device to an S3 bucket.</span>
</span><span id="__span-58-234"><a id="__codelineno-58-234" name="__codelineno-58-234"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-58-235"><a id="__codelineno-58-235" name="__codelineno-58-235"></a>    <span class="k">if</span> <span class="n">show_progress</span><span class="p">:</span>
</span><span id="__span-58-236"><a id="__codelineno-58-236" name="__codelineno-58-236"></a>        <span class="n">uri</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">OBJECT_URI</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</span><span id="__span-58-237"><a id="__codelineno-58-237" name="__codelineno-58-237"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Uploading </span><span class="si">{}</span><span class="s2"> to </span><span class="si">{}</span><span class="s2">...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">uri</span><span class="p">))</span>
</span><span id="__span-58-238"><a id="__codelineno-58-238" name="__codelineno-58-238"></a>
</span><span id="__span-58-239"><a id="__codelineno-58-239" name="__codelineno-58-239"></a>    <span class="n">total</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">show_progress</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="__span-58-240"><a id="__codelineno-58-240" name="__codelineno-58-240"></a>    <span class="n">done</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-58-241"><a id="__codelineno-58-241" name="__codelineno-58-241"></a>
</span><span id="__span-58-242"><a id="__codelineno-58-242" name="__codelineno-58-242"></a>    <span class="k">def</span> <span class="nf">callback</span><span class="p">(</span><span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-58-243"><a id="__codelineno-58-243" name="__codelineno-58-243"></a>        <span class="k">nonlocal</span> <span class="n">total</span>
</span><span id="__span-58-244"><a id="__codelineno-58-244" name="__codelineno-58-244"></a>        <span class="k">nonlocal</span> <span class="n">done</span>
</span><span id="__span-58-245"><a id="__codelineno-58-245" name="__codelineno-58-245"></a>        <span class="k">if</span> <span class="n">total</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-58-246"><a id="__codelineno-58-246" name="__codelineno-58-246"></a>            <span class="k">return</span>
</span><span id="__span-58-247"><a id="__codelineno-58-247" name="__codelineno-58-247"></a>        <span class="n">done</span> <span class="o">+=</span> <span class="n">size</span>
</span><span id="__span-58-248"><a id="__codelineno-58-248" name="__codelineno-58-248"></a>        <span class="n">prog</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">done</span> <span class="o">/</span> <span class="n">total</span>  <span class="c1"># Range: [0, 1]</span>
</span><span id="__span-58-249"><a id="__codelineno-58-249" name="__codelineno-58-249"></a>        <span class="n">prog_bar_len</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">32</span>
</span><span id="__span-58-250"><a id="__codelineno-58-250" name="__codelineno-58-250"></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="__span-58-251"><a id="__codelineno-58-251" name="__codelineno-58-251"></a>            <span class="n">PROGRESS_BAR</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="__span-58-252"><a id="__codelineno-58-252" name="__codelineno-58-252"></a>                <span class="s2">&quot;Uploading&quot;</span><span class="p">,</span>
</span><span id="__span-58-253"><a id="__codelineno-58-253" name="__codelineno-58-253"></a>                <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="nb">round</span><span class="p">(</span><span class="n">prog</span> <span class="o">*</span> <span class="n">prog_bar_len</span><span class="p">),</span>
</span><span id="__span-58-254"><a id="__codelineno-58-254" name="__codelineno-58-254"></a>                <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="nb">round</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">prog</span><span class="p">)</span> <span class="o">*</span> <span class="n">prog_bar_len</span><span class="p">),</span>
</span><span id="__span-58-255"><a id="__codelineno-58-255" name="__codelineno-58-255"></a>                <span class="nb">round</span><span class="p">(</span><span class="n">prog</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span>
</span><span id="__span-58-256"><a id="__codelineno-58-256" name="__codelineno-58-256"></a>                <span class="n">done</span><span class="p">,</span>
</span><span id="__span-58-257"><a id="__codelineno-58-257" name="__codelineno-58-257"></a>                <span class="n">total</span><span class="p">,</span>
</span><span id="__span-58-258"><a id="__codelineno-58-258" name="__codelineno-58-258"></a>            <span class="p">),</span>
</span><span id="__span-58-259"><a id="__codelineno-58-259" name="__codelineno-58-259"></a>            <span class="n">end</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">prog</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot; Complete.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="__span-58-260"><a id="__codelineno-58-260" name="__codelineno-58-260"></a>        <span class="p">)</span>
</span><span id="__span-58-261"><a id="__codelineno-58-261" name="__codelineno-58-261"></a>
</span><span id="__span-58-262"><a id="__codelineno-58-262" name="__codelineno-58-262"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-58-263"><a id="__codelineno-58-263" name="__codelineno-58-263"></a>        <span class="n">client</span> <span class="o">=</span> <span class="n">__get_client</span><span class="p">()</span>
</span><span id="__span-58-264"><a id="__codelineno-58-264" name="__codelineno-58-264"></a>        <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">upload_file</span><span class="p">(</span>
</span><span id="__span-58-265"><a id="__codelineno-58-265" name="__codelineno-58-265"></a>            <span class="n">Bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">,</span>
</span><span id="__span-58-266"><a id="__codelineno-58-266" name="__codelineno-58-266"></a>            <span class="n">Key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span>
</span><span id="__span-58-267"><a id="__codelineno-58-267" name="__codelineno-58-267"></a>            <span class="n">Filename</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span>
</span><span id="__span-58-268"><a id="__codelineno-58-268" name="__codelineno-58-268"></a>            <span class="n">Callback</span><span class="o">=</span><span class="n">callback</span> <span class="k">if</span> <span class="n">show_progress</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-58-269"><a id="__codelineno-58-269" name="__codelineno-58-269"></a>        <span class="p">)</span>
</span><span id="__span-58-270"><a id="__codelineno-58-270" name="__codelineno-58-270"></a>
</span><span id="__span-58-271"><a id="__codelineno-58-271" name="__codelineno-58-271"></a>    <span class="k">except</span> <span class="n">__get_exceptions</span><span class="p">()</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-58-272"><a id="__codelineno-58-272" name="__codelineno-58-272"></a>        <span class="k">return</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span>
</span><span id="__span-58-273"><a id="__codelineno-58-273" name="__codelineno-58-273"></a>
</span><span id="__span-58-274"><a id="__codelineno-58-274" name="__codelineno-58-274"></a>
</span><span id="__span-58-275"><a id="__codelineno-58-275" name="__codelineno-58-275"></a><span class="k">def</span> <span class="nf">download_file</span><span class="p">(</span>
</span><span id="__span-58-276"><a id="__codelineno-58-276" name="__codelineno-58-276"></a>    <span class="n">bucket</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">show_progress</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="__span-58-277"><a id="__codelineno-58-277" name="__codelineno-58-277"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">]:</span>
</span><span id="__span-58-278"><a id="__codelineno-58-278" name="__codelineno-58-278"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-58-279"><a id="__codelineno-58-279" name="__codelineno-58-279"></a><span class="sd">    Download a file from a bucket `bucket` with key `key` to local device</span>
</span><span id="__span-58-280"><a id="__codelineno-58-280" name="__codelineno-58-280"></a><span class="sd">    with file path `file_path`. If `show_progress` is `True`, then a</span>
</span><span id="__span-58-281"><a id="__codelineno-58-281" name="__codelineno-58-281"></a><span class="sd">    progress bar will be displayed in the console.</span>
</span><span id="__span-58-282"><a id="__codelineno-58-282" name="__codelineno-58-282"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-58-283"><a id="__codelineno-58-283" name="__codelineno-58-283"></a>    <span class="k">if</span> <span class="n">show_progress</span><span class="p">:</span>
</span><span id="__span-58-284"><a id="__codelineno-58-284" name="__codelineno-58-284"></a>        <span class="n">uri</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">OBJECT_URI</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</span><span id="__span-58-285"><a id="__codelineno-58-285" name="__codelineno-58-285"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Downloading </span><span class="si">{}</span><span class="s2"> to </span><span class="si">{}</span><span class="s2">...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span> <span class="n">file_path</span><span class="p">))</span>
</span><span id="__span-58-286"><a id="__codelineno-58-286" name="__codelineno-58-286"></a>
</span><span id="__span-58-287"><a id="__codelineno-58-287" name="__codelineno-58-287"></a>    <span class="n">headers</span> <span class="o">=</span> <span class="n">get_object_metadata</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</span><span id="__span-58-288"><a id="__codelineno-58-288" name="__codelineno-58-288"></a>    <span class="n">total</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">headers</span><span class="p">[</span><span class="s2">&quot;ContentLength&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">show_progress</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="__span-58-289"><a id="__codelineno-58-289" name="__codelineno-58-289"></a>    <span class="n">done</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-58-290"><a id="__codelineno-58-290" name="__codelineno-58-290"></a>
</span><span id="__span-58-291"><a id="__codelineno-58-291" name="__codelineno-58-291"></a>    <span class="k">def</span> <span class="nf">callback</span><span class="p">(</span><span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-58-292"><a id="__codelineno-58-292" name="__codelineno-58-292"></a>        <span class="k">nonlocal</span> <span class="n">total</span>
</span><span id="__span-58-293"><a id="__codelineno-58-293" name="__codelineno-58-293"></a>        <span class="k">nonlocal</span> <span class="n">done</span>
</span><span id="__span-58-294"><a id="__codelineno-58-294" name="__codelineno-58-294"></a>        <span class="k">if</span> <span class="n">total</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-58-295"><a id="__codelineno-58-295" name="__codelineno-58-295"></a>            <span class="k">return</span>
</span><span id="__span-58-296"><a id="__codelineno-58-296" name="__codelineno-58-296"></a>        <span class="n">done</span> <span class="o">+=</span> <span class="n">size</span>
</span><span id="__span-58-297"><a id="__codelineno-58-297" name="__codelineno-58-297"></a>        <span class="n">progress</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">done</span> <span class="o">/</span> <span class="n">total</span>  <span class="c1"># Range: [0, 1]</span>
</span><span id="__span-58-298"><a id="__codelineno-58-298" name="__codelineno-58-298"></a>        <span class="n">progress_bar_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">32</span>
</span><span id="__span-58-299"><a id="__codelineno-58-299" name="__codelineno-58-299"></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="__span-58-300"><a id="__codelineno-58-300" name="__codelineno-58-300"></a>            <span class="n">PROGRESS_BAR</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="__span-58-301"><a id="__codelineno-58-301" name="__codelineno-58-301"></a>                <span class="s2">&quot;Downloading&quot;</span><span class="p">,</span>
</span><span id="__span-58-302"><a id="__codelineno-58-302" name="__codelineno-58-302"></a>                <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="nb">round</span><span class="p">(</span><span class="n">progress</span> <span class="o">*</span> <span class="n">progress_bar_length</span><span class="p">),</span>
</span><span id="__span-58-303"><a id="__codelineno-58-303" name="__codelineno-58-303"></a>                <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="nb">round</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">progress</span><span class="p">)</span> <span class="o">*</span> <span class="n">progress_bar_length</span><span class="p">),</span>
</span><span id="__span-58-304"><a id="__codelineno-58-304" name="__codelineno-58-304"></a>                <span class="nb">round</span><span class="p">(</span><span class="n">progress</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="__span-58-305"><a id="__codelineno-58-305" name="__codelineno-58-305"></a>                <span class="n">done</span><span class="p">,</span>
</span><span id="__span-58-306"><a id="__codelineno-58-306" name="__codelineno-58-306"></a>                <span class="n">total</span><span class="p">,</span>
</span><span id="__span-58-307"><a id="__codelineno-58-307" name="__codelineno-58-307"></a>            <span class="p">),</span>
</span><span id="__span-58-308"><a id="__codelineno-58-308" name="__codelineno-58-308"></a>            <span class="n">end</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">progress</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot; Complete.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="__span-58-309"><a id="__codelineno-58-309" name="__codelineno-58-309"></a>        <span class="p">)</span>
</span><span id="__span-58-310"><a id="__codelineno-58-310" name="__codelineno-58-310"></a>
</span><span id="__span-58-311"><a id="__codelineno-58-311" name="__codelineno-58-311"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-58-312"><a id="__codelineno-58-312" name="__codelineno-58-312"></a>        <span class="n">client</span> <span class="o">=</span> <span class="n">__get_client</span><span class="p">()</span>
</span><span id="__span-58-313"><a id="__codelineno-58-313" name="__codelineno-58-313"></a>        <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">download_file</span><span class="p">(</span>
</span><span id="__span-58-314"><a id="__codelineno-58-314" name="__codelineno-58-314"></a>            <span class="n">Bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">,</span>
</span><span id="__span-58-315"><a id="__codelineno-58-315" name="__codelineno-58-315"></a>            <span class="n">Key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span>
</span><span id="__span-58-316"><a id="__codelineno-58-316" name="__codelineno-58-316"></a>            <span class="n">Filename</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span>
</span><span id="__span-58-317"><a id="__codelineno-58-317" name="__codelineno-58-317"></a>            <span class="n">Callback</span><span class="o">=</span><span class="n">callback</span> <span class="k">if</span> <span class="n">show_progress</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-58-318"><a id="__codelineno-58-318" name="__codelineno-58-318"></a>        <span class="p">)</span>
</span><span id="__span-58-319"><a id="__codelineno-58-319" name="__codelineno-58-319"></a>
</span><span id="__span-58-320"><a id="__codelineno-58-320" name="__codelineno-58-320"></a>    <span class="k">except</span> <span class="n">__get_exceptions</span><span class="p">()</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-58-321"><a id="__codelineno-58-321" name="__codelineno-58-321"></a>        <span class="k">return</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span>
</span><span id="__span-58-322"><a id="__codelineno-58-322" name="__codelineno-58-322"></a>
</span><span id="__span-58-323"><a id="__codelineno-58-323" name="__codelineno-58-323"></a>
</span><span id="__span-58-324"><a id="__codelineno-58-324" name="__codelineno-58-324"></a><span class="k">def</span> <span class="nf">copy_object</span><span class="p">(</span>
</span><span id="__span-58-325"><a id="__codelineno-58-325" name="__codelineno-58-325"></a>    <span class="n">source_bucket</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-58-326"><a id="__codelineno-58-326" name="__codelineno-58-326"></a>    <span class="n">source_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-58-327"><a id="__codelineno-58-327" name="__codelineno-58-327"></a>    <span class="n">target_bucket</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-58-328"><a id="__codelineno-58-328" name="__codelineno-58-328"></a>    <span class="n">target_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-58-329"><a id="__codelineno-58-329" name="__codelineno-58-329"></a>    <span class="o">*</span><span class="p">,</span>
</span><span id="__span-58-330"><a id="__codelineno-58-330" name="__codelineno-58-330"></a>    <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-58-331"><a id="__codelineno-58-331" name="__codelineno-58-331"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">CopyObjectOutputTypeDef</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="__span-58-332"><a id="__codelineno-58-332" name="__codelineno-58-332"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-58-333"><a id="__codelineno-58-333" name="__codelineno-58-333"></a><span class="sd">    Copy an object with key `source_key` from bucket `source_bucket` to</span>
</span><span id="__span-58-334"><a id="__codelineno-58-334" name="__codelineno-58-334"></a><span class="sd">    another bucket `target_bucket` with key `target_key`.</span>
</span><span id="__span-58-335"><a id="__codelineno-58-335" name="__codelineno-58-335"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-58-336"><a id="__codelineno-58-336" name="__codelineno-58-336"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-58-337"><a id="__codelineno-58-337" name="__codelineno-58-337"></a>        <span class="n">client</span> <span class="o">=</span> <span class="n">__get_client</span><span class="p">()</span>
</span><span id="__span-58-338"><a id="__codelineno-58-338" name="__codelineno-58-338"></a>        <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">copy_object</span><span class="p">(</span>
</span><span id="__span-58-339"><a id="__codelineno-58-339" name="__codelineno-58-339"></a>            <span class="n">Bucket</span><span class="o">=</span><span class="n">target_bucket</span><span class="p">,</span>
</span><span id="__span-58-340"><a id="__codelineno-58-340" name="__codelineno-58-340"></a>            <span class="n">Key</span><span class="o">=</span><span class="n">target_key</span><span class="p">,</span>
</span><span id="__span-58-341"><a id="__codelineno-58-341" name="__codelineno-58-341"></a>            <span class="n">CopySource</span><span class="o">=</span><span class="n">CopySourceTypeDef</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">source_bucket</span><span class="p">,</span> <span class="n">Key</span><span class="o">=</span><span class="n">source_key</span><span class="p">),</span>
</span><span id="__span-58-342"><a id="__codelineno-58-342" name="__codelineno-58-342"></a>            <span class="n">Metadata</span><span class="o">=</span><span class="n">metadata</span> <span class="ow">or</span> <span class="p">{},</span>
</span><span id="__span-58-343"><a id="__codelineno-58-343" name="__codelineno-58-343"></a>        <span class="p">)</span>
</span><span id="__span-58-344"><a id="__codelineno-58-344" name="__codelineno-58-344"></a>
</span><span id="__span-58-345"><a id="__codelineno-58-345" name="__codelineno-58-345"></a>    <span class="k">except</span> <span class="n">__get_exceptions</span><span class="p">()</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-58-346"><a id="__codelineno-58-346" name="__codelineno-58-346"></a>        <span class="k">return</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span>
</span><span id="__span-58-347"><a id="__codelineno-58-347" name="__codelineno-58-347"></a>
</span><span id="__span-58-348"><a id="__codelineno-58-348" name="__codelineno-58-348"></a>
</span><span id="__span-58-349"><a id="__codelineno-58-349" name="__codelineno-58-349"></a><span class="k">def</span> <span class="nf">delete_object</span><span class="p">(</span>
</span><span id="__span-58-350"><a id="__codelineno-58-350" name="__codelineno-58-350"></a>    <span class="n">bucket</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="__span-58-351"><a id="__codelineno-58-351" name="__codelineno-58-351"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">DeleteObjectOutputTypeDef</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="__span-58-352"><a id="__codelineno-58-352" name="__codelineno-58-352"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-58-353"><a id="__codelineno-58-353" name="__codelineno-58-353"></a><span class="sd">    Delete an object from bucket `bucket` with key `key`.</span>
</span><span id="__span-58-354"><a id="__codelineno-58-354" name="__codelineno-58-354"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-58-355"><a id="__codelineno-58-355" name="__codelineno-58-355"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-58-356"><a id="__codelineno-58-356" name="__codelineno-58-356"></a>        <span class="n">client</span> <span class="o">=</span> <span class="n">__get_client</span><span class="p">()</span>
</span><span id="__span-58-357"><a id="__codelineno-58-357" name="__codelineno-58-357"></a>        <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">delete_object</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">,</span> <span class="n">Key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
</span><span id="__span-58-358"><a id="__codelineno-58-358" name="__codelineno-58-358"></a>
</span><span id="__span-58-359"><a id="__codelineno-58-359" name="__codelineno-58-359"></a>    <span class="k">except</span> <span class="n">__get_exceptions</span><span class="p">()</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-58-360"><a id="__codelineno-58-360" name="__codelineno-58-360"></a>        <span class="k">return</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span>
</span><span id="__span-58-361"><a id="__codelineno-58-361" name="__codelineno-58-361"></a>
</span><span id="__span-58-362"><a id="__codelineno-58-362" name="__codelineno-58-362"></a>
</span><span id="__span-58-363"><a id="__codelineno-58-363" name="__codelineno-58-363"></a><span class="k">def</span> <span class="nf">delete_objects</span><span class="p">(</span>
</span><span id="__span-58-364"><a id="__codelineno-58-364" name="__codelineno-58-364"></a>    <span class="n">bucket</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">keys</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span><span id="__span-58-365"><a id="__codelineno-58-365" name="__codelineno-58-365"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">DeleteObjectsOutputTypeDef</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="__span-58-366"><a id="__codelineno-58-366" name="__codelineno-58-366"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-58-367"><a id="__codelineno-58-367" name="__codelineno-58-367"></a><span class="sd">    Delete object/s from bucket `bucket` if key is in list `keys`.</span>
</span><span id="__span-58-368"><a id="__codelineno-58-368" name="__codelineno-58-368"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-58-369"><a id="__codelineno-58-369" name="__codelineno-58-369"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-58-370"><a id="__codelineno-58-370" name="__codelineno-58-370"></a>        <span class="n">client</span> <span class="o">=</span> <span class="n">__get_client</span><span class="p">()</span>
</span><span id="__span-58-371"><a id="__codelineno-58-371" name="__codelineno-58-371"></a>        <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">delete_objects</span><span class="p">(</span>
</span><span id="__span-58-372"><a id="__codelineno-58-372" name="__codelineno-58-372"></a>            <span class="n">Bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">,</span>
</span><span id="__span-58-373"><a id="__codelineno-58-373" name="__codelineno-58-373"></a>            <span class="n">Delete</span><span class="o">=</span><span class="n">DeleteTypeDef</span><span class="p">(</span>
</span><span id="__span-58-374"><a id="__codelineno-58-374" name="__codelineno-58-374"></a>                <span class="n">Objects</span><span class="o">=</span><span class="p">[</span><span class="n">ObjectIdentifierTypeDef</span><span class="p">(</span><span class="n">Key</span><span class="o">=</span><span class="n">each_key</span><span class="p">)</span> <span class="k">for</span> <span class="n">each_key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">]</span>
</span><span id="__span-58-375"><a id="__codelineno-58-375" name="__codelineno-58-375"></a>            <span class="p">),</span>
</span><span id="__span-58-376"><a id="__codelineno-58-376" name="__codelineno-58-376"></a>        <span class="p">)</span>
</span><span id="__span-58-377"><a id="__codelineno-58-377" name="__codelineno-58-377"></a>
</span><span id="__span-58-378"><a id="__codelineno-58-378" name="__codelineno-58-378"></a>    <span class="k">except</span> <span class="n">__get_exceptions</span><span class="p">()</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-58-379"><a id="__codelineno-58-379" name="__codelineno-58-379"></a>        <span class="k">return</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span>
</span><span id="__span-58-380"><a id="__codelineno-58-380" name="__codelineno-58-380"></a>
</span><span id="__span-58-381"><a id="__codelineno-58-381" name="__codelineno-58-381"></a>
</span><span id="__span-58-382"><a id="__codelineno-58-382" name="__codelineno-58-382"></a><span class="k">def</span> <span class="nf">move_object</span><span class="p">(</span>
</span><span id="__span-58-383"><a id="__codelineno-58-383" name="__codelineno-58-383"></a>    <span class="n">source_bucket</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-58-384"><a id="__codelineno-58-384" name="__codelineno-58-384"></a>    <span class="n">source_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-58-385"><a id="__codelineno-58-385" name="__codelineno-58-385"></a>    <span class="n">target_bucket</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-58-386"><a id="__codelineno-58-386" name="__codelineno-58-386"></a>    <span class="n">target_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-58-387"><a id="__codelineno-58-387" name="__codelineno-58-387"></a>    <span class="o">*</span><span class="p">,</span>
</span><span id="__span-58-388"><a id="__codelineno-58-388" name="__codelineno-58-388"></a>    <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-58-389"><a id="__codelineno-58-389" name="__codelineno-58-389"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">]:</span>
</span><span id="__span-58-390"><a id="__codelineno-58-390" name="__codelineno-58-390"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-58-391"><a id="__codelineno-58-391" name="__codelineno-58-391"></a>        <span class="n">copy_object</span><span class="p">(</span>
</span><span id="__span-58-392"><a id="__codelineno-58-392" name="__codelineno-58-392"></a>            <span class="n">source_bucket</span><span class="p">,</span> <span class="n">source_key</span><span class="p">,</span> <span class="n">target_bucket</span><span class="p">,</span> <span class="n">target_key</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span>
</span><span id="__span-58-393"><a id="__codelineno-58-393" name="__codelineno-58-393"></a>        <span class="p">)</span>
</span><span id="__span-58-394"><a id="__codelineno-58-394" name="__codelineno-58-394"></a>        <span class="n">delete_object</span><span class="p">(</span><span class="n">source_bucket</span><span class="p">,</span> <span class="n">source_key</span><span class="p">)</span>
</span><span id="__span-58-395"><a id="__codelineno-58-395" name="__codelineno-58-395"></a>
</span><span id="__span-58-396"><a id="__codelineno-58-396" name="__codelineno-58-396"></a>    <span class="k">except</span> <span class="n">__get_exceptions</span><span class="p">()</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-58-397"><a id="__codelineno-58-397" name="__codelineno-58-397"></a>        <span class="k">return</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span>
</span></code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<hr />
<h2 id="use-cases-and-benefits">Use Cases and Benefits</h2>
<p>Managing S3 buckets and objects effectively can provide various benefits for individuals and organizations. Here is a list of possible benefits:</p>
<ol>
<li><strong>Scalable Storage</strong>: S3 allows you to store an unlimited amount of data, making it a highly scalable solution for your storage needs.</li>
<li><strong>Durability</strong>: S3 provides 99.999999999% (11 nines) data durability, ensuring that your data is highly resistant to loss.</li>
<li><strong>Availability</strong>: Objects stored in S3 are highly available, with an SLA (Service Level Agreement) of 99.99% uptime.</li>
<li><strong>Cost-Effective</strong>: S3 offers a cost-effective storage solution, and you only pay for the storage you use.</li>
<li><strong>Data Security</strong>: S3 provides multiple layers of data security, including encryption at rest and in transit, access control policies, and versioning.</li>
<li><strong>Data Backup</strong>: S3 is an excellent platform for data backup, providing a secure and scalable solution for disaster recovery.</li>
<li><strong>Data Archiving</strong>: You can use S3's storage classes, such as Glacier, for long-term data archiving, reducing costs further.</li>
<li><strong>Data Encryption</strong>: S3 supports server-side and client-side encryption, ensuring data security and privacy.</li>
</ol>
<hr />
<h2 id="conclusion">Conclusion</h2>
<p>In conclusion, Boto3 provides a powerful and user-friendly toolkit for managing Amazon S3 buckets and objects, making it an essential tool for AWS developers and administrators. With Boto3, you can easily create and delete buckets, upload and download files, generate presigned URLs, and handle exceptions gracefully. The library offers an array of features to manage and interact with your S3 resources efficiently, making it a valuable asset for everything from data storage and backup to content distribution and data analytics. By following the steps outlined in this article, you can harness the full potential of Boto3 and unlock the capabilities of Amazon S3, ensuring that your cloud-based data management is both robust and accessible.</p>
<hr />



  



      
    </article>
  </div>

          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2023 Achilles C. Macunlay <br> <a href="#__consent">Change Cookie Settings</a>
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/acmacunlay" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/in/acmacunlay" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.annotate", "navigation.instant", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "content.code.copy", "search.suggest", "search.highlight"], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.aecac24b.min.js"></script>
      
    
  </body>
</html>